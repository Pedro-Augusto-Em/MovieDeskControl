<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anydesk Control - Sistema de BI</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📊</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* Animações personalizadas */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0, -30px, 0); }
            70% { transform: translate3d(0, -15px, 0); }
            90% { transform: translate3d(0, -4px, 0); }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes highlight {
            0%, 100% { 
                box-shadow: 0 0 40px rgba(59, 130, 246, 1), 0 0 80px rgba(59, 130, 246, 0.8), 0 0 120px rgba(59, 130, 246, 0.6);
                transform: scale(1.05);
                filter: brightness(1.2) contrast(1.1);
            }
            50% { 
                box-shadow: 0 0 60px rgba(59, 130, 246, 1.2), 0 0 100px rgba(59, 130, 246, 1), 0 0 140px rgba(59, 130, 246, 0.8);
                transform: scale(1.08);
                filter: brightness(1.4) contrast(1.2);
            }
        }

        @keyframes tutorial-border-glow {
            0%, 100% { 
                opacity: 0.8;
                transform: rotate(0deg);
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
            }
            50% { 
                opacity: 1;
                transform: rotate(180deg);
                box-shadow: 0 0 30px rgba(59, 130, 246, 1);
            }
        }

        @keyframes tutorial-glow {
            0%, 100% { 
                opacity: 0.4;
                transform: scale(1);
            }
            50% { 
                opacity: 0.8;
                transform: scale(1.2);
            }
        }

        @keyframes tutorial-outer-glow {
            0%, 100% { 
                opacity: 0.2;
                transform: scale(1);
            }
            50% { 
                opacity: 0.4;
                transform: scale(1.1);
            }
        }

        @keyframes tutorial-particle-float {
            0%, 100% { 
                transform: translateY(0px) scale(1);
                opacity: 0.8;
            }
            25% { 
                transform: translateY(-15px) scale(1.2);
                opacity: 1;
            }
            50% { 
                transform: translateY(-25px) scale(1.1);
                opacity: 0.9;
            }
            75% { 
                transform: translateY(-15px) scale(1.3);
                opacity: 1;
            }
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-10px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 99999;
            display: none;
            pointer-events: none;
        }
        
        .tutorial-overlay.active {
            pointer-events: auto;
        }
        
        .tutorial-step {
            position: absolute;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            z-index: 100000;
            animation: fadeInUp 0.5s ease-out;
            pointer-events: auto;
        }
        
        .tutorial-highlight {
            position: relative;
            z-index: 100001 !important;
            animation: highlight 2s infinite;
            box-shadow: 0 0 40px rgba(59, 130, 246, 1), 0 0 80px rgba(59, 130, 246, 0.8), 0 0 120px rgba(59, 130, 246, 0.6);
            border: 4px solid #3b82f6;
            border-radius: 12px;
            transform: scale(1.05);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            filter: brightness(1.2) contrast(1.1);
        }

        .tutorial-highlight::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            background: linear-gradient(45deg, #3b82f6, #1d4ed8, #3b82f6, #60a5fa);
            border-radius: 16px;
            z-index: -1;
            animation: tutorial-border-glow 2s infinite;
            opacity: 0.8;
        }

        .tutorial-highlight::after {
            content: '';
            position: absolute;
            top: -15px;
            left: -15px;
            right: -15px;
            bottom: -15px;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.2) 0%, transparent 70%);
            border-radius: 20px;
            z-index: -2;
            animation: tutorial-outer-glow 3s infinite;
        }

        .tutorial-special-effect {
            position: relative;
            z-index: 100002 !important;
        }

        .tutorial-glow-effect {
            position: absolute;
            top: -20px;
            left: -20px;
            right: -20px;
            bottom: -20px;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.4) 0%, rgba(29, 78, 216, 0.2) 30%, transparent 70%);
            border-radius: 25px;
            z-index: -3;
            animation: tutorial-glow 3s infinite;
            pointer-events: none;
            filter: blur(2px);
        }
        
        /* Estilos para o Sidebar Minimizado */
        .sidebar-minimized {
            width: 80px !important;
        }
        
        .sidebar-minimized #sidebarContent {
            display: none;
        }
        
        .sidebar-minimized #sidebarMinimized {
            display: block !important;
        }
        
        .sidebar-minimized #toggleIcon {
            transform: rotate(180deg);
        }
        
        .sidebar-minimized {
            left: 0.5rem;
        }
        
        /* Transições suaves para o sidebar */
        #sidebar {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #sidebarContent, #sidebarMinimized {
            transition: opacity 0.3s ease-in-out;
        }
        
        /* Hover effects para o botão de toggle */
        #sidebarToggle:hover {
            transform: scale(1.1) translateY(-50%);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        /* Efeito de hover no avatar minimizado */
        #userAvatarMin:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease-in-out;
        }
        
        .tutorial-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border: 10px solid transparent;
        }
        
        .tutorial-arrow.top {
            border-bottom-color: white;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .tutorial-arrow.bottom {
            border-top-color: white;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .tutorial-arrow.left {
            border-right-color: white;
            left: -20px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .tutorial-arrow.right {
            border-left-color: white;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .tutorial-arrow.center {
            display: none;
        }
        
        .tutorial-progress {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1f2937;
            padding: 10px 15px;
            border-radius: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            z-index: 100002;
            font-size: 14px;
            font-weight: 600;
            color: #ffffff;
            border: 2px solid #3b82f6;
        }
        
        .tutorial-skip {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #dc2626;
            padding: 8px 16px;
            border-radius: 20px;
            z-index: 100002;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            color: #ffffff;
            font-weight: 600;
            border: 2px solid #b91c1c;
        }
        
        .tutorial-skip:hover {
            background: #b91c1c;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
        }
        
        .tutorial-button {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
            border: 2px solid transparent;
        }
        
        .tutorial-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
            border-color: #60a5fa;
        }
        
        .tutorial-button.secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            border-color: #9ca3af;
        }

        .tutorial-button.secondary:hover {
            box-shadow: 0 10px 20px rgba(107, 114, 128, 0.3);
            border-color: #d1d5db;
        }

        .tutorial-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .tutorial-icon {
            font-size: 28px;
            margin-bottom: 12px;
            color: #3b82f6;
            text-align: center;
        }
        
        .tutorial-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #1f2937;
            text-align: center;
        }
        
        .tutorial-description {
            font-size: 15px;
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 18px;
            text-align: center;
        }
        
        .tutorial-feature-list {
            background: #f8fafc;
            padding: 18px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #e5e7eb;
        }
        
        .tutorial-feature-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 14px;
            color: #374151;
            padding: 8px;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }

        .tutorial-feature-item:hover {
            background-color: #f1f5f9;
        }
        
        .tutorial-feature-item i {
            margin-right: 10px;
            color: #10b981;
            width: 18px;
            font-size: 16px;
        }
        
        .tutorial-demo {
            background: #f0f9ff;
            border: 2px dashed #3b82f6;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            color: #1e40af;
            transition: all 0.3s ease;
        }

        .tutorial-demo:hover {
            background: #e0f2fe;
            border-color: #1d4ed8;
            transform: translateY(-2px);
        }
        
        .tutorial-demo i {
            font-size: 36px;
            margin-bottom: 12px;
            color: #3b82f6;
        }
        
        /* Animações para elementos específicos */
        .animate-pulse-slow {
            animation: pulse 2s infinite;
        }
        
        .animate-bounce-slow {
            animation: bounce 2s infinite;
        }
        
        .animate-slide-in {
            animation: slideInRight 0.6s ease-out;
        }
        
        /* Estilos para o modal de tutorial */
        .tutorial-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            z-index: 10003;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: fadeInUp 0.5s ease-out;
        }
        
        .tutorial-modal-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .tutorial-modal-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .tutorial-modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 10px;
        }
        
        .tutorial-modal-subtitle {
            font-size: 16px;
            color: #6b7280;
        }
        
        .tutorial-modal-content {
            margin-bottom: 25px;
        }
        
        .tutorial-modal-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        /* Estilos para tooltips */
        .tutorial-tooltip {
            position: absolute;
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10004;
            pointer-events: none;
        }
        
        .tutorial-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #1f2937;
        }
        
        /* Corrigir layout infinito */
        body {
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .grid {
            max-width: 100%;
            overflow: hidden;
        }
        
        canvas {
            max-height: 300px !important;
        }
        
        /* Garantir que os gráficos não estiquem infinitamente */
        .bg-gray-800 {
            overflow: hidden;
        }
        
        /* Corrigir altura dos containers de gráficos */
        .bg-gray-800 canvas {
            height: 200px !important;
            max-height: 200px !important;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Overlay do Tutorial -->
    <div id="tutorialOverlay" class="tutorial-overlay"></div>
    
    <!-- Progresso do Tutorial -->
    <div id="tutorialProgress" class="tutorial-progress" style="display: none;">
        <i class="fas fa-play-circle mr-2"></i>
        <span id="tutorialStepText">Passo 1 de 12</span>
    </div>
    
    <!-- Botão Pular Tutorial -->
    <div id="tutorialSkip" class="tutorial-skip" style="display: none;">
        <i class="fas fa-times mr-2"></i>
        Pular Tutorial
    </div>
    
    <!-- Modal de Início do Tutorial -->
    <div id="tutorialModal" class="tutorial-modal" style="display: none;">
        <div class="tutorial-modal-header">
            <div class="tutorial-modal-icon">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <div class="tutorial-modal-title">Bem-vindo ao Anydesk Control!</div>
            <div class="tutorial-modal-subtitle">Sistema de Business Intelligence para Análise de Tickets</div>
        </div>
        
        <div class="tutorial-modal-content">
            <p class="text-gray-600 mb-4">
                Este tutorial irá guiá-lo através de todas as funcionalidades do sistema:
            </p>
            
            <div class="tutorial-feature-list">
                <div class="tutorial-feature-item">
                    <i class="fas fa-file-excel"></i>
                    <span>Importação de arquivos Excel</span>
                </div>
                <div class="tutorial-feature-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>Criação e edição de gráficos</span>
                </div>
                <div class="tutorial-feature-item">
                    <i class="fas fa-sort"></i>
                    <span>Ordenação e agrupamento de dados</span>
                </div>
                <div class="tutorial-feature-item">
                    <i class="fas fa-user-edit"></i>
                    <span>Gestão de perfil do usuário</span>
                </div>
                <div class="tutorial-feature-item">
                    <i class="fas fa-cog"></i>
                    <span>Configurações e personalização</span>
                </div>
            </div>
        </div>
        
        <div class="tutorial-modal-actions">
            <button class="tutorial-button secondary" onclick="skipTutorial()">
                <i class="fas fa-times mr-2"></i>
                Pular Tutorial
            </button>
            <button class="tutorial-button" onclick="startTutorial()">
                <i class="fas fa-play mr-2"></i>
                Começar Tutorial
            </button>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-gray-800 shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="text-2xl font-bold text-blue-400">
                        <i class="fas fa-chart-line mr-2"></i>
                        Anydesk Control
                    </div>
                    <span class="text-sm text-gray-400">Sistema de BI</span>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Seletor de Dados -->
                    <div class="flex items-center space-x-2">
                        <label class="text-gray-300 text-sm">Dados:</label>
                        <select id="dataSourceSelector" class="bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white text-sm">
                            <option value="">Selecione os dados</option>
                        </select>
                    </div>
                    
                    <!-- Botão Tutorial -->
                    <button id="tutorialBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center">
                        <i class="fas fa-graduation-cap mr-2"></i>
                        Tutorial
                    </button>
                    
                    <!-- Botão Importar Excel -->
                    <button id="importExcelBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center">
                        <i class="fas fa-file-excel mr-2"></i>
                        Importar Excel
                    </button>
                    
                    <!-- Botão Configurações -->
                    <button id="settingsBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

         <!-- Main Content -->
     <main class="container mx-auto px-6 py-8">
         <!-- Cards de Resumo -->
         <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
             <div class="bg-gray-800 rounded-lg p-6 shadow-lg hover:bg-gray-700 transition-colors cursor-pointer" data-stat="total" onclick="openTicketsModal('all')">
                 <div class="flex items-center">
                     <div class="p-3 rounded-full bg-blue-500 bg-opacity-10">
                         <i class="fas fa-ticket-alt text-blue-400 text-xl"></i>
                     </div>
                     <div class="ml-4">
                         <p class="text-sm font-medium text-gray-400">Total de Tickets</p>
                         <p class="text-2xl font-semibold text-white" id="totalTicketsCard">0</p>
                     </div>
                 </div>
             </div>
             
             <div class="bg-gray-800 rounded-lg p-6 shadow-lg hover:bg-gray-700 transition-colors cursor-pointer" data-stat="abertos" onclick="openTicketsModal('open')">
                 <div class="flex items-center">
                     <div class="p-3 rounded-full bg-yellow-500 bg-opacity-10">
                         <i class="fas fa-clock text-yellow-400 text-xl"></i>
                     </div>
                     <div class="ml-4">
                         <p class="text-sm font-medium text-gray-400">Em Aberto</p>
                         <p class="text-2xl font-semibold text-white" id="ticketsAbertosCard">0</p>
                     </div>
                 </div>
             </div>
             
             <div class="bg-gray-800 rounded-lg p-6 shadow-lg hover:bg-gray-700 transition-colors cursor-pointer" data-stat="resolvidos" onclick="openTicketsModal('resolved')">
                 <div class="flex items-center">
                     <div class="p-3 rounded-full bg-green-500 bg-opacity-10">
                         <i class="fas fa-check-circle text-green-400 text-xl"></i>
                     </div>
                     <div class="ml-4">
                         <p class="text-sm font-medium text-gray-400">Resolvidos</p>
                         <p class="text-2xl font-semibold text-white" id="ticketsResolvidosCard">0</p>
                     </div>
                 </div>
             </div>
             
             <div class="bg-gray-800 rounded-lg p-6 shadow-lg hover:bg-gray-700 transition-colors cursor-pointer" data-stat="dataSources" onclick="openDataSourcesModal()">
                 <div class="flex items-center">
                     <div class="p-3 rounded-full bg-purple-500 bg-opacity-10">
                         <i class="fas fa-database text-purple-400 text-xl"></i>
                     </div>
                     <div class="ml-4">
                         <p class="text-sm font-medium text-gray-400">Dados Importados</p>
                         <p class="text-2xl font-semibold text-white" id="dataSourcesCard">0</p>
                     </div>
                 </div>
             </div>
         </div>
         
         <!-- Seção de Estatísticas Detalhadas -->
         <div class="bg-gray-800 rounded-lg p-6 shadow-lg mb-6">
             <h3 class="text-lg font-semibold text-blue-400 mb-4">
                 <i class="fas fa-chart-line mr-2"></i>
                 Estatísticas Detalhadas
             </h3>
             <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                 <div class="text-center">
                     <div class="text-2xl font-bold text-green-400" id="avgResolutionTime">0h</div>
                     <div class="text-sm text-gray-400">Tempo Médio de Resolução</div>
                 </div>
                 <div class="text-center">
                     <div class="text-2xl font-bold text-yellow-400" id="criticalTickets">0</div>
                     <div class="text-sm text-gray-400">Tickets Críticos</div>
                 </div>
                 <div class="text-center">
                     <div class="text-2xl font-bold text-red-400" id="highPriorityTickets">0</div>
                     <div class="text-sm text-gray-400">Alta Prioridade</div>
                 </div>
                 <div class="text-center">
                     <div class="text-2xl font-bold text-blue-400" id="activeResponsibles">0</div>
                     <div class="text-sm text-gray-400">Responsáveis Ativos</div>
                 </div>
             </div>
         </div>
         
         <!-- Dashboard Controls -->
         <div class="flex justify-between items-center mb-6">
             <div class="flex items-center space-x-4">
                 <h2 class="text-2xl font-bold text-white">Dashboard</h2>
                 <select id="dashboardSelector" class="bg-gray-700 text-white px-4 py-2 rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none">
                     <option value="main">Dashboard Principal</option>
                 </select>
             </div>
             <div class="flex space-x-3">
                 <button onclick="createNewDashboard()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors">
                     <i class="fas fa-plus"></i>
                     <span>Novo Dashboard</span>
                 </button>
                 <button onclick="deleteCurrentDashboard()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors">
                     <i class="fas fa-trash"></i>
                     <span>Excluir</span>
                 </button>
             </div>
         </div>
         
         <!-- Dashboard Grid -->
         <div id="dashboardGrid" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
            <!-- Gráfico 1: Tickets por Status -->
            <div id="chart1" class="bg-gray-800 rounded-lg p-6 shadow-lg cursor-move">
                <div class="flex justify-between items-center mb-4">
                                             <h3 class="text-lg font-semibold text-blue-400 chart-header">
                             <i class="fas fa-chart-pie mr-2"></i>
                             Tickets por Status
                             <i class="fas fa-info-circle text-blue-500 ml-2 cursor-help" title="Mostra a distribuição dos tickets por status atual (Aberto, Em Andamento, Resolvido, Fechado). Útil para identificar gargalos no processo."></i>
                         </h3>
                         <div class="flex space-x-2">
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('statusChart', 'Tickets por Status')">
                                 <i class="fas fa-edit"></i>
                             </button>
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('statusChart')">
                                 <i class="fas fa-expand"></i>
                             </button>
                         </div>
                </div>
                <canvas id="statusChart" height="200"></canvas>
            </div>

            <!-- Gráfico 2: Tickets por Responsável -->
            <div id="chart2" class="bg-gray-800 rounded-lg p-6 shadow-lg cursor-move">
                <div class="flex justify-between items-center mb-4">
                                             <h3 class="text-lg font-semibold text-green-400 chart-header">
                             <i class="fas fa-users mr-2"></i>
                             Tickets por Responsável
                             <i class="fas fa-info-circle text-green-500 ml-2 cursor-help" title="Exibe a quantidade de tickets por responsável. Ajuda a identificar sobrecarga de trabalho e distribuição de tarefas."></i>
                         </h3>
                         <div class="flex space-x-2">
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('responsavelChart', 'Tickets por Responsável')">
                                 <i class="fas fa-edit"></i>
                             </button>
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('responsavelChart')">
                                 <i class="fas fa-expand"></i>
                             </button>
                         </div>
                </div>
                <canvas id="responsavelChart" height="200"></canvas>
            </div>

            <!-- Gráfico 3: Tempo de Resolução -->
            <div id="chart3" class="bg-gray-800 rounded-lg p-6 shadow-lg cursor-move">
                <div class="flex justify-between items-center mb-4">
                                             <h3 class="text-lg font-semibold text-yellow-400 chart-header">
                             <i class="fas fa-clock mr-2"></i>
                             Tempo de Resolução
                             <i class="fas fa-info-circle text-yellow-500 ml-2 cursor-help" title="Mostra a evolução do tempo médio de resolução ao longo do tempo. Permite identificar tendências de melhoria ou piora no tempo de atendimento."></i>
                         </h3>
                         <div class="flex space-x-2">
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('tempoChart', 'Tempo de Resolução')">
                                 <i class="fas fa-edit"></i>
                             </button>
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('tempoChart')">
                                 <i class="fas fa-expand"></i>
                             </button>
                         </div>
                </div>
                <canvas id="tempoChart" height="200"></canvas>
            </div>

            <!-- Gráfico 4: Tickets por Classificação -->
            <div id="chart4" class="bg-gray-800 rounded-lg p-6 shadow-lg cursor-move">
                <div class="flex justify-between items-center mb-4">
                                             <h3 class="text-lg font-semibold text-red-400 chart-header">
                             <i class="fas fa-exclamation-triangle mr-2"></i>
                             Tickets por Classificação
                             <i class="fas fa-info-circle text-red-500 ml-2 cursor-help" title="Distribui os tickets por nível de prioridade/classificação. Essencial para entender a distribuição de urgência dos atendimentos."></i>
                         </h3>
                         <div class="flex space-x-2">
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('classificacaoChart', 'Tickets por Classificação')">
                                 <i class="fas fa-edit"></i>
                             </button>
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('classificacaoChart')">
                                 <i class="fas fa-expand"></i>
                             </button>
                         </div>
                </div>
                <canvas id="classificacaoChart" height="200"></canvas>
            </div>

            <!-- Gráfico 5: Radar Chart -->
            <div id="chart5" class="bg-gray-800 rounded-lg p-6 shadow-lg cursor-move">
                <div class="flex justify-between items-center mb-4">
                                             <h3 class="text-lg font-semibold text-purple-400 chart-header">
                             <i class="fas fa-chart-radar mr-2"></i>
                             Radar Chart
                             <i class="fas fa-info-circle text-purple-500 ml-2 cursor-help" title="Gráfico radar que apresenta múltiplas métricas de performance em uma visualização única. Permite avaliar o desempenho geral do sistema de atendimento."></i>
                         </h3>
                         <div class="flex space-x-2">
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('radarChart', 'Radar Chart')">
                                 <i class="fas fa-edit"></i>
                             </button>
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('radarChart')">
                                 <i class="fas fa-expand"></i>
                             </button>
                         </div>
                </div>
                <canvas id="radarChart" height="200"></canvas>
            </div>

            <!-- Gráfico 6: Scatter Chart -->
            <div id="chart6" class="bg-gray-800 rounded-lg p-6 shadow-lg cursor-move">
                <div class="flex justify-between items-center mb-4">
                                             <h3 class="text-lg font-semibold text-indigo-400 chart-header">
                             <i class="fas fa-chart-scatter mr-2"></i>
                             Scatter Chart
                             <i class="fas fa-info-circle text-indigo-500 ml-2 cursor-help" title="Mostra a relação entre o tempo de resolução e a prioridade dos tickets. Ajuda a identificar se tickets de alta prioridade estão sendo resolvidos mais rapidamente."></i>
                         </h3>
                         </h3>
                         <div class="flex space-x-2">
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('scatterChart', 'Scatter Chart')">
                                 <i class="fas fa-edit"></i>
                             </button>
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('scatterChart')">
                                 <i class="fas fa-expand"></i>
                             </button>
                         </div>
                </div>
                <canvas id="scatterChart" height="200"></canvas>
            </div>
        </div>
    </main>

             <!-- Sidebar de Informações -->
    <div id="sidebar" class="fixed bottom-4 left-4 bg-gray-800 rounded-lg shadow-lg transition-all duration-300 ease-in-out" style="width: 320px;">
        <!-- Botão de Toggle para Minimizar/Expandir -->
        <div class="absolute -right-3 top-1/2 transform -translate-y-1/2">
            <button id="sidebarToggle" class="bg-gray-700 hover:bg-gray-600 text-white w-6 h-6 rounded-full flex items-center justify-center shadow-lg transition-all duration-200 hover:scale-110">
                <i id="toggleIcon" class="fas fa-chevron-left text-xs"></i>
            </button>
        </div>
        
        <!-- Conteúdo do Sidebar -->
        <div id="sidebarContent" class="p-4">
            <div class="flex items-center space-x-3 mb-3">
                <div id="userAvatar" class="w-10 h-10 rounded-full bg-gray-600 flex items-center justify-center">
                    <i class="fa-solid fa-user text-white text-xl"></i>
                </div>
                <div>
                    <div id="userName" class="font-semibold text-white">João Silva</div>
                    <div id="userRole" class="text-sm text-gray-400">Analista de Suporte</div>
                </div>
            </div>
            
            <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span class="text-gray-400">Total de Tickets:</span>
                    <span id="totalTickets" class="text-white font-semibold">0</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-400">Em Aberto:</span>
                    <span id="ticketsAbertos" class="text-yellow-400 font-semibold">0</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-400">Resolvidos:</span>
                    <span id="ticketsResolvidos" class="text-green-400 font-semibold">0</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-400">Em Atendimento:</span>
                    <span id="ticketsEmAtendimento" class="text-blue-400 font-semibold">0</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-400">Dados Importados:</span>
                    <span id="dataSourcesCount" class="text-purple-400 font-semibold">0</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-400">Tempo Médio:</span>
                    <span id="tempoMedio" class="text-orange-400 font-semibold">0h</span>
                </div>
            </div>
            
            <button id="editProfileBtn" class="w-full mt-3 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm transition-colors duration-200">
                <i class="fas fa-edit mr-2"></i>
                Editar Perfil
            </button>
        </div>
        
        <!-- Sidebar Minimizado -->
        <div id="sidebarMinimized" class="hidden p-2">
            <div class="flex flex-col items-center space-y-3">
                <div id="userAvatarMin" class="w-12 h-12 rounded-full bg-gray-600 flex items-center justify-center cursor-pointer" title="Clique para expandir">
                    <i class="fa-solid fa-user text-white text-xl"></i>
                </div>
                <div class="text-center">
                    <div class="text-xs text-gray-400">Tickets</div>
                    <div id="totalTicketsMin" class="text-white font-bold text-lg">0</div>
                </div>
                <div class="text-center">
                    <div class="text-xs text-gray-400">Abertos</div>
                    <div id="ticketsAbertosMin" class="text-yellow-400 font-bold text-lg">0</div>
                </div>
            </div>
        </div>
    </div>

            <!-- Modal de Upload Excel -->
        <div id="excelModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-gray-800 rounded-lg p-8 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-white">
                        <i class="fas fa-file-excel mr-2 text-green-400"></i>
                        Importar Excel
                    </h3>
                    <button onclick="closeExcelModal()" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-400 mb-2">Arraste e solte seu arquivo Excel aqui</p>
                        <p class="text-sm text-gray-500">ou</p>
                        <input type="file" id="excelFile" accept=".xlsx,.xls" class="hidden">
                        <button onclick="document.getElementById('excelFile').click()" class="mt-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                            Selecionar Arquivo
                        </button>
                    </div>
                    
                    <div id="fileInfo" class="hidden bg-gray-700 rounded p-3">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white font-semibold" id="fileName"></p>
                                <p class="text-sm text-gray-400 mb-2" id="fileSize"></p>
                                <div class="mb-2">
                                    <label class="block text-gray-300 text-sm mb-1">Nome dos Dados:</label>
                                    <input type="text" id="dataSourceName" placeholder="Ex: Tickets Janeiro 2024" class="w-full bg-gray-600 border border-gray-500 rounded px-2 py-1 text-white text-sm">
                                </div>
                            </div>
                            <button onclick="removeFile()" class="text-red-400 hover:text-red-300">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="closeExcelModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button id="importBtn" onclick="importExcel()" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded" disabled>
                            <i class="fas fa-upload mr-2"></i>
                            Importar
                        </button>
                    </div>
                </div>
            </div>
        </div>

         <!-- Modal de Configurações de Gráficos -->
     <div id="chartSettingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
         <div class="bg-gray-800 rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
             <div class="flex justify-between items-center mb-6">
                 <h3 class="text-xl font-semibold text-white">
                     <i class="fas fa-chart-line mr-2 text-blue-400"></i>
                     <span id="chartSettingsTitle">Configurações do Gráfico</span>
                 </h3>
                 <button onclick="closeChartSettingsModal()" class="text-gray-400 hover:text-white">
                     <i class="fas fa-times"></i>
                 </button>
             </div>
             
             <div class="space-y-6">
                 <!-- Configurações de Tipo de Gráfico -->
                 <div>
                     <h4 class="text-lg font-semibold text-indigo-400 mb-3">
                         <i class="fas fa-chart-line mr-2"></i>
                         Tipo de Gráfico
                     </h4>
                     <div class="grid grid-cols-2 gap-4">
                         <div>
                             <label class="block text-gray-300 mb-2">Tipo do Gráfico</label>
                             <select id="chartType" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="bar">Barras</option>
                                 <option value="line">Linha</option>
                                 <option value="pie">Pizza</option>
                                 <option value="doughnut">Rosca</option>
                                 <option value="radar">Radar</option>
                                 <option value="scatter">Dispersão</option>
                                 <option value="bubble">Bolhas</option>
                                 <option value="polarArea">Área Polar</option>
                             </select>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Descrição</label>
                             <div id="chartTypeDescription" class="text-sm text-gray-400 bg-gray-700 p-3 rounded border border-gray-600">
                                 Selecione um tipo para ver a descrição
                             </div>
                         </div>
                     </div>
                 </div>
                 
                 <!-- Configurações de Cores -->
                 <div>
                     <h4 class="text-lg font-semibold text-blue-400 mb-3">
                         <i class="fas fa-palette mr-2"></i>
                         Cores e Estilo
                     </h4>
                     <div class="grid grid-cols-2 gap-4">
                         <div>
                             <label class="block text-gray-300 mb-2">Cor de Fundo</label>
                             <input type="color" id="chartBgColor" class="w-full h-10 rounded border border-gray-600">
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Cor da Borda</label>
                             <input type="color" id="chartBorderColor" class="w-full h-10 rounded border border-gray-600">
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Espessura da Borda</label>
                             <input type="range" id="chartBorderWidth" min="0" max="10" value="2" class="w-full">
                             <span id="borderWidthValue" class="text-sm text-gray-400">2px</span>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Transparência</label>
                             <input type="range" id="chartOpacity" min="0" max="100" value="80" class="w-full">
                             <span id="opacityValue" class="text-sm text-gray-400">80%</span>
                         </div>
                     </div>
                 </div>
                 
                 <!-- Configurações de Dados -->
                 <div>
                     <h4 class="text-lg font-semibold text-green-400 mb-3">
                         <i class="fas fa-database mr-2"></i>
                         Dados e Valores
                     </h4>
                     <div class="grid grid-cols-2 gap-4">
                         <div>
                             <label class="block text-gray-300 mb-2">Mostrar Valores</label>
                             <select id="chartShowValues" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="true">Sim</option>
                                 <option value="false">Não</option>
                             </select>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Formato dos Valores</label>
                             <select id="chartValueFormat" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="number">Número</option>
                                 <option value="percentage">Porcentagem</option>
                                 <option value="currency">Moeda</option>
                             </select>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Casas Decimais</label>
                             <input type="number" id="chartDecimals" min="0" max="4" value="2" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Agrupar Dados</label>
                             <select id="chartGroupData" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="none">Nenhum</option>
                                 <option value="byMonth">Por Mês</option>
                                 <option value="byQuarter">Por Trimestre</option>
                                 <option value="byYear">Por Ano</option>
                             </select>
                         </div>
                     </div>
                 </div>
                 
                 <!-- Configurações de Layout -->
                 <div>
                     <h4 class="block text-lg font-semibold text-yellow-400 mb-3">
                         <i class="fas fa-layout mr-2"></i>
                         Layout e Posicionamento
                     </h4>
                     <div class="grid grid-cols-2 gap-4">
                         <div>
                             <label class="block text-gray-300 mb-2">Posição da Legenda</label>
                             <select id="chartLegendPosition" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="top">Superior</option>
                                 <option value="bottom">Inferior</option>
                                 <option value="left">Esquerda</option>
                                 <option value="right">Direita</option>
                             </select>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Mostrar Grade</label>
                             <select id="chartShowGrid" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="true">Sim</option>
                                 <option value="false">Não</option>
                             </select>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Altura do Gráfico</label>
                             <input type="range" id="chartHeight" min="150" max="400" value="200" class="w-full">
                             <span id="heightValue" class="text-sm text-gray-400">200px</span>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Animação</label>
                             <select id="chartAnimation" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="true">Ativada</option>
                                 <option value="false">Desativada</option>
                             </select>
                         </div>
                     </div>
                 </div>
                 
                 <!-- Configurações de Filtros -->
                 <div>
                     <h4 class="text-lg font-semibold text-purple-400 mb-3">
                         <i class="fas fa-filter mr-2"></i>
                         Filtros e Limites
                     </h4>
                     <div class="grid grid-cols-2 gap-4">
                         <div>
                             <label class="block text-gray-300 mb-2">Limite de Itens</label>
                             <input type="number" id="chartItemLimit" min="5" max="50" value="10" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Filtrar por Status</label>
                             <select id="chartStatusFilter" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="all">Todos</option>
                                 <option value="aberto">Aberto</option>
                                 <option value="em-atendimento">Em Atendimento</option>
                                 <option value="resolvido">Resolvido</option>
                                 <option value="fechado">Fechado</option>
                             </select>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Filtrar por Prioridade</label>
                             <select id="chartPriorityFilter" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="all">Todas</option>
                                 <option value="crítico">Crítico</option>
                                 <option value="alto">Alto</option>
                                 <option value="médio">Médio</option>
                                 <option value="baixo">Baixo</option>
                             </select>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Período de Tempo</label>
                             <select id="chartTimeFilter" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="all">Todo Período</option>
                                 <option value="today">Hoje</option>
                                 <option value="week">Esta Semana</option>
                                 <option value="month">Este Mês</option>
                                 <option value="quarter">Este Trimestre</option>
                                 <option value="year">Este Ano</option>
                             </select>
                         </div>
                     </div>
                 </div>
             </div>
             
             <div class="flex space-x-3 mt-8">
                 <button onclick="closeChartSettingsModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
                     Cancelar
                 </button>
                 <button onclick="applyChartSettings()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                     <i class="fas fa-save mr-2"></i>
                     Aplicar Configurações
                 </button>
                 <button onclick="resetChartSettings()" class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">
                     <i class="fas fa-undo mr-2"></i>
                     Restaurar Padrão
                 </button>
             </div>
         </div>
     </div>

     <!-- Modal de Configurações -->
     <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-white">
                    <i class="fas fa-cog mr-2 text-blue-400"></i>
                    Configurações
                </h3>
                <button onclick="closeSettingsModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-300 mb-2">Nome</label>
                    <input type="text" id="profileName" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                </div>
                
                <div>
                    <label class="block text-gray-300 mb-2">Cargo</label>
                    <input type="text" id="profileRole" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                </div>
                
                <div>
                    <label class="block text-gray-300 mb-2">Foto de Perfil</label>
                    <input type="file" id="profilePicture" accept="image/*" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="closeSettingsModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
                        Cancelar
                    </button>
                    <button onclick="saveProfile()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                        <i class="fas fa-save mr-2"></i>
                        Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para visualizar tickets -->
    <div id="ticketsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-hidden">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-xl font-semibold text-gray-800" id="ticketsModalTitle">Tickets</h3>
                    <button onclick="closeTicketsModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <!-- Filtros -->
                <div class="p-4 bg-gray-50 border-b">
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Status</label>
                            <select id="statusFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Todos</option>
                                <option value="Aberto">Aberto</option>
                                <option value="Em Andamento">Em Andamento</option>
                                <option value="Resolvido">Resolvido</option>
                                <option value="Fechado">Fechado</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Responsável</label>
                            <input type="text" id="responsavelFilter" placeholder="Digite o nome..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Cliente</label>
                            <input type="text" id="clienteFilter" placeholder="Digite o cliente..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Dados</label>
                        <select id="dataSourceFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Todos</option>
                        </select>
                        </div>
                    </div>
                    <div class="mt-4 flex justify-between items-center">
                        <button onclick="applyFilters()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                            <i class="fas fa-filter mr-2"></i>Aplicar Filtros
                        </button>
                        <button onclick="clearFilters()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                            <i class="fas fa-times mr-2"></i>Limpar Filtros
                        </button>
                    </div>
                </div>
                
                <!-- Tabela de tickets -->
                <div class="overflow-x-auto max-h-[60vh]">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('numero')">
                                        Número <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('abertoEm')">
                                        Aberto Em <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('responsavel')">
                                        Responsável <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('cliente')">
                                        Cliente <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('assunto')">
                                        Assunto <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('tempoVida')">
                                        Tempo (h) <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('status')">
                                        Status <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('dataSource')">
                                        Dados <i class="fas fa-sort ml-1"></i>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="ticketsTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Dados serão inseridos aqui -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="p-4 border-t bg-gray-50">
                        <div class="flex justify-between items-center">
                            <span id="ticketsCount" class="text-sm text-gray-600">0 tickets encontrados</span>
                            <div class="flex space-x-2">
                                <button onclick="exportToExcel()" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">
                                    <i class="fas fa-file-excel mr-2"></i>Exportar Excel
                                </button>
                                <button onclick="closeTicketsModal()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                                    Fechar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Dados Importados -->
    <div id="dataSourcesModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-xl font-semibold text-gray-800">Dados Importados</h3>
                    <button onclick="closeDataSourcesModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="p-6">
                    <div class="mb-4">
                        <button onclick="showAddDataSourceForm()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                            <i class="fas fa-plus mr-2"></i>Adicionar Dados
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Arquivo Original</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tamanho</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Registros</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data Upload</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="dataSourcesTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Dados serão inseridos aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar Dados -->
    <div id="editDataSourceModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-xl font-semibold text-gray-800">Editar Dados</h3>
                    <button onclick="closeEditDataSourceModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="p-6">
                    <form id="editDataSourceForm">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome dos Dados</label>
                            <input type="text" id="editDataSourceName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div class="flex justify-end space-x-3">
                            <button type="button" onclick="closeEditDataSourceModal()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                                Cancelar
                            </button>
                            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                                Salvar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de informações do gráfico -->
    <div id="chartInfoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-xl font-semibold text-gray-800" id="chartInfoTitle">Informações do Gráfico</h3>
                    <button onclick="closeChartInfoModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div id="chartInfoContent" class="text-gray-700">
                        <!-- Conteúdo será inserido dinamicamente -->
                    </div>
                </div>
                <div class="p-6 border-t">
                    <button onclick="closeChartInfoModal()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                        Entendi
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para nome do novo dashboard -->
    <div id="newDashboardNameModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-xl font-semibold text-gray-800">
                        <i class="fas fa-plus-circle mr-2 text-blue-500"></i>
                        Novo Dashboard
                    </h3>
                    <button onclick="closeNewDashboardNameModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div class="mb-4">
                        <label for="newDashboardName" class="block text-sm font-medium text-gray-700 mb-2">
                            Nome do Dashboard
                        </label>
                        <input type="text" id="newDashboardName" 
                               placeholder="Ex: Dashboard de Vendas" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div class="text-sm text-gray-600 mb-4">
                        <i class="fas fa-info-circle mr-1"></i>
                        Escolha um nome descritivo para identificar facilmente este dashboard.
                    </div>
                </div>
                <div class="p-6 border-t">
                    <div class="flex space-x-3">
                        <button onclick="closeNewDashboardNameModal()" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400">
                            Cancelar
                        </button>
                        <button onclick="proceedToChartSelection()" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                            Próximo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para seleção de gráficos -->
    <div id="chartSelectionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-xl font-semibold text-gray-800">
                        <i class="fas fa-chart-bar mr-2 text-green-500"></i>
                        Selecionar Gráficos
                    </h3>
                    <button onclick="closeChartSelectionModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div class="mb-4">
                        <p class="text-sm text-gray-600 mb-3">
                            <i class="fas fa-mouse-pointer mr-1"></i>
                            Clique nos gráficos que deseja incluir no dashboard. Você pode selecionar múltiplos gráficos.
                        </p>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-700">
                                <span id="selectedChartsCount">0</span> gráficos selecionados
                            </span>
                            <button onclick="selectAllCharts()" class="text-sm text-blue-600 hover:text-blue-800">
                                Selecionar Todos
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="chartSelectionGrid">
                        <!-- Gráficos serão inseridos dinamicamente -->
                    </div>
                </div>
                <div class="p-6 border-t">
                    <div class="flex space-x-3">
                        <button onclick="closeChartSelectionModal()" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400">
                            Voltar
                        </button>
                        <button onclick="createDashboardWithCharts()" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">
                            <i class="fas fa-check mr-2"></i>
                            Criar Dashboard
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sistema de Tutorial
        let tutorialStep = 0;
        let tutorialActive = false;
        
        // Sistema de Dados
        let dataSources = [];
        let currentDataSource = null;
        const tutorialSteps = [
            {
                id: 'welcome',
                title: 'Bem-vindo ao Anydesk Control!',
                description: 'Este é um sistema de Business Intelligence para análise de tickets. Vamos explorar todas as funcionalidades.',
                target: null,
                position: 'center',
                icon: 'fas fa-graduation-cap'
            },
            {
                id: 'import-excel',
                title: 'Importação de Arquivos Excel',
                description: 'Clique aqui para importar seus dados de tickets em formato Excel. O sistema aceita arquivos .xlsx e .xls.',
                target: '#importExcelBtn',
                position: 'bottom',
                icon: 'fas fa-file-excel'
            },
            {
                id: 'summary-cards',
                title: 'Cards de Resumo Interativos',
                description: 'Estes cards mostram estatísticas importantes. Clique em qualquer um para ver os detalhes dos tickets.',
                target: '[data-stat="total"]',
                position: 'bottom',
                icon: 'fas fa-chart-pie'
            },
            {
                id: 'tickets-modal',
                title: 'Visualização Detalhada de Tickets',
                description: 'Ao clicar nos cards, você abre um modal com todos os tickets. Use os filtros para encontrar informações específicas.',
                target: '#ticketsModal',
                position: 'center',
                icon: 'fas fa-table'
            },
            {
                id: 'data-sources-card',
                title: 'Dados Importados',
                description: 'Este card mostra quantos arquivos Excel foram importados. Clique para gerenciar suas fontes de dados.',
                target: '[data-stat="dataSources"]',
                position: 'bottom',
                icon: 'fas fa-database'
            },
            {
                id: 'data-sources-management',
                title: 'Gerenciamento de Dados Importados',
                description: 'Aqui você pode editar nomes, visualizar detalhes e excluir fontes de dados. Cada arquivo importado vira uma fonte de dados.',
                target: '#dataSourcesModal',
                position: 'center',
                icon: 'fas fa-cogs'
            },
            {
                id: 'chart-info',
                title: 'Informações dos Gráficos',
                description: 'Clique no ícone "i" ao lado do título de cada gráfico para ver uma explicação detalhada do que ele representa.',
                target: '.fa-info-circle',
                position: 'left',
                icon: 'fas fa-info-circle'
            },
            {
                id: 'dashboard-overview',
                title: 'Dashboard Interativo',
                description: 'Aqui você encontra 6 gráficos diferentes que se atualizam automaticamente com seus dados.',
                target: '.grid',
                position: 'top',
                icon: 'fas fa-chart-bar'
            },
            {
                id: 'chart-drag',
                title: 'Gráficos Arrastáveis',
                description: 'Você pode arrastar e reorganizar os gráficos conforme sua preferência. Clique e arraste para mover.',
                target: '#chart1',
                position: 'bottom',
                icon: 'fas fa-arrows-alt'
            },
            {
                id: 'chart-edit',
                title: 'Edição de Gráficos',
                description: 'Clique no ícone de edição para personalizar cores, títulos e configurações do gráfico.',
                target: '#chart1 .fa-edit',
                position: 'left',
                icon: 'fas fa-edit'
            },
            {
                id: 'chart-settings',
                title: 'Configurações Avançadas',
                description: 'Nas configurações, você pode alterar o tipo do gráfico, cores, transparência, legendas e muito mais.',
                target: '#chart1 .fa-edit',
                position: 'left',
                icon: 'fas fa-cog'
            },
            {
                id: 'chart-type-change',
                title: 'Mudança de Tipo de Gráfico',
                description: 'Nas configurações, você pode alterar o tipo do gráfico (barras, linha, pizza, radar, etc.) mantendo os mesmos dados.',
                target: '#chart1 .fa-edit',
                position: 'left',
                icon: 'fas fa-exchange-alt'
            },
            {
                id: 'sidebar-toggle',
                title: 'Sidebar Minimizável',
                description: 'Este sidebar pode ser minimizado para economizar espaço. Clique no botão com seta para alternar entre expandido e minimizado.',
                target: '#sidebarToggle',
                position: 'left',
                icon: 'fas fa-compress-alt'
            },
            {
                id: 'chart-expand',
                title: 'Expandir Gráficos',
                description: 'Use o ícone de expandir para ver o gráfico em tela cheia para melhor análise. Clique novamente para voltar ao tamanho normal.',
                target: '#chart1 .fa-expand',
                position: 'left',
                icon: 'fas fa-expand'
            },
            {
                id: 'data-grouping',
                title: 'Agrupamento de Dados',
                description: 'Os dados são automaticamente agrupados por status, responsável, classificação e outros critérios.',
                target: '#chart2',
                position: 'top',
                icon: 'fas fa-layer-group'
            },
            {
                id: 'priority-sorting',
                title: 'Ordenação por Prioridade',
                description: 'Os tickets são ordenados automaticamente por classificação: crítico, alto, médio, baixo.',
                target: '#chart4',
                position: 'top',
                icon: 'fas fa-sort-amount-down'
            },
            {
                id: 'profile-section',
                title: 'Seção de Perfil',
                description: 'Aqui você pode ver suas informações e estatísticas pessoais de tickets.',
                target: '.fixed.bottom-4.left-4',
                position: 'right',
                icon: 'fas fa-user'
            },
            {
                id: 'edit-profile',
                title: 'Editar Perfil',
                description: 'Clique aqui para alterar seu nome, cargo e foto de perfil.',
                target: '#editProfileBtn',
                position: 'top',
                icon: 'fas fa-user-edit'
            },
            {
                id: 'tutorial-button',
                title: 'Acesso ao Tutorial',
                description: 'Você pode acessar este tutorial a qualquer momento clicando neste botão.',
                target: '#tutorialBtn',
                position: 'bottom',
                icon: 'fas fa-graduation-cap'
            },
            {
                id: 'dashboard-management',
                title: 'Gerenciamento de Dashboards',
                description: 'Use este seletor para alternar entre diferentes dashboards. Você pode criar dashboards personalizados com gráficos específicos.',
                target: '#dashboardSelector',
                position: 'bottom',
                icon: 'fas fa-columns'
            },
            {
                id: 'create-dashboard',
                title: 'Criar Novo Dashboard',
                description: 'Clique aqui para criar um novo dashboard personalizado. Você poderá escolher o nome e selecionar quais gráficos incluir.',
                target: '#createDashboardBtn',
                position: 'bottom',
                icon: 'fas fa-plus-circle'
            },
            {
                id: 'dashboard-customization',
                title: 'Personalização de Dashboards',
                description: 'Cada dashboard pode ter uma combinação única de gráficos. Use o botão "Adicionar Gráfico" para incluir mais visualizações.',
                target: '#addChartBtn',
                position: 'top',
                icon: 'fas fa-palette'
            },
            {
                id: 'completion',
                title: 'Tutorial Concluído!',
                description: 'Parabéns! Você conhece todas as funcionalidades do Anydesk Control. Agora pode começar a usar o sistema com confiança.',
                target: null,
                position: 'center',
                icon: 'fas fa-check-circle'
            }
        ];

        // Inicializar tutorial
        function initTutorial() {
            // Verificar se é a primeira visita
            if (!localStorage.getItem('tutorialCompleted')) {
                showTutorialModal();
            }
        }

        // Mostrar modal de início do tutorial
        function showTutorialModal() {
            const modal = document.getElementById('tutorialModal');
            const overlay = document.getElementById('tutorialOverlay');
            
            if (modal) modal.style.display = 'block';
            if (overlay) overlay.style.display = 'block';
        }

        // Iniciar tutorial
        function startTutorial() {
            const modal = document.getElementById('tutorialModal');
            if (modal) modal.style.display = 'none';
            tutorialActive = true;
            tutorialStep = 0;
            
            // Melhorar experiência do tutorial
            enhanceTutorialExperience();
            
            showTutorialStep();
        }

        // Pular tutorial
        function skipTutorial() {
            const modal = document.getElementById('tutorialModal');
            if (modal) modal.style.display = 'none';
            
            const overlay = document.getElementById('tutorialOverlay');
            if (overlay) {
                overlay.style.display = 'none';
                overlay.classList.remove('active');
            }
            
            const progressContainer = document.getElementById('tutorialProgress');
            const skipContainer = document.getElementById('tutorialSkip');
            
            if (progressContainer) progressContainer.style.display = 'none';
            if (skipContainer) skipContainer.style.display = 'none';
            
            tutorialActive = false;
            localStorage.setItem('tutorialCompleted', 'true');
            removeTutorialHighlights();
            
            // Remover tooltip atual
            const existingTooltip = document.querySelector('.tutorial-step');
            if (existingTooltip) {
                existingTooltip.remove();
            }
            
            // Remover indicadores do tutorial
            removeTutorialIndicators();
        }

        // Mostrar passo do tutorial
        function showTutorialStep() {
            if (!tutorialActive || tutorialStep >= tutorialSteps.length) {
                completeTutorial();
                return;
            }

            const step = tutorialSteps[tutorialStep];
            
            // Atualizar progresso
            const progressElement = document.getElementById('tutorialStepText');
            if (progressElement) {
                progressElement.textContent = `Passo ${tutorialStep + 1} de ${tutorialSteps.length}`;
            }
            
            const progressContainer = document.getElementById('tutorialProgress');
            const skipContainer = document.getElementById('tutorialSkip');
            
            if (progressContainer) progressContainer.style.display = 'block';
            if (skipContainer) skipContainer.style.display = 'block';
            
            // Mostrar overlay
            const overlay = document.getElementById('tutorialOverlay');
            if (overlay) {
                overlay.style.display = 'block';
                overlay.classList.add('active');
                // Restaurar opacidade após transição
                setTimeout(() => {
                    overlay.style.opacity = '0.8';
                }, 100);
            }
            
            // Remover highlights anteriores
            removeTutorialHighlights();
            
            // Criar tooltip do tutorial
            createTutorialTooltip(step);
            
            // Adicionar highlight ao elemento alvo com melhorias lógicas
            if (step.target) {
                const targetElement = document.querySelector(step.target);
                if (targetElement) {
                    // Aplicar highlight e trazer para frente
                    targetElement.classList.add('tutorial-highlight');
                    bringElementToFront(targetElement);
                    
                    // Garantir visibilidade do elemento
                    ensureElementVisibility(targetElement);
                    
                    // Adicionar classes específicas baseadas no contexto
                    if (targetElement.closest('.modal')) {
                        targetElement.classList.add('modal-element');
                    } else if (targetElement.closest('canvas') || targetElement.closest('.chart-container')) {
                        targetElement.classList.add('chart-element');
                    } else if (targetElement.tagName === 'BUTTON' || targetElement.closest('button')) {
                        targetElement.classList.add('button-element');
                    }
                } else {
                    // Tratar casos especiais para modais que podem não estar visíveis
                    handleSpecialTutorialTargets(step);
                }
            }
        }

        // Criar tooltip do tutorial
        function createTutorialTooltip(step) {
            // Remover tooltips anteriores
            const existingTooltip = document.querySelector('.tutorial-step');
            if (existingTooltip) {
                existingTooltip.remove();
            }
            
            const tooltip = document.createElement('div');
            tooltip.className = 'tutorial-step';
            tooltip.innerHTML = `
                <div class="tutorial-icon">
                    <i class="${step.icon}"></i>
                </div>
                <div class="tutorial-title">${step.title}</div>
                <div class="tutorial-description">${step.description}</div>
                <div class="tutorial-arrow ${step.position}"></div>
                <div class="flex justify-between mt-4">
                    <button class="tutorial-button secondary" onclick="previousTutorialStep()" ${tutorialStep === 0 ? 'disabled' : ''}>
                        <i class="fas fa-chevron-left mr-2"></i>
                        Anterior
                    </button>
                    <button class="tutorial-button" onclick="nextTutorialStep()">
                        ${tutorialStep === tutorialSteps.length - 1 ? 'Concluir' : 'Próximo'}
                        <i class="fas fa-chevron-right ml-2"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(tooltip);
            
            // Posicionar tooltip
            positionTutorialTooltip(tooltip, step);
        }

        // Tratar casos especiais para alvos do tutorial
        function handleSpecialTutorialTargets(step) {
            let targetElement = null;
            
            switch (step.id) {
                case 'tickets-modal':
                    // Para o modal de tickets, destacar um card de resumo
                    targetElement = document.querySelector('[data-stat="total"]');
                    break;
                case 'data-sources-management':
                    // Para o modal de dados, destacar o card de dados importados
                    targetElement = document.querySelector('[data-stat="dataSources"]');
                    break;
                case 'chart-info':
                    // Para informações dos gráficos, destacar o primeiro ícone de info
                    targetElement = document.querySelector('.fa-info-circle');
                    break;
                case 'dashboard-management':
                    // Para gerenciamento de dashboards, destacar o seletor
                    targetElement = document.getElementById('dashboardSelector');
                    break;
                case 'create-dashboard':
                    // Para criação de dashboard, destacar o botão
                    targetElement = document.getElementById('createDashboardBtn');
                    break;
                case 'dashboard-customization':
                    // Para personalização, destacar o botão de adicionar gráfico
                    targetElement = document.querySelector('#addChartBtn, .fa-plus');
                    break;
                case 'chart-type-change':
                    // Para mudança de tipo de gráfico, destacar o primeiro botão de edição
                    targetElement = document.querySelector('#chart1 .fa-edit');
                    break;
                case 'chart-settings':
                    // Para configurações de gráfico, destacar o primeiro botão de edição
                    targetElement = document.querySelector('#chart1 .fa-edit');
                    break;
                case 'summary-cards':
                    // Para cards de resumo, destacar o primeiro card
                    targetElement = document.querySelector('[data-stat="total"]');
                    break;
                case 'data-sources-card':
                    // Para card de dados importados, destacar o card específico
                    targetElement = document.querySelector('[data-stat="dataSources"]');
                    break;
            }
            
            if (targetElement) {
                // Aplicar highlight e trazer para frente com melhorias
                targetElement.classList.add('tutorial-highlight');
                bringElementToFront(targetElement);
                
                // Garantir visibilidade do elemento
                ensureElementVisibility(targetElement);
                
                // Adicionar efeito de destaque especial para elementos especiais
                if (step.id === 'tickets-modal' || step.id === 'data-sources-management') {
                    targetElement.classList.add('modal-element');
                } else if (step.id.includes('chart')) {
                    targetElement.classList.add('chart-element');
                } else if (step.id.includes('dashboard') || step.id.includes('create')) {
                    targetElement.classList.add('button-element');
                }
            }
        }

        // Posicionar tooltip
        function positionTutorialTooltip(tooltip, step) {
            if (!step.target) {
                // Centralizar se não há alvo
                tooltip.style.top = '50%';
                tooltip.style.left = '50%';
                tooltip.style.transform = 'translate(-50%, -50%)';
                return;
            }
            
            const targetElement = document.querySelector(step.target);
            if (!targetElement) return;
            
            const targetRect = targetElement.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
            
            let top, left;
            
            switch (step.position) {
                case 'top':
                    top = targetRect.top - tooltipRect.height - 20;
                    left = targetRect.left + (targetRect.width / 2) - (tooltipRect.width / 2);
                    break;
                case 'bottom':
                    top = targetRect.bottom + 20;
                    left = targetRect.left + (targetRect.width / 2) - (tooltipRect.width / 2);
                    break;
                case 'left':
                    top = targetRect.top + (targetRect.height / 2) - (tooltipRect.height / 2);
                    left = targetRect.left - tooltipRect.width - 20;
                    break;
                case 'right':
                    top = targetRect.top + (targetRect.height / 2) - (tooltipRect.height / 2);
                    left = targetRect.right + 20;
                    break;
                default:
                    top = targetRect.top + (targetRect.height / 2) - (tooltipRect.height / 2);
                    left = targetRect.left + (targetRect.width / 2) - (tooltipRect.width / 2);
            }
            
            // Ajustar para não sair da tela
            if (top < 20) top = 20;
            if (left < 20) left = 20;
            if (top + tooltipRect.height > window.innerHeight - 20) {
                top = window.innerHeight - tooltipRect.height - 20;
            }
            if (left + tooltipRect.width > window.innerWidth - 20) {
                left = window.innerWidth - tooltipRect.width - 20;
            }
            
            tooltip.style.top = top + 'px';
            tooltip.style.left = left + 'px';
            
            // Ajustar posição da seta para ficar centralizada
            setTimeout(() => {
                const arrow = tooltip.querySelector('.tutorial-arrow');
                if (arrow && step.target) {
                    const targetRect = targetElement.getBoundingClientRect();
                    const tooltipRect = tooltip.getBoundingClientRect();
                    
                    if (step.position === 'top' || step.position === 'bottom') {
                        const arrowLeft = targetRect.left + (targetRect.width / 2) - tooltipRect.left - 10;
                        arrow.style.left = Math.max(10, Math.min(arrowLeft, tooltipRect.width - 20)) + 'px';
                    } else if (step.position === 'left' || step.position === 'right') {
                        const arrowTop = targetRect.top + (targetRect.height / 2) - tooltipRect.top - 10;
                        arrow.style.top = Math.max(10, Math.min(arrowTop, tooltipRect.height - 20)) + 'px';
                    }
                    
                    // Adicionar efeito de brilho à seta
                    arrow.style.filter = 'drop-shadow(0 0 8px rgba(59, 130, 246, 0.8))';
                }
            }, 50);
        }

        // Próximo passo do tutorial
        function nextTutorialStep() {
            if (tutorialStep < tutorialSteps.length - 1) {
                // Adicionar efeito de transição
                addTutorialTransitionEffect();
                
                setTimeout(() => {
                    tutorialStep++;
                    showTutorialStep();
                    
                    // Atualizar indicadores
                    updateTutorialIndicators();
                }, 300);
            } else {
                completeTutorial();
            }
        }

        // Passo anterior do tutorial
        function previousTutorialStep() {
            if (tutorialStep > 0) {
                // Adicionar efeito de transição
                addTutorialTransitionEffect();
                
                setTimeout(() => {
                    tutorialStep--;
                    showTutorialStep();
                    
                    // Atualizar indicadores
                    updateTutorialIndicators();
                }, 300);
            }
        }

        // Atualizar todos os indicadores do tutorial
        function updateTutorialIndicators() {
            const progressBar = document.querySelector('.tutorial-progress-bar');
            const stepIndicator = document.querySelector('.tutorial-step-indicator');
            
            if (progressBar) updateTutorialProgressBar(progressBar);
            if (stepIndicator) updateTutorialStepIndicator(stepIndicator);
        }

        // Adicionar efeito de transição entre passos
        function addTutorialTransitionEffect() {
            const tooltip = document.querySelector('.tutorial-step');
            if (tooltip) {
                tooltip.style.transform = 'scale(0.8)';
                tooltip.style.opacity = '0';
                tooltip.style.transition = 'all 0.3s ease';
            }
            
            // Adicionar efeito de fade no overlay
            const overlay = document.getElementById('tutorialOverlay');
            if (overlay) {
                overlay.style.opacity = '0.3';
                overlay.style.transition = 'opacity 0.3s ease';
            }
        }

        // Completar tutorial
        function completeTutorial() {
            tutorialActive = false;
            const overlay = document.getElementById('tutorialOverlay');
            if (overlay) {
                overlay.style.display = 'none';
                overlay.classList.remove('active');
            }
            
            const progressContainer = document.getElementById('tutorialProgress');
            const skipContainer = document.getElementById('tutorialSkip');
            
            if (progressContainer) progressContainer.style.display = 'none';
            if (skipContainer) skipContainer.style.display = 'none';
            
            removeTutorialHighlights();
            localStorage.setItem('tutorialCompleted', 'true');
            
            // Remover tooltip atual
            const existingTooltip = document.querySelector('.tutorial-step');
            if (existingTooltip) {
                existingTooltip.remove();
            }
            
            // Remover indicadores do tutorial
            removeTutorialIndicators();
            
            // Mostrar mensagem de conclusão
            showCompletionMessage();
        }

        // Remover indicadores do tutorial
        function removeTutorialIndicators() {
            const progressBar = document.querySelector('.tutorial-progress-bar');
            const stepIndicator = document.querySelector('.tutorial-step-indicator');
            
            if (progressBar) progressBar.remove();
            if (stepIndicator) stepIndicator.remove();
        }

        // Remover highlights do tutorial
        function removeTutorialHighlights() {
            document.querySelectorAll('.tutorial-highlight').forEach(el => {
                el.classList.remove('tutorial-highlight');
                el.classList.remove('modal-element', 'chart-element', 'button-element');
                
                // Restaurar z-index original se foi alterado
                if (el.dataset.originalZIndex) {
                    el.style.zIndex = el.dataset.originalZIndex;
                    delete el.dataset.originalZIndex;
                }
                
                // Restaurar posição original se foi alterada
                if (el.dataset.originalPosition) {
                    el.style.position = el.dataset.originalPosition;
                    delete el.dataset.originalPosition;
                }
                
                // Restaurar transição original
                el.style.transition = '';
                
                // Remover filtros aplicados
                el.style.filter = '';
            });
            
            // Remover efeitos especiais
            removeTutorialSpecialEffects();
        }

        // Trazer elemento para frente durante o tutorial
        function bringElementToFront(element) {
            if (element) {
                // Salvar z-index original se ainda não foi salvo
                if (!element.dataset.originalZIndex) {
                    element.dataset.originalZIndex = element.style.zIndex || 'auto';
                }
                
                // Salvar posição original se ainda não foi salva
                if (!element.dataset.originalPosition) {
                    element.dataset.originalPosition = element.style.position || 'static';
                }
                
                // Definir posição relativa se necessário para z-index funcionar
                if (element.style.position === 'static') {
                    element.style.position = 'relative';
                }
                
                // Adicionar classes específicas baseadas no tipo de elemento
                if (element.closest('.modal')) {
                    element.classList.add('modal-element');
                } else if (element.closest('canvas') || element.closest('.chart-container')) {
                    element.classList.add('chart-element');
                } else if (element.tagName === 'BUTTON' || element.closest('button')) {
                    element.classList.add('button-element');
                }
                
                // Adicionar efeito de destaque adicional
                element.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                
                // Adicionar efeitos especiais
                addTutorialSpecialEffects(element);
                
                // Garantir que o elemento esteja visível
                ensureElementVisibility(element);
            }
        }

        // Scroll suave para o elemento
        function scrollToElement(element) {
            if (element && typeof element.scrollIntoView === 'function') {
                // Verificar se o elemento está em um modal ou container com scroll
                const scrollableParent = findScrollableParent(element);
                if (scrollableParent && scrollableParent !== document.body) {
                    // Scroll dentro do container pai
                    const elementTop = element.offsetTop;
                    const containerTop = scrollableParent.scrollTop;
                    const containerHeight = scrollableParent.clientHeight;
                    
                    if (elementTop < containerTop || elementTop > containerTop + containerHeight) {
                        scrollableParent.scrollTo({
                            top: elementTop - containerHeight / 2,
                            behavior: 'smooth'
                        });
                    }
                } else {
                    // Scroll da página principal
                    element.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center',
                        inline: 'center'
                    });
                }
            }
        }

        // Encontrar o primeiro pai com scroll
        function findScrollableParent(element) {
            let parent = element.parentElement;
            while (parent && parent !== document.body) {
                const style = window.getComputedStyle(parent);
                if (style.overflow === 'auto' || style.overflow === 'scroll' || 
                    style.overflowY === 'auto' || style.overflowY === 'scroll') {
                    return parent;
                }
                parent = parent.parentElement;
            }
            return document.body;
        }

        // Verificar se o elemento está visível na viewport
        function isElementInViewport(element) {
            if (!element) return false;
            
            const rect = element.getBoundingClientRect();
            return (
                rect.top >= 0 &&
                rect.left >= 0 &&
                rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                rect.right <= (window.innerWidth || document.documentElement.clientWidth)
            );
        }

        // Adicionar efeito de destaque especial para elementos do tutorial
        function addTutorialSpecialEffects(element) {
            if (!element) return;
            
            // Adicionar classe para efeitos especiais
            element.classList.add('tutorial-special-effect');
            
            // Adicionar efeito de brilho
            const glowEffect = document.createElement('div');
            glowEffect.className = 'tutorial-glow-effect';
            glowEffect.style.cssText = `
                position: absolute;
                top: -20px;
                left: -20px;
                right: -20px;
                bottom: -20px;
                background: radial-gradient(circle, rgba(59, 130, 246, 0.4) 0%, rgba(29, 78, 216, 0.2) 30%, transparent 70%);
                border-radius: 25px;
                z-index: -3;
                animation: tutorial-glow 3s infinite;
                pointer-events: none;
                filter: blur(2px);
            `;
            
            element.style.position = 'relative';
            element.appendChild(glowEffect);
            
            // Adicionar efeito de partículas flutuantes
            addFloatingParticles(element);
        }

        // Garantir que o elemento esteja visível durante o tutorial
        function ensureElementVisibility(element) {
            if (!element) return;
            
            // Verificar se o elemento está em um modal fechado
            const modal = element.closest('.modal');
            if (modal && modal.classList.contains('hidden')) {
                // Abrir o modal se estiver fechado
                modal.classList.remove('hidden');
                // Adicionar classe especial para indicar que foi aberto pelo tutorial
                modal.classList.add('tutorial-opened');
            }
            
            // Verificar se o elemento está em um container com overflow hidden
            const scrollableParent = findScrollableParent(element);
            if (scrollableParent && scrollableParent !== document.body) {
                const elementTop = element.offsetTop;
                const containerTop = scrollableParent.scrollTop;
                const containerHeight = scrollableParent.clientHeight;
                
                if (elementTop < containerTop || elementTop > containerTop + containerHeight) {
                    scrollableParent.scrollTo({
                        top: elementTop - containerHeight / 2,
                        behavior: 'smooth'
                    });
                }
            }
            
            // Verificar se o elemento está visível na viewport
            if (!isElementInViewport(element)) {
                element.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center',
                    inline: 'center'
                });
            }
        }

        // Adicionar partículas flutuantes ao redor do elemento
        function addFloatingParticles(element) {
            if (!element) return;
            
            const particleCount = 8;
            const colors = ['#3b82f6', '#60a5fa', '#93c5fd', '#1d4ed8'];
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'tutorial-particle';
                particle.style.cssText = `
                    position: absolute;
                    width: 6px;
                    height: 6px;
                    background: ${colors[i % colors.length]};
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: -2;
                    animation: tutorial-particle-float 4s infinite ${i * 0.5}s;
                    opacity: 0.8;
                `;
                
                // Posicionar partículas em círculo ao redor do elemento
                const angle = (i / particleCount) * 2 * Math.PI;
                const radius = 40;
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;
                
                particle.style.left = `calc(50% + ${x}px)`;
                particle.style.top = `calc(50% + ${y}px)`;
                
                element.appendChild(particle);
            }
        }

        // Remover efeitos especiais do tutorial
        function removeTutorialSpecialEffects() {
            document.querySelectorAll('.tutorial-special-effect').forEach(el => {
                el.classList.remove('tutorial-special-effect');
                el.classList.remove('modal-element', 'chart-element', 'button-element');
                
                const glowEffect = el.querySelector('.tutorial-glow-effect');
                if (glowEffect) {
                    glowEffect.remove();
                }
                
                const particles = el.querySelectorAll('.tutorial-particle');
                particles.forEach(particle => particle.remove());
                
                // Restaurar posição original
                if (el.dataset.originalPosition) {
                    el.style.position = el.dataset.originalPosition;
                    delete el.dataset.originalPosition;
                }
            });
            
            // Fechar modais que foram abertos pelo tutorial
            document.querySelectorAll('.modal.tutorial-opened').forEach(modal => {
                modal.classList.remove('tutorial-opened');
                // Não fechar automaticamente, deixar o usuário decidir
            });
        }

        // Mostrar mensagem de conclusão
        function showCompletionMessage() {
            const message = document.createElement('div');
            message.className = 'fixed top-4 right-4 bg-gradient-to-r from-green-600 to-green-700 text-white px-8 py-6 rounded-xl shadow-2xl z-50 animate-slide-in border-2 border-green-500';
            message.innerHTML = `
                <div class="flex items-center">
                    <div class="mr-4 text-3xl">
                        <i class="fas fa-trophy text-yellow-300"></i>
                    </div>
                    <div>
                        <div class="font-bold text-lg">Parabéns! Tutorial Concluído!</div>
                        <div class="text-sm opacity-90 mt-1">Você agora conhece todas as funcionalidades do Anydesk Control.</div>
                        <div class="text-xs opacity-75 mt-2">🎯 Comece a usar o sistema com confiança!</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(message);
            
            // Adicionar efeito de confete
            createConfettiEffect();
            
            setTimeout(() => {
                message.style.transform = 'translateX(100%)';
                message.style.opacity = '0';
                setTimeout(() => {
                    message.remove();
                }, 300);
            }, 6000);
        }

        // Criar efeito de confete para conclusão do tutorial
        function createConfettiEffect() {
            const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.cssText = `
                        position: fixed;
                        top: -10px;
                        left: ${Math.random() * window.innerWidth}px;
                        width: 10px;
                        height: 10px;
                        background: ${colors[Math.floor(Math.random() * colors.length)]};
                        border-radius: 50%;
                        pointer-events: none;
                        z-index: 100000;
                        animation: confetti-fall 3s linear forwards;
                    `;
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 100);
            }
        }

        // Função para melhorar a experiência do tutorial
        function enhanceTutorialExperience() {
            // Adicionar indicador de progresso visual
            const progressBar = document.createElement('div');
            progressBar.className = 'tutorial-progress-bar';
            progressBar.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                height: 4px;
                background: linear-gradient(90deg, #3b82f6, #1d4ed8);
                z-index: 100003;
                transition: width 0.3s ease;
                box-shadow: 0 2px 8px rgba(59, 130, 246, 0.5);
            `;
            document.body.appendChild(progressBar);
            
            // Atualizar barra de progresso
            updateTutorialProgressBar(progressBar);
            
            // Adicionar indicador de passo atual
            const stepIndicator = document.createElement('div');
            stepIndicator.className = 'tutorial-step-indicator';
            stepIndicator.style.cssText = `
                position: fixed;
                top: 20px;
                left: 20px;
                background: rgba(31, 41, 55, 0.9);
                color: white;
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
                z-index: 100003;
                border: 2px solid #3b82f6;
                backdrop-filter: blur(10px);
            `;
            document.body.appendChild(stepIndicator);
            
            // Atualizar indicador de passo
            updateTutorialStepIndicator(stepIndicator);
        }

        // Atualizar barra de progresso do tutorial
        function updateTutorialProgressBar(progressBar) {
            if (progressBar && tutorialActive) {
                const progress = ((tutorialStep + 1) / tutorialSteps.length) * 100;
                progressBar.style.width = progress + '%';
            }
        }

        // Atualizar indicador de passo do tutorial
        function updateTutorialStepIndicator(stepIndicator) {
            if (stepIndicator && tutorialActive) {
                const currentStep = tutorialSteps[tutorialStep];
                stepIndicator.innerHTML = `
                    <i class="${currentStep.icon} mr-2"></i>
                    Passo ${tutorialStep + 1} de ${tutorialSteps.length}: ${currentStep.title}
                `;
            }
        }

        // Event listeners para tutorial
        document.getElementById('tutorialBtn').addEventListener('click', () => {
            if (!tutorialActive) {
                tutorialStep = 0;
                startTutorial();
            }
        });

        document.getElementById('tutorialSkip').addEventListener('click', skipTutorial);

        // Inicializar tutorial na carga da página
        document.addEventListener('DOMContentLoaded', () => {
            try {
                initTutorial();
                initializeCharts();
                initializeSortable();
                loadInitialData();
                initializeSidebar(); // Adicionar inicialização do sidebar
            } catch (error) {
                console.error('Erro na inicialização:', error);
            }
        });

        // Inicializar Sidebar
        function initializeSidebar() {
            try {
                const sidebar = document.getElementById('sidebar');
                const sidebarToggle = document.getElementById('sidebarToggle');
                const sidebarContent = document.getElementById('sidebarContent');
                const sidebarMinimized = document.getElementById('sidebarMinimized');
                const toggleIcon = document.getElementById('toggleIcon');
                const userAvatarMin = document.getElementById('userAvatarMin');
                
                if (!sidebar || !sidebarToggle || !sidebarContent || !sidebarMinimized || !toggleIcon || !userAvatarMin) {
                    console.error('Elementos do sidebar não encontrados');
                    return;
                }
                
                // Estado do sidebar (salvo no localStorage)
                let isSidebarMinimized = localStorage.getItem('sidebarMinimized') === 'true';
                
                // Aplicar estado inicial
                if (isSidebarMinimized) {
                    sidebar.classList.add('sidebar-minimized');
                }
                
                // Função para alternar o sidebar
                function toggleSidebar() {
                    isSidebarMinimized = !isSidebarMinized;
                    sidebar.classList.toggle('sidebar-minimized', isSidebarMinimized);
                    localStorage.setItem('sidebarMinimized', isSidebarMinimized);
                    
                    // Atualizar ícone
                    if (isSidebarMinimized) {
                        toggleIcon.className = 'fas fa-chevron-right text-xs';
                    } else {
                        toggleIcon.className = 'fas fa-chevron-left text-xs';
                    }
                }
                
                // Event listeners
                sidebarToggle.addEventListener('click', toggleSidebar);
                userAvatarMin.addEventListener('click', toggleSidebar);
                
                // Sincronizar dados entre sidebar expandido e minimizado
                function syncSidebarData() {
                    const totalTickets = document.getElementById('totalTickets')?.textContent || '0';
                    const ticketsAbertos = document.getElementById('ticketsAbertos')?.textContent || '0';
                    
                    const totalTicketsMin = document.getElementById('totalTicketsMin');
                    const ticketsAbertosMin = document.getElementById('ticketsAbertosMin');
                    
                    if (totalTicketsMin) totalTicketsMin.textContent = totalTickets;
                    if (ticketsAbertosMin) ticketsAbertosMin.textContent = ticketsAbertos;
                }
                
                // Sincronizar dados quando o dashboard for atualizado
                const originalUpdateDashboard = window.updateDashboard;
                if (originalUpdateDashboard) {
                    window.updateDashboard = function(...args) {
                        const result = originalUpdateDashboard.apply(this, args);
                        syncSidebarData();
                        return result;
                    };
                }
                
                // Sincronizar dados iniciais
                syncSidebarData();
                
                console.log('Sidebar inicializado com sucesso');
            } catch (error) {
                console.error('Erro ao inicializar sidebar:', error);
            }
        }

        // Inicializar gráficos
        function initializeCharts() {
            try {
                // Gráfico de Status
                const statusCtx = document.getElementById('statusChart');
                if (!statusCtx) {
                    console.error('Canvas statusChart não encontrado');
                    return;
                }
                const statusContext = statusCtx.getContext('2d');
                window.statusChart = new Chart(statusContext, {
                type: 'doughnut',
                data: {
                    labels: ['Aberto', 'Em Atendimento', 'Resolvido', 'Fechado'],
                    datasets: [{
                        data: [3, 2, 5, 1],
                        backgroundColor: ['#fbbf24', '#3b82f6', '#10b981', '#6b7280']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#d1d5db'
                            }
                        }
                    }
                }
            });

            // Gráfico de Responsável
            const responsavelCtx = document.getElementById('responsavelChart');
            if (!responsavelCtx) {
                console.error('Canvas responsavelChart não encontrado');
                return;
            }
            const responsavelContext = responsavelCtx.getContext('2d');
            window.responsavelChart = new Chart(responsavelContext, {
                type: 'bar',
                data: {
                    labels: ['João Silva', 'Maria Santos', 'Pedro Costa'],
                    datasets: [{
                        label: 'Tickets',
                        data: [4, 3, 2],
                        backgroundColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#d1d5db'
                            },
                            grid: {
                                color: '#374151'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#d1d5db'
                            },
                            grid: {
                                color: '#374151'
                            }
                        }
                    }
                }
            });

            // Gráfico de Tempo
            const tempoCtx = document.getElementById('tempoChart');
            if (!tempoCtx) {
                console.error('Canvas tempoChart não encontrado');
                return;
            }
            const tempoContext = tempoCtx.getContext('2d');
            window.tempoChart = new Chart(tempoContext, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai'],
                    datasets: [{
                        label: 'Tempo Médio (horas)',
                        data: [24, 18, 22, 15, 20],
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#d1d5db'
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                color: '#d1d5db'
                            },
                            grid: {
                                color: '#374151'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#d1d5db'
                            },
                            grid: {
                                color: '#374151'
                            }
                        }
                    }
                }
            });

            // Gráfico de Classificação
            const classificacaoCtx = document.getElementById('classificacaoChart');
            if (!classificacaoCtx) {
                console.error('Canvas classificacaoChart não encontrado');
                return;
            }
            const classificacaoContext = classificacaoCtx.getContext('2d');
            window.classificacaoChart = new Chart(classificacaoContext, {
                type: 'pie',
                data: {
                    labels: ['Crítico', 'Alto', 'Médio', 'Baixo'],
                    datasets: [{
                        data: [2, 3, 4, 1],
                        backgroundColor: ['#ef4444', '#f97316', '#eab308', '#22c55e']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#d1d5db'
                            }
                        }
                    }
                }
            });

            // Gráfico de Radar
            const radarCtx = document.getElementById('radarChart');
            if (!radarCtx) {
                console.error('Canvas radarChart não encontrado');
                return;
            }
            const radarContext = radarCtx.getContext('2d');
            window.radarChart = new Chart(radarContext, {
                type: 'radar',
                data: {
                    labels: ['Tempo de Resolução', 'Satisfação', 'Prioridade', 'Complexidade', 'Urgência'],
                    datasets: [{
                        label: 'Métricas de Performance',
                        data: [65, 75, 80, 60, 70],
                        backgroundColor: 'rgba(147, 51, 234, 0.2)',
                        borderColor: '#9333ea',
                        borderWidth: 2,
                        pointBackgroundColor: '#9333ea',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#d1d5db'
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#d1d5db',
                                stepSize: 20
                            },
                            grid: {
                                color: '#374151'
                            },
                            pointLabels: {
                                color: '#d1d5db'
                            }
                        }
                    }
                }
            });

            // Gráfico de Scatter
            const scatterCtx = document.getElementById('scatterChart');
            if (!scatterCtx) {
                console.error('Canvas scatterChart não encontrado');
                return;
            }
            const scatterContext = scatterCtx.getContext('2d');
            window.scatterChart = new Chart(scatterContext, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Tickets por Tempo e Prioridade',
                        data: [
                            { x: 2, y: 8 },
                            { x: 4, y: 6 },
                            { x: 6, y: 9 },
                            { x: 8, y: 4 },
                            { x: 10, y: 7 },
                            { x: 12, y: 5 },
                            { x: 14, y: 10 },
                            { x: 16, y: 3 }
                        ],
                        backgroundColor: '#3b82f6',
                        borderColor: '#1d4ed8',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#d1d5db'
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Tempo de Resolução (horas)',
                                color: '#d1d5db'
                            },
                            ticks: {
                                color: '#d1d5db'
                            },
                            grid: {
                                color: '#374151'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Prioridade (1-10)',
                                color: '#d1d5db'
                            },
                            ticks: {
                                color: '#d1d5db',
                                stepSize: 1
                            },
                            grid: {
                                color: '#374151'
                            }
                        }
                    }
                }
            });
            } catch (error) {
                console.error('Erro ao inicializar gráficos:', error);
            }
        }

        // Inicializar Sortable
        function initializeSortable() {
            const grid = document.querySelector('.grid');
            new Sortable(grid, {
                animation: 150,
                ghostClass: 'bg-gray-700'
            });
        }

        // Carregar dados iniciais
        async function loadInitialData() {
            await updateDashboardStats();
            await updateChartsWithNewData();
        }

        // Atualizar estatísticas do dashboard
        async function updateDashboardStats() {
            try {
                const response = await fetch('http://localhost:3000/api/dashboard/stats');
                
                if (!response.ok) {
                    // Se a API não estiver disponível, usar dados padrão
                    console.warn('API não disponível, usando dados padrão para estatísticas');
                    useDefaultStats();
                    return;
                }
                
                const result = await response.json();

                if (result.success) {
                    const data = result.data;
                    const totalTicketsElement = document.getElementById('totalTickets');
                    const ticketsAbertosElement = document.getElementById('ticketsAbertos');
                    const ticketsResolvidosElement = document.getElementById('ticketsResolvidos');
                    const ticketsEmAtendimentoElement = document.getElementById('ticketsEmAtendimento');
                    const tempoMedioElement = document.getElementById('tempoMedio');
                    
                    // Cards principais
                    const totalTicketsCard = document.getElementById('totalTicketsCard');
                    const ticketsAbertosCard = document.getElementById('ticketsAbertosCard');
                    const ticketsResolvidosCard = document.getElementById('ticketsResolvidosCard');
                    const dataSourcesCard = document.getElementById('dataSourcesCard');
                    
                    if (totalTicketsElement) totalTicketsElement.textContent = data.totalTickets || '0';
                    if (ticketsAbertosElement) ticketsAbertosElement.textContent = data.ticketsAbertos || '0';
                    if (ticketsResolvidosElement) ticketsResolvidosElement.textContent = data.ticketsResolvidos || '0';
                    if (ticketsEmAtendimentoElement) ticketsEmAtendimentoElement.textContent = data.ticketsEmAtendimento || '0';
                    if (tempoMedioElement) tempoMedioElement.textContent = (data.avgResolutionTime || 0).toFixed(1) + 'h';
                    
                    // Estatísticas detalhadas
                    const avgResolutionTimeElement = document.getElementById('avgResolutionTime');
                    const criticalTicketsElement = document.getElementById('criticalTickets');
                    const highPriorityTicketsElement = document.getElementById('highPriorityTickets');
                    const activeResponsiblesElement = document.getElementById('activeResponsibles');
                    
                    if (avgResolutionTimeElement) avgResolutionTimeElement.textContent = (data.avgResolutionTime || 0).toFixed(1) + 'h';
                    if (criticalTicketsElement) criticalTicketsElement.textContent = data.criticalTickets || '0';
                    if (highPriorityTicketsElement) highPriorityTicketsElement.textContent = data.highPriorityTickets || '0';
                    if (activeResponsiblesElement) activeResponsiblesElement.textContent = data.activeResponsibles || '0';
                    
                    // Cards de resumo
                    if (totalTicketsCard) totalTicketsCard.textContent = data.totalTickets || '0';
                    if (ticketsAbertosCard) ticketsAbertosCard.textContent = data.ticketsAbertos || '0';
                    if (ticketsResolvidosCard) ticketsResolvidosCard.textContent = data.ticketsResolvidos || '0';
                    if (dataSourcesCard) dataSourcesCard.textContent = dataSources.length;
                }
            } catch (error) {
                console.error('Erro ao atualizar estatísticas:', error);
                // Usar valores padrão em caso de erro
                useDefaultStats();
            }
        }
        
        // Função para usar estatísticas padrão
        function useDefaultStats() {
            const totalTicketsElement = document.getElementById('totalTickets');
            const ticketsAbertosElement = document.getElementById('ticketsAbertos');
            const ticketsResolvidosElement = document.getElementById('ticketsResolvidos');
            const ticketsEmAtendimentoElement = document.getElementById('ticketsEmAtendimento');
            const tempoMedioElement = document.getElementById('tempoMedio');
            const totalTicketsCard = document.getElementById('totalTicketsCard');
            const ticketsAbertosCard = document.getElementById('ticketsAbertosCard');
            const ticketsResolvidosCard = document.getElementById('ticketsResolvidosCard');
            const dataSourcesCard = document.getElementById('dataSourcesCard');
            
            if (totalTicketsElement) totalTicketsElement.textContent = '11';
            if (ticketsAbertosElement) ticketsAbertosElement.textContent = '3';
            if (ticketsResolvidosElement) ticketsResolvidosElement.textContent = '5';
            if (ticketsEmAtendimentoElement) ticketsEmAtendimentoElement.textContent = '2';
            if (tempoMedioElement) tempoMedioElement.textContent = '65h';
            
            // Estatísticas detalhadas
            const avgResolutionTimeElement = document.getElementById('avgResolutionTime');
            const criticalTicketsElement = document.getElementById('criticalTickets');
            const highPriorityTicketsElement = document.getElementById('highPriorityTickets');
            const activeResponsiblesElement = document.getElementById('activeResponsibles');
            
            if (avgResolutionTimeElement) avgResolutionTimeElement.textContent = '65h';
            if (criticalTicketsElement) criticalTicketsElement.textContent = '2';
            if (highPriorityTicketsElement) highPriorityTicketsElement.textContent = '3';
            if (activeResponsiblesElement) activeResponsiblesElement.textContent = '3';
            
            if (totalTicketsCard) totalTicketsCard.textContent = '11';
            if (ticketsAbertosCard) ticketsAbertosCard.textContent = '3';
            if (ticketsResolvidosCard) ticketsResolvidosCard.textContent = '5';
            if (dataSourcesCard) dataSourcesCard.textContent = '0';
        }

        // Event listeners
        const importExcelBtn = document.getElementById('importExcelBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const editProfileBtn = document.getElementById('editProfileBtn');
        
        if (importExcelBtn) {
            importExcelBtn.addEventListener('click', () => {
                const excelModal = document.getElementById('excelModal');
                if (excelModal) {
                    excelModal.classList.remove('hidden');
                    excelModal.classList.add('flex');
                }
            });
        }

        if (settingsBtn) {
            settingsBtn.addEventListener('click', () => {
                const settingsModal = document.getElementById('settingsModal');
                if (settingsModal) {
                    settingsModal.classList.remove('hidden');
                    settingsModal.classList.add('flex');
                }
            });
        }

        if (editProfileBtn) {
            editProfileBtn.addEventListener('click', () => {
                const settingsModal = document.getElementById('settingsModal');
                if (settingsModal) {
                    settingsModal.classList.remove('hidden');
                    settingsModal.classList.add('flex');
                }
            });
        }

        // Fechar modais
        function closeExcelModal() {
            const excelModal = document.getElementById('excelModal');
            if (excelModal) {
                excelModal.classList.add('hidden');
                excelModal.classList.remove('flex');
            }
        }

        function closeSettingsModal() {
            const settingsModal = document.getElementById('settingsModal');
            if (settingsModal) {
                settingsModal.classList.add('hidden');
                settingsModal.classList.remove('flex');
            }
        }

        // Upload de arquivo
        document.getElementById('excelFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const fileNameElement = document.getElementById('fileName');
                const fileSizeElement = document.getElementById('fileSize');
                const fileInfoElement = document.getElementById('fileInfo');
                const importBtnElement = document.getElementById('importBtn');
                const dataSourceNameElement = document.getElementById('dataSourceName');
                
                if (fileNameElement) fileNameElement.textContent = file.name;
                if (fileSizeElement) fileSizeElement.textContent = (file.size / 1024).toFixed(2) + ' KB';
                if (fileInfoElement) fileInfoElement.classList.remove('hidden');
                if (importBtnElement) importBtnElement.disabled = false;
                
                // Sugerir nome dos dados baseado no nome do arquivo
                if (dataSourceNameElement) {
                    const fileName = file.name.replace(/\.[^/.]+$/, ""); // Remove extensão
                    dataSourceNameElement.value = fileName;
                }
            }
        });

        // Remover arquivo
        function removeFile() {
            const excelFileElement = document.getElementById('excelFile');
            const fileInfoElement = document.getElementById('fileInfo');
            const importBtnElement = document.getElementById('importBtn');
            const dataSourceNameElement = document.getElementById('dataSourceName');
            
            if (excelFileElement) excelFileElement.value = '';
            if (fileInfoElement) fileInfoElement.classList.add('hidden');
            if (importBtnElement) importBtnElement.disabled = true;
            if (dataSourceNameElement) dataSourceNameElement.value = '';
        }

        // Importar Excel
        async function importExcel() {
            const fileInput = document.getElementById('excelFile');
            const dataSourceNameInput = document.getElementById('dataSourceName');
            
            if (!fileInput || !dataSourceNameInput) {
                alert('Erro: Elementos do formulário não encontrados');
                return;
            }
            
            const file = fileInput.files[0];
            const dataSourceName = dataSourceNameInput.value.trim();
            
            if (!file) {
                alert('Por favor, selecione um arquivo Excel.');
                return;
            }
            
            if (!dataSourceName) {
                alert('Por favor, insira um nome para os dados.');
                return;
            }

            // Mostrar loading
            const importBtn = document.getElementById('importBtn');
            if (!importBtn) {
                alert('Erro: Botão de importação não encontrado');
                return;
            }
            
            const originalText = importBtn.innerHTML;
            importBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Importando...';
            importBtn.disabled = true;

            const formData = new FormData();
            formData.append('excel', file);
            formData.append('dataSourceName', dataSourceName);

            try {
                const response = await fetch('http://localhost:3000/api/upload-excel', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    // Adicionar novos dados
                    const newDataSource = {
                        id: Date.now(),
                        name: dataSourceName,
                        fileName: file.name,
                        importDate: new Date().toISOString(),
                        ticketCount: result.imported || 0
                    };
                    
                    dataSources.push(newDataSource);
                    updateDataSourceSelector();
                    updateDataSourceCount();
                    
                    showSuccessMessage(`Dados importados com sucesso! ${result.imported} tickets processados.`);
                    closeExcelModal();
                    
                    // Atualizar dados após importação
                    await updateDashboardStats();
                    await updateChartsWithNewData();
                } else {
                    alert('Erro ao importar: ' + (result.error || 'Erro desconhecido'));
                }
            } catch (error) {
                console.error('Erro na importação:', error);
                alert('Erro ao conectar com o servidor: ' + error.message);
            } finally {
                // Restaurar botão
                if (importBtn) {
                    importBtn.innerHTML = originalText;
                    importBtn.disabled = false;
                }
            }
        }

        // Atualizar gráficos com novos dados
        async function updateChartsWithNewData() {
            try {
                // Verificar se o backend está rodando
                const response = await fetch('http://localhost:3000/api/dashboard/stats');
                
                if (!response.ok) {
                    // Se a API não estiver disponível, usar dados padrão
                    console.warn('API não disponível, usando dados padrão');
                    const defaultData = {
                        statusStats: [
                            { status: 'Aberto', count: 3 },
                            { status: 'Em Atendimento', count: 2 },
                            { status: 'Resolvido', count: 5 },
                            { status: 'Fechado', count: 1 }
                        ],
                        responsavelStats: [
                            { responsavel: 'João Silva', count: 4 },
                            { responsavel: 'Maria Santos', count: 3 },
                            { responsavel: 'Pedro Costa', count: 2 }
                        ],
                        tempoStats: [
                            { mes: 'Jan', tempo_medio: 65 },
                            { mes: 'Fev', tempo_medio: 70 },
                            { mes: 'Mar', tempo_medio: 60 }
                        ],
                        classificacaoStats: [
                            { classificacao: 'Alta', count: 2 },
                            { classificacao: 'Média', count: 5 },
                            { classificacao: 'Baixa', count: 3 }
                        ],
                        radarStats: {
                            tempo_medio: 65,
                            satisfacao: 75,
                            prioridade_media: 80,
                            complexidade_media: 60,
                            urgencia_media: 70
                        },
                        scatterStats: [
                            { tempo_vida_horas: 24, prioridade: 1 },
                            { tempo_vida_horas: 48, prioridade: 2 },
                            { tempo_vida_horas: 72, prioridade: 3 }
                        ]
                    };
                    
                    updateCharts(defaultData);
                    return;
                }
                
                const result = await response.json();

                if (result.success) {
                    updateCharts(result.data);
                    await updateDashboardStats();
                }
            } catch (error) {
                console.error('Erro ao atualizar dados:', error);
                // Em caso de erro, usar dados padrão
                const defaultData = {
                    statusStats: [
                        { status: 'Aberto', count: 3 },
                        { status: 'Em Atendimento', count: 2 },
                        { status: 'Resolvido', count: 5 },
                        { status: 'Fechado', count: 1 }
                    ],
                    responsavelStats: [
                        { responsavel: 'João Silva', count: 4 },
                        { responsavel: 'Maria Santos', count: 3 },
                        { responsavel: 'Pedro Costa', count: 2 }
                    ],
                    tempoStats: [
                        { mes: 'Jan', tempo_medio: 65 },
                        { mes: 'Fev', tempo_medio: 70 },
                        { mes: 'Mar', tempo_medio: 60 }
                    ],
                    classificacaoStats: [
                        { classificacao: 'Alta', count: 2 },
                        { classificacao: 'Baixa', count: 3 }
                    ],
                    radarStats: {
                        tempo_medio: 65,
                        satisfacao: 75,
                        prioridade_media: 80,
                        complexidade_media: 60,
                        urgencia_media: 70
                    },
                    scatterStats: [
                        { tempo_vida_horas: 24, prioridade: 1 },
                        { tempo_vida_horas: 48, prioridade: 2 },
                        { tempo_vida_horas: 72, prioridade: 3 }
                    ]
                };
                
                updateCharts(defaultData);
            }
        }

        // Atualizar gráficos
        function updateCharts(data) {
            try {
                // Atualizar gráfico de status
                if (window.statusChart && data.statusStats && Array.isArray(data.statusStats)) {
                    window.statusChart.data.labels = data.statusStats.map(item => item.status);
                    window.statusChart.data.datasets[0].data = data.statusStats.map(item => item.count);
                    window.statusChart.update();
                }

                // Atualizar gráfico de responsável
                if (window.responsavelChart && data.responsavelStats && Array.isArray(data.responsavelStats)) {
                    window.responsavelChart.data.labels = data.responsavelStats.map(item => item.responsavel);
                    window.responsavelChart.data.datasets[0].data = data.responsavelStats.map(item => item.count);
                    window.responsavelChart.update();
                }

                // Atualizar gráfico de tempo
                if (window.tempoChart && data.tempoStats && Array.isArray(data.tempoStats)) {
                    window.tempoChart.data.labels = data.tempoStats.map(item => item.mes);
                    window.tempoChart.data.datasets[0].data = data.tempoStats.map(item => item.tempo_medio);
                    window.tempoChart.update();
                }

                // Atualizar gráfico de classificação
                if (window.classificacaoChart && data.classificacaoStats && Array.isArray(data.classificacaoStats)) {
                    window.classificacaoChart.data.labels = data.classificacaoStats.map(item => item.classificacao);
                    window.classificacaoChart.data.datasets[0].data = data.classificacaoStats.map(item => item.count);
                    window.classificacaoChart.update();
                }

                // Atualizar gráfico de radar com métricas calculadas
                if (window.radarChart && data.radarStats) {
                    window.radarChart.data.datasets[0].data = [
                        data.radarStats.tempo_medio || 65,
                        data.radarStats.satisfacao || 75,
                        data.radarStats.prioridade_media || 80,
                        data.radarStats.complexidade_media || 60,
                        data.radarStats.urgencia_media || 70
                    ];
                    window.radarChart.update();
                }

                // Atualizar gráfico de scatter com dados de tempo vs prioridade
                if (window.scatterChart && data.scatterStats && Array.isArray(data.scatterStats)) {
                    window.scatterChart.data.datasets[0].data = data.scatterStats.map(item => ({
                        x: item.tempo_vida_horas || 0,
                        y: item.prioridade || 1
                    }));
                    window.scatterChart.update();
                }
            } catch (error) {
                console.error('Erro ao atualizar gráficos:', error);
            }
        }

        // Salvar perfil
        async function saveProfile() {
            const nameElement = document.getElementById('profileName');
            const roleElement = document.getElementById('profileRole');
            const pictureElement = document.getElementById('profilePicture');
            
            if (!nameElement || !roleElement) {
                alert('Erro: Elementos do formulário não encontrados');
                return;
            }
            
            const name = nameElement.value.trim();
            const role = roleElement.value.trim();
            
            if (!name) {
                alert('Por favor, preencha o nome.');
                return;
            }
            
            if (!role) {
                alert('Por favor, preencha o cargo.');
                return;
            }

            // Mostrar loading
            const saveBtn = document.querySelector('#settingsModal button[onclick="saveProfile()"]');
            if (saveBtn) {
                const originalText = saveBtn.innerHTML;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Salvando...';
                saveBtn.disabled = true;

                try {
                    // Processar imagem se selecionada
                    let profilePicture = null;
                    if (pictureElement && pictureElement.files[0]) {
                        const file = pictureElement.files[0];
                        profilePicture = await convertImageToBase64(file);
                    }

                    const profileData = {
                        name: name,
                        role: role,
                        profile_picture: profilePicture
                    };

                    const response = await fetch('http://localhost:3000/api/profile', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(profileData)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();

                    if (result.success) {
                        showSuccessMessage('Perfil atualizado com sucesso!');
                        
                        // Atualizar interface imediatamente
                        const userNameElement = document.getElementById('userName');
                        const userRoleElement = document.getElementById('userRole');
                        const userAvatarElement = document.getElementById('userAvatar');
                        
                        if (userNameElement) userNameElement.textContent = name;
                        if (userRoleElement) userRoleElement.textContent = role;
                        if (userAvatarElement && profilePicture) {
                            // Se há uma imagem de perfil, substituir o ícone por uma imagem
                            userAvatarElement.innerHTML = `<img src="${profilePicture}" alt="Avatar" class="w-10 h-10 rounded-full">`;
                        } else if (userAvatarElement) {
                            // Se não há imagem, usar o ícone padrão
                            userAvatarElement.innerHTML = `<i class="fa-solid fa-user text-white text-xl"></i>`;
                        }
                        
                        closeSettingsModal();
                    } else {
                        alert('Erro ao atualizar perfil: ' + (result.error || 'Erro desconhecido'));
                    }
                } catch (error) {
                    console.error('Erro ao salvar perfil:', error);
                    alert('Erro ao conectar com o servidor: ' + error.message);
                } finally {
                    // Restaurar botão
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                }
            }
        }

        // Converter imagem para Base64
        function convertImageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Carregar perfil
        async function loadProfile() {
            try {
                const response = await fetch('http://localhost:3000/api/profile');
                
                if (!response.ok) {
                    // Se a API não estiver disponível, usar dados padrão
                    console.warn('API não disponível, usando dados padrão para perfil');
                    useDefaultProfile();
                    return;
                }
                
                const result = await response.json();

                if (result.success) {
                    const profile = result.data;
                    const userNameElement = document.getElementById('userName');
                    const userRoleElement = document.getElementById('userRole');
                    const userAvatarElement = document.getElementById('userAvatar');
                    const profileNameElement = document.getElementById('profileName');
                    const profileRoleElement = document.getElementById('profileRole');
                    
                    if (userNameElement) userNameElement.textContent = profile.name || 'João Silva';
                    if (userRoleElement) userRoleElement.textContent = profile.role || 'Analista de Suporte';
                    if (userAvatarElement && profile.profile_picture) {
                        // Se há uma imagem de perfil, substituir o ícone por uma imagem
                        userAvatarElement.innerHTML = `<img src="${profile.profile_picture}" alt="Avatar" class="w-10 h-10 rounded-full">`;
                    } else if (userAvatarElement) {
                        // Se não há imagem, usar o ícone padrão
                        userAvatarElement.innerHTML = `<i class="fa-solid fa-user text-white text-xl"></i>`;
                    }
                    
                    // Preencher campos do modal de edição
                    if (profileNameElement) profileNameElement.value = profile.name || '';
                    if (profileRoleElement) profileRoleElement.value = profile.role || '';
                }
            } catch (error) {
                console.error('Erro ao carregar perfil:', error);
                // Usar valores padrão em caso de erro
                useDefaultProfile();
            }
        }
        
        // Função para usar perfil padrão
        function useDefaultProfile() {
            const userNameElement = document.getElementById('userName');
            const userRoleElement = document.getElementById('userRole');
            const userAvatarElement = document.getElementById('userAvatar');
            const profileNameElement = document.getElementById('profileName');
            const profileRoleElement = document.getElementById('profileRole');
            
            if (userNameElement) userNameElement.textContent = 'João Silva';
            if (userRoleElement) userRoleElement.textContent = 'Analista de Suporte';
            
            if (userAvatarElement) {
                userAvatarElement.innerHTML = `<i class="fa-solid fa-user text-white text-xl"></i>`;
            }
            
            if (profileNameElement) profileNameElement.value = 'João Silva';
            if (profileRoleElement) profileNameElement.value = 'Analista de Suporte';
        }

        // Carregar perfil na inicialização
        loadProfile();
        
        // Sistema de Múltiplos Dashboards
        let dashboards = {
            main: {
                id: 'main',
                name: 'Dashboard Principal',
                charts: ['statusChart', 'responsavelChart', 'tempoChart', 'classificacaoChart', 'radarChart', 'scatterChart'],
                layout: 'default'
            }
        };
        
        let currentDashboard = 'main';
        
        // Criar novo dashboard
        function createNewDashboard() {
            // Mostrar modal para inserir nome
            document.getElementById('newDashboardName').value = '';
            document.getElementById('newDashboardNameModal').classList.remove('hidden');
            document.getElementById('newDashboardName').focus();
        }
        
        // Excluir dashboard atual
        function deleteCurrentDashboard() {
            if (currentDashboard === 'main') {
                alert('Não é possível excluir o Dashboard Principal.');
                return;
            }
            
            if (confirm(`Tem certeza que deseja excluir o dashboard "${dashboards[currentDashboard].name}"?`)) {
                delete dashboards[currentDashboard];
                updateDashboardSelector();
                
                // Voltar para o dashboard principal
                document.getElementById('dashboardSelector').value = 'main';
                switchDashboard('main');
                
                showSuccessMessage('Dashboard excluído com sucesso!');
            }
        }
        
        // Trocar de dashboard
        function switchDashboard(dashboardId) {
            currentDashboard = dashboardId;
            const dashboard = dashboards[dashboardId];
            
            if (!dashboard) return;
            
            // Atualizar interface
            updateDashboardGrid(dashboard);
            
            // Salvar preferência
            localStorage.setItem('currentDashboard', dashboardId);
        }
        
        // Atualizar grid do dashboard
        function updateDashboardGrid(dashboard) {
            const grid = document.getElementById('dashboardGrid');
            if (!grid) return;
            
            // Limpar grid atual
            grid.innerHTML = '';
            
            if (dashboard.charts.length === 0) {
                // Dashboard vazio - mostrar mensagem
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-gray-400 text-lg mb-4">
                            <i class="fas fa-chart-bar text-4xl mb-4"></i>
                            <p>Este dashboard está vazio</p>
                        </div>
                        <button onclick="addChartToDashboard()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg">
                            <i class="fas fa-plus mr-2"></i>
                            Adicionar Gráfico
                        </button>
                    </div>
                `;
            } else {
                // Renderizar gráficos do dashboard
                dashboard.charts.forEach((chartId, index) => {
                    const chartContainer = createChartContainer(chartId, index + 1);
                    grid.appendChild(chartContainer);
                });
            }
        }
        
        // Criar container de gráfico
        function createChartContainer(chartId, chartNumber) {
            const container = document.createElement('div');
            container.id = `chart${chartNumber}`;
            container.className = 'bg-gray-800 rounded-lg p-6 shadow-lg cursor-move';
            
            const chartConfig = getChartConfig(chartId);
            
            container.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-${chartConfig.color}-400">
                        <i class="${chartConfig.icon} mr-2"></i>
                        ${chartConfig.title}
                    </h3>
                    <div class="flex space-x-2">
                        <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('${chartId}', '${chartConfig.title}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('${chartId}')">
                            <i class="fas fa-expand"></i>
                        </button>
                        <button class="text-gray-400 hover:text-white transition-colors" onclick="removeChartFromDashboard('${chartId}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <canvas id="${chartId}" height="200"></canvas>
            `;
            
            return container;
        }
        
        // Configuração dos gráficos
        function getChartConfig(chartId) {
            const configs = {
                statusChart: { title: 'Tickets por Status', color: 'blue', icon: 'fas fa-chart-pie' },
                responsavelChart: { title: 'Tickets por Responsável', color: 'green', icon: 'fas fa-users' },
                tempoChart: { title: 'Tempo de Resolução', color: 'yellow', icon: 'fas fa-clock' },
                classificacaoChart: { title: 'Tickets por Classificação', color: 'red', icon: 'fas fa-exclamation-triangle' },
                radarChart: { title: 'Radar Chart', color: 'purple', icon: 'fas fa-chart-radar' },
                scatterChart: { title: 'Scatter Chart', color: 'indigo', icon: 'fas fa-chart-scatter' }
            };
            
            return configs[chartId] || { title: 'Gráfico', color: 'gray', icon: 'fas fa-chart-bar' };
        }
        
        // Adicionar gráfico ao dashboard
        function addChartToDashboard() {
            const availableCharts = ['statusChart', 'responsavelChart', 'tempoChart', 'classificacaoChart', 'radarChart', 'scatterChart'];
            const currentCharts = dashboards[currentDashboard].charts;
            const unusedCharts = availableCharts.filter(chart => !currentCharts.includes(chart));
            
            if (unusedCharts.length === 0) {
                alert('Todos os gráficos já estão no dashboard atual.');
                return;
            }
            
            const chartOptions = unusedCharts.map(chart => {
                const config = getChartConfig(chart);
                return `${chart}:${config.title}`;
            }).join('\n');
            
            const selectedChart = prompt(`Selecione um gráfico para adicionar:\n\n${chartOptions}`);
            if (!selectedChart) return;
            
            const chartId = selectedChart.split(':')[0];
            if (unusedCharts.includes(chartId)) {
                dashboards[currentDashboard].charts.push(chartId);
                updateDashboardGrid(dashboards[currentDashboard]);
                showSuccessMessage(`Gráfico "${getChartConfig(chartId).title}" adicionado ao dashboard!`);
            }
        }
        
        // Remover gráfico do dashboard
        function removeChartFromDashboard(chartId) {
            const dashboard = dashboards[currentDashboard];
            const index = dashboard.charts.indexOf(chartId);
            
            if (index > -1) {
                dashboard.charts.splice(index, 1);
                updateDashboardGrid(dashboard);
                showSuccessMessage(`Gráfico removido do dashboard!`);
            }
        }

        // Funções para os modais de criação de dashboard
        function closeNewDashboardNameModal() {
            document.getElementById('newDashboardNameModal').classList.add('hidden');
        }

        function closeChartSelectionModal() {
            document.getElementById('chartSelectionModal').classList.add('hidden');
            // Limpar seleções ao fechar
            selectedCharts = [];
            updateSelectedChartsCount();
        }

        function proceedToChartSelection() {
            const dashboardName = document.getElementById('newDashboardName').value.trim();
            if (!dashboardName) {
                alert('Por favor, insira um nome para o dashboard.');
                document.getElementById('newDashboardName').focus();
                return;
            }

            // Fechar modal de nome e abrir modal de seleção de gráficos
            closeNewDashboardNameModal();
            
            // Armazenar nome temporariamente
            window.tempDashboardName = dashboardName;
            
            // Popular grid de seleção de gráficos
            populateChartSelectionGrid();
            
            // Mostrar modal de seleção
            document.getElementById('chartSelectionModal').classList.remove('hidden');
        }

        function populateChartSelectionGrid() {
            const grid = document.getElementById('chartSelectionGrid');
            const allCharts = [
                { id: 'statusChart', title: 'Status dos Tickets', description: 'Distribuição dos tickets por status (Aberto, Resolvido, Em Atendimento)', icon: 'fas fa-chart-pie', color: 'blue' },
                { id: 'responsavelChart', title: 'Tickets por Responsável', description: 'Quantidade de tickets atribuídos a cada responsável', icon: 'fas fa-users', color: 'green' },
                { id: 'tempoChart', title: 'Tempo de Vida dos Tickets', description: 'Análise do tempo médio de resolução dos tickets', icon: 'fas fa-clock', color: 'yellow' },
                { id: 'classificacaoChart', title: 'Classificação dos Clientes', description: 'Distribuição dos tickets por classificação do cliente', icon: 'fas fa-star', color: 'purple' },
                { id: 'radarChart', title: 'Análise Multidimensional', description: 'Visão geral de múltiplas métricas em formato radar', icon: 'fas fa-chart-line', color: 'red' },
                { id: 'scatterChart', title: 'Correlação Tempo vs Status', description: 'Relação entre tempo de resolução e status dos tickets', icon: 'fas fa-chart-area', color: 'orange' }
            ];

            grid.innerHTML = '';
            selectedCharts = [];

            allCharts.forEach(chart => {
                const chartCard = document.createElement('div');
                chartCard.className = 'border-2 border-gray-200 rounded-lg p-4 cursor-pointer transition-all duration-200 hover:border-blue-300 hover:shadow-md';
                chartCard.onclick = () => toggleChartSelection(chart.id, chartCard);
                chartCard.dataset.chartId = chart.id;
                
                chartCard.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0">
                            <i class="${chart.icon} text-2xl text-${chart.color}-500"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800 mb-1">${chart.title}</h4>
                            <p class="text-sm text-gray-600">${chart.description}</p>
                        </div>
                        <div class="flex-shrink-0">
                            <div class="w-5 h-5 border-2 border-gray-300 rounded transition-colors duration-200" id="check-${chart.id}">
                                <i class="fas fa-check text-white text-xs hidden" id="icon-${chart.id}"></i>
                            </div>
                        </div>
                    </div>
                `;
                
                grid.appendChild(chartCard);
            });

            updateSelectedChartsCount();
        }

        function toggleChartSelection(chartId, chartCard) {
            const checkBox = document.getElementById(`check-${chartId}`);
            const icon = document.getElementById(`icon-${chartId}`);
            
            if (selectedCharts.includes(chartId)) {
                // Remover seleção
                selectedCharts = selectedCharts.filter(id => id !== chartId);
                checkBox.classList.remove('bg-blue-500', 'border-blue-500');
                checkBox.classList.add('border-gray-300');
                icon.classList.add('hidden');
                chartCard.classList.remove('border-blue-500', 'bg-blue-50');
                chartCard.classList.add('border-gray-200');
            } else {
                // Adicionar seleção
                selectedCharts.push(chartId);
                checkBox.classList.add('bg-blue-500', 'border-blue-500');
                checkBox.classList.remove('border-gray-300');
                icon.classList.remove('hidden');
                chartCard.classList.add('border-blue-500', 'bg-blue-50');
                chartCard.classList.remove('border-gray-200');
            }
            
            updateSelectedChartsCount();
        }

        function selectAllCharts() {
            const allCharts = ['statusChart', 'responsavelChart', 'tempoChart', 'classificacaoChart', 'radarChart', 'scatterChart'];
            selectedCharts = [...allCharts];
            
            // Atualizar visual de todos os cards
            allCharts.forEach(chartId => {
                const chartCard = document.querySelector(`[data-chart-id="${chartId}"]`);
                const checkBox = document.getElementById(`check-${chartId}`);
                const icon = document.getElementById(`icon-${chartId}`);
                
                if (chartCard && checkBox && icon) {
                    checkBox.classList.add('bg-blue-500', 'border-blue-500');
                    checkBox.classList.remove('border-gray-300');
                    icon.classList.remove('hidden');
                    chartCard.classList.add('border-blue-500', 'bg-blue-50');
                    chartCard.classList.remove('border-gray-200');
                }
            });
            
            updateSelectedChartsCount();
        }

        function updateSelectedChartsCount() {
            const countElement = document.getElementById('selectedChartsCount');
            if (countElement) {
                countElement.textContent = selectedCharts.length;
            }
        }

        function createDashboardWithCharts() {
            if (selectedCharts.length === 0) {
                alert('Por favor, selecione pelo menos um gráfico para o dashboard.');
                return;
            }

            const dashboardName = window.tempDashboardName;
            const dashboardId = 'dashboard_' + Date.now();
            
            const newDashboard = {
                id: dashboardId,
                name: dashboardName,
                charts: selectedCharts,
                layout: 'custom'
            };
            
            dashboards[dashboardId] = newDashboard;
            updateDashboardSelector();
            
            // Selecionar o novo dashboard
            document.getElementById('dashboardSelector').value = dashboardId;
            switchDashboard(dashboardId);
            
            // Limpar variáveis temporárias
            delete window.tempDashboardName;
            selectedCharts = [];
            
            // Fechar modal
            closeChartSelectionModal();
            
            showSuccessMessage(`Dashboard "${dashboardName}" criado com sucesso com ${selectedCharts.length} gráficos!`);
        }

        // Variável global para gráficos selecionados
        let selectedCharts = [];
        
        // Atualizar seletor de dashboards
        function updateDashboardSelector() {
            const selector = document.getElementById('dashboardSelector');
            if (!selector) return;
            
            selector.innerHTML = '';
            
            Object.values(dashboards).forEach(dashboard => {
                const option = document.createElement('option');
                option.value = dashboard.id;
                option.textContent = dashboard.name;
                selector.appendChild(option);
            });
        }
        
        // Event listener para troca de dashboard
        document.addEventListener('DOMContentLoaded', () => {
            const selector = document.getElementById('dashboardSelector');
            if (selector) {
                selector.addEventListener('change', (e) => {
                    switchDashboard(e.target.value);
                });
            }
            
            // Carregar dashboard salvo
            const savedDashboard = localStorage.getItem('currentDashboard');
            if (savedDashboard && dashboards[savedDashboard]) {
                currentDashboard = savedDashboard;
                selector.value = savedDashboard;
            }
        });
        
        // Funções para gerenciar Dados
        function updateDataSourceSelector() {
            const selector = document.getElementById('dataSourceSelector');
            if (!selector) return;
            
            // Limpar opções existentes
            selector.innerHTML = '<option value="">Selecione os dados</option>';
            
            // Adicionar opções para cada fonte de dados
            dataSources.forEach(source => {
                const option = document.createElement('option');
                option.value = source.id;
                option.textContent = `${source.name} (${source.ticketCount} tickets)`;
                selector.appendChild(option);
            });
        }
        
        function updateDataSourceCount() {
            const countElement = document.getElementById('dataSourcesCount');
            if (countElement) {
                countElement.textContent = dataSources.length;
            }
        }
        
                    // Event listener para mudança de dados
        const dataSourceSelector = document.getElementById('dataSourceSelector');
        if (dataSourceSelector) {
            dataSourceSelector.addEventListener('change', (e) => {
                const selectedId = e.target.value;
                if (selectedId) {
                    currentDataSource = dataSources.find(source => source.id == selectedId);
                    if (currentDataSource) {
                        console.log('Dados selecionados:', currentDataSource.name);
                        // Aqui você pode implementar a lógica para carregar dados específicos
                        updateChartsWithDataSource(currentDataSource);
                    }
                } else {
                    currentDataSource = null;
                }
            });
        }
        
        function updateChartsWithDataSource(dataSource) {
            // Implementar lógica para atualizar gráficos com dados específicos dos dados
            console.log('Atualizando gráficos com dados de:', dataSource.name);
            // Esta função será expandida para carregar dados específicos dos dados selecionados
        }
        
        // Variáveis para configurações de gráficos
        let currentChartId = null;
        let chartSettings = {};
        
        // Abrir modal de configurações de gráficos
        function openChartSettings(chartId, chartTitle) {
            currentChartId = chartId;
            
            const titleElement = document.getElementById('chartSettingsTitle');
            if (titleElement) {
                titleElement.textContent = `Configurações: ${chartTitle}`;
            }
            
            // Carregar configurações atuais do gráfico
            loadChartSettings(chartId);
            
            // Mostrar modal
            const modal = document.getElementById('chartSettingsModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
        }
        
        // Fechar modal de configurações de gráficos
        function closeChartSettingsModal() {
            const modal = document.getElementById('chartSettingsModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
            currentChartId = null;
        }
        
        // Carregar configurações atuais do gráfico
        function loadChartSettings(chartId) {
            const chart = window[chartId];
            if (!chart) return;
            
            // Carregar configurações padrão se não existirem
            if (!chartSettings[chartId]) {
                const chartType = chart.config?.type || 'bar';
                chartSettings[chartId] = {
                    chartType: chartType,
                    backgroundColor: '#1f2937',
                    borderColor: '#3b82f6',
                    borderWidth: 2,
                    opacity: 80,
                    showValues: true,
                    valueFormat: 'number',
                    decimals: 2,
                    groupData: 'none',
                    legendPosition: 'bottom',
                    showGrid: true,
                    height: 200,
                    animation: true,
                    itemLimit: 10,
                    statusFilter: 'all',
                    priorityFilter: 'all',
                    timeFilter: 'all'
                };
            }
            
            const settings = chartSettings[chartId];
            
            // Aplicar valores aos campos com verificação de existência
            const chartType = chart.config?.type || 'bar';
            const fields = {
                'chartType': settings.chartType || chartType,
                'chartBgColor': settings.backgroundColor,
                'chartBorderColor': settings.borderColor,
                'chartBorderWidth': settings.borderWidth,
                'chartOpacity': settings.opacity,
                'chartShowValues': settings.showValues.toString(),
                'chartValueFormat': settings.valueFormat,
                'chartDecimals': settings.decimals,
                'chartGroupData': settings.groupData,
                'chartLegendPosition': settings.legendPosition,
                'chartShowGrid': settings.showGrid.toString(),
                'chartHeight': settings.height,
                'chartAnimation': settings.animation.toString(),
                'chartItemLimit': settings.itemLimit,
                'chartStatusFilter': settings.statusFilter,
                'chartPriorityFilter': settings.priorityFilter,
                'chartTimeFilter': settings.timeFilter
            };
            
            Object.entries(fields).forEach(([fieldId, value]) => {
                const element = document.getElementById(fieldId);
                if (element) {
                    element.value = value;
                }
            });
            
            // Atualizar valores dos sliders
            updateSliderValues();
            
            // Configurar event listener para mudança de tipo
            setupChartTypeChangeListener();
        }
        
        // Atualizar valores dos sliders
        function updateSliderValues() {
            const borderWidthSlider = document.getElementById('chartBorderWidth');
            const opacitySlider = document.getElementById('chartOpacity');
            const heightSlider = document.getElementById('chartHeight');
            
            const borderWidthValue = document.getElementById('borderWidthValue');
            const opacityValue = document.getElementById('opacityValue');
            const heightValue = document.getElementById('heightValue');
            
            if (borderWidthSlider && borderWidthValue) {
                borderWidthValue.textContent = borderWidthSlider.value + 'px';
            }
            
            if (opacitySlider && opacityValue) {
                opacityValue.textContent = opacitySlider.value + '%';
            }
            
            if (heightSlider && heightValue) {
                heightValue.textContent = heightSlider.value + 'px';
            }
        }
        
        // Configurar event listener para mudança de tipo de gráfico
        function setupChartTypeChangeListener() {
            const chartTypeSelect = document.getElementById('chartType');
            if (chartTypeSelect) {
                chartTypeSelect.removeEventListener('change', handleChartTypeChange);
                chartTypeSelect.addEventListener('change', handleChartTypeChange);
                
                // Atualizar descrição inicial
                updateChartTypeDescription(chartTypeSelect.value);
            }
        }
        
        // Atualizar descrição do tipo de gráfico
        function updateChartTypeDescription(chartType) {
            const descriptionElement = document.getElementById('chartTypeDescription');
            if (!descriptionElement) return;
            
            const descriptions = {
                'bar': 'Gráfico de barras verticais, ideal para comparar valores entre categorias',
                'line': 'Gráfico de linha, perfeito para mostrar tendências ao longo do tempo',
                'pie': 'Gráfico de pizza, excelente para mostrar proporções de um todo',
                'doughnut': 'Gráfico de rosca, similar ao de pizza mas com área central vazia',
                'radar': 'Gráfico de radar, ideal para comparar múltiplas variáveis em um formato circular',
                'scatter': 'Gráfico de dispersão, perfeito para mostrar correlações entre duas variáveis',
                'bubble': 'Gráfico de bolhas, combina três dimensões de dados (x, y e tamanho)',
                'polarArea': 'Gráfico de área polar, combina características de pizza e radar'
            };
            
            descriptionElement.textContent = descriptions[chartType] || 'Descrição não disponível';
        }
        
        // Manipular mudança de tipo de gráfico
        function handleChartTypeChange(event) {
            updateChartTypeDescription(event.target.value);
        }
        
        // Aplicar configurações do gráfico
        function applyChartSettings() {
            if (!currentChartId) return;
            
            const chart = window[currentChartId];
            if (!chart) return;
            
            // Coletar valores dos campos com verificação
            const fields = {
                'chartType': 'chartType',
                'chartBgColor': 'backgroundColor',
                'chartBorderColor': 'borderColor',
                'chartBorderWidth': 'borderWidth',
                'chartOpacity': 'opacity',
                'chartShowValues': 'showValues',
                'chartValueFormat': 'valueFormat',
                'chartDecimals': 'decimals',
                'chartGroupData': 'groupData',
                'chartLegendPosition': 'legendPosition',
                'chartShowGrid': 'showGrid',
                'chartHeight': 'height',
                'chartAnimation': 'animation',
                'chartItemLimit': 'itemLimit',
                'chartStatusFilter': 'statusFilter',
                'chartPriorityFilter': 'priorityFilter',
                'chartTimeFilter': 'timeFilter'
            };
            
            const settings = {};
            
            Object.entries(fields).forEach(([fieldId, settingKey]) => {
                const element = document.getElementById(fieldId);
                if (element) {
                    let value = element.value;
                    
                    // Converter tipos específicos
                    if (settingKey === 'borderWidth' || settingKey === 'opacity' || settingKey === 'decimals' || settingKey === 'height' || settingKey === 'itemLimit') {
                        value = parseInt(value) || 0;
                    } else if (settingKey === 'showValues' || settingKey === 'showGrid' || settingKey === 'animation') {
                        value = value === 'true';
                    }
                    
                    settings[settingKey] = value;
                }
            });
            
            // Salvar configurações
            chartSettings[currentChartId] = settings;
            
            // Aplicar configurações ao gráfico
            applySettingsToChart(currentChartId, settings);
            
            // Fechar modal
            closeChartSettingsModal();
            
            // Mostrar mensagem de sucesso
            showSuccessMessage('Configurações aplicadas com sucesso!');
        }
        
        // Aplicar configurações ao gráfico
        function applySettingsToChart(chartId, settings) {
            const chart = window[chartId];
            if (!chart) return;
            
            // Verificar se o tipo do gráfico mudou
            const currentType = chart.config?.type || 'bar';
            if (settings.chartType && settings.chartType !== currentType) {
                try {
                    // Destruir gráfico atual
                    chart.destroy();
                    
                    // Recriar gráfico com novo tipo
                    const canvas = document.getElementById(chartId);
                    if (canvas) {
                        const context = canvas.getContext('2d');
                        
                        // Preservar dados e opções existentes
                        const chartData = chart.data;
                        const chartOptions = chart.options;
                        
                        // Configurações específicas para cada tipo de gráfico
                        let newOptions = { ...chartOptions };
                        
                        // Ajustar opções para tipos específicos
                        if (settings.chartType === 'radar') {
                            newOptions.scales = {
                                r: {
                                    beginAtZero: true,
                                    ticks: {
                                        color: '#d1d5db'
                                    },
                                    grid: {
                                        color: '#374151'
                                    }
                                }
                            };
                        } else if (settings.chartType === 'scatter') {
                            newOptions.scales = {
                                x: {
                                    type: 'linear',
                                    position: 'bottom',
                                    ticks: {
                                        color: '#d1d5db'
                                    },
                                    grid: {
                                        color: '#374151'
                                    }
                                },
                                y: {
                                    type: 'linear',
                                    position: 'left',
                                    ticks: {
                                        color: '#d1d5db'
                                    },
                                    grid: {
                                        color: '#374151'
                                    }
                                }
                            };
                        } else if (settings.chartType === 'pie' || settings.chartType === 'doughnut') {
                            // Para gráficos circulares, remover escalas
                            delete newOptions.scales;
                        }
                        
                        // Criar novo gráfico com o tipo selecionado
                        window[chartId] = new Chart(context, {
                            type: settings.chartType,
                            data: chartData,
                            options: newOptions
                        });
                        
                        // Atualizar referência
                        const newChart = window[chartId];
                        
                        // Aplicar outras configurações ao novo gráfico
                        applyOtherChartSettings(newChart, settings);
                        
                        return;
                    }
                } catch (error) {
                    console.error('Erro ao mudar tipo do gráfico:', error);
                    // Em caso de erro, restaurar o tipo original
                    if (chartSettings[chartId]) {
                        chartSettings[chartId].chartType = currentType;
                    }
                    // Recarregar configurações
                    loadChartSettings(chartId);
                }
            }
            
            // Aplicar outras configurações sem mudança de tipo
            applyOtherChartSettings(chart, settings);
        }
        
        // Aplicar outras configurações do gráfico (sem mudança de tipo)
        function applyOtherChartSettings(chart, settings) {
            // Aplicar configurações de cores
            if (chart.data && chart.data.datasets && chart.data.datasets[0]) {
                const dataset = chart.data.datasets[0];
                dataset.backgroundColor = settings.backgroundColor;
                dataset.borderColor = settings.borderColor;
                dataset.borderWidth = settings.borderWidth;
                
                // Aplicar transparência
                if (dataset.backgroundColor) {
                    const hex = settings.backgroundColor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);
                    dataset.backgroundColor = `rgba(${r}, ${g}, ${b}, ${settings.opacity / 100})`;
                }
            }
            
            // Aplicar configurações de layout
            if (chart.options) {
                chart.options.responsive = true;
                chart.options.maintainAspectRatio = false;
                
                // Configurar legenda
                if (chart.options.plugins && chart.options.plugins.legend) {
                    chart.options.plugins.legend.position = settings.legendPosition;
                }
                
                // Configurar animação
                chart.options.animation = settings.animation;
                
                // Configurar grade
                if (chart.options.scales) {
                    Object.keys(chart.options.scales).forEach(axis => {
                        if (chart.options.scales[axis] && chart.options.scales[axis].grid) {
                            chart.options.scales[axis].grid.display = settings.showGrid;
                        }
                    });
                }
            }
            
            // Aplicar altura
            const canvas = document.getElementById(chartId);
            if (canvas && settings.height) {
                canvas.style.height = settings.height + 'px';
            }
            
            // Atualizar gráfico
            chart.update();
        }
        
        // Restaurar configurações padrão
        function resetChartSettings() {
            if (!currentChartId) return;
            
            const chart = window[currentChartId];
            if (!chart) return;
            
            try {
                // Salvar tipo original antes de deletar
                const originalType = chart.config?.type || 'bar';
                
                // Remover configurações personalizadas
                delete chartSettings[currentChartId];
                
                // Recarregar configurações padrão
                loadChartSettings(currentChartId);
                
                // Restaurar tipo original do gráfico se necessário
                const chartTypeSelect = document.getElementById('chartType');
                if (chartTypeSelect && originalType) {
                    chartTypeSelect.value = originalType;
                    updateChartTypeDescription(originalType);
                }
                
                // Mostrar mensagem
                showSuccessMessage('Configurações restauradas para o padrão!');
            } catch (error) {
                console.error('Erro ao restaurar configurações:', error);
                showSuccessMessage('Erro ao restaurar configurações!');
            }
        }
        
        // Expandir gráfico
        function expandChart(chartId) {
            const chart = window[chartId];
            if (!chart) return;
            
            // Criar modal de gráfico expandido
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-white">Gráfico Expandido</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="bg-white rounded p-4">
                        <canvas id="expanded_${chartId}" width="800" height="400"></canvas>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Criar gráfico expandido
            setTimeout(() => {
                const expandedCanvas = document.getElementById(`expanded_${chartId}`);
                if (expandedCanvas) {
                    try {
                        const chartType = chart.config?.type || 'bar';
                        const expandedChart = new Chart(expandedCanvas.getContext('2d'), {
                            type: chartType,
                            data: chart.data,
                            options: {
                                ...chart.options,
                                responsive: true,
                                maintainAspectRatio: false
                            }
                        });
                        
                        // Armazenar referência para evitar erro de garbage collection
                        window[`expanded_${chartId}`] = expandedChart;
                    } catch (error) {
                        console.error('Erro ao criar gráfico expandido:', error);
                    }
                }
            }, 100);
        }
        
        // Mostrar mensagem de sucesso
        function showSuccessMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-4 rounded-lg shadow-lg z-50 animate-slide-in';
            messageDiv.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-check-circle mr-3 text-xl"></i>
                    <div class="font-semibold">${message}</div>
                </div>
            `;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
        
        // Event listeners para sliders
        document.addEventListener('DOMContentLoaded', () => {
            try {
                // Adicionar event listeners para sliders
                const sliders = ['chartBorderWidth', 'chartOpacity', 'chartHeight'];
                sliders.forEach(sliderId => {
                    const slider = document.getElementById(sliderId);
                    if (slider) {
                        slider.addEventListener('input', updateSliderValues);
                    }
                });
            } catch (error) {
                console.error('Erro ao configurar event listeners:', error);
            }
        });

        // Variáveis para modais (já declaradas globalmente)
        // let currentTickets = [];
        // let currentDataSourceId = null;
        // let currentFilterType = 'all';

        // Função para abrir modal de tickets
        function openTicketsModal(type = 'all') {
            currentFilterType = type;
            const modal = document.getElementById('ticketsModal');
            const title = document.getElementById('ticketsModalTitle');
            
            switch(type) {
                case 'total':
                    title.textContent = 'Total de Tickets';
                    break;
                case 'abertos':
                    title.textContent = 'Tickets em Aberto';
                    break;
                case 'resolvidos':
                    title.textContent = 'Tickets Resolvidos';
                    break;
                default:
                    title.textContent = 'Todos os Tickets';
            }
            
            modal.classList.remove('hidden');
            loadTicketsData(type);
        }

        // Função para fechar modal de tickets
        function closeTicketsModal() {
            document.getElementById('ticketsModal').classList.add('hidden');
        }

        // Função para carregar dados dos tickets
        async function loadTicketsData(type = 'all') {
            try {
                const response = await fetch('/api/tickets');
                const data = await response.json();
                
                if (data.success) {
                    currentTickets = data.tickets;
                    
                    // Filtrar por tipo
                    let filteredTickets = currentTickets;
                    if (type === 'abertos') {
                        filteredTickets = currentTickets.filter(t => 
                            t.STATUS === 'Aberto' || t.STATUS === 'Em Andamento'
                        );
                    } else if (type === 'resolvidos') {
                        filteredTickets = currentTickets.filter(t => 
                            t.STATUS === 'Resolvido' || t.STATUS === 'Fechado'
                        );
                    }
                    
                    displayTickets(filteredTickets);
                    populateFilters(currentTickets);
                }
            } catch (error) {
                console.error('Erro ao carregar tickets:', error);
                showNotification('Erro ao carregar dados dos tickets', 'error');
            }
        }

        // Função para exibir tickets na tabela
        function displayTickets(tickets) {
            const tbody = document.getElementById('ticketsTableBody');
            const count = document.getElementById('ticketsCount');
            
            tbody.innerHTML = '';
            count.textContent = `${tickets.length} tickets encontrados`;
            
            tickets.forEach(ticket => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${ticket.NUMERO_TICKET || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(ticket.ABERTO_EM)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.RESPONSAVEL || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.CLIENTE_COMPLETO || '-'}</td>
                    <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate" title="${ticket.ASSUNTO || '-'}">${ticket.ASSUNTO || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.TEMPO_VIDA_HORAS || '0'}h</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(ticket.STATUS)}">
                            ${ticket.STATUS || '-'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.DATA_SOURCE || '-'}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Função para popular filtros
        function populateFilters(tickets) {
            const statuses = [...new Set(tickets.map(t => t.STATUS).filter(Boolean))];
            const responsaveis = [...new Set(tickets.map(t => t.RESPONSAVEL).filter(Boolean))];
            const clientes = [...new Set(tickets.map(t => t.CLIENTE_COMPLETO).filter(Boolean))];
            const dataSources = [...new Set(tickets.map(t => t.DATA_SOURCE).filter(Boolean))];
            
            populateSelect('filterStatus', statuses);
            populateSelect('filterResponsavel', responsaveis);
            populateSelect('filterCliente', clientes);
            populateSelect('filterDataSource', dataSources);
        }

        // Função para popular select
        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Todos</option>';
            
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
        }

        // Função para aplicar filtros
        function applyFilters() {
            const status = document.getElementById('filterStatus').value;
            const responsavel = document.getElementById('filterResponsavel').value;
            const cliente = document.getElementById('filterCliente').value;
            const dataSource = document.getElementById('filterDataSource').value;
            
            let filteredTickets = currentTickets;
            
            // Filtrar por tipo inicial
            if (currentFilterType === 'abertos') {
                filteredTickets = filteredTickets.filter(t => 
                    t.STATUS === 'Aberto' || t.STATUS === 'Em Andamento'
                );
            } else if (currentFilterType === 'resolvidos') {
                filteredTickets = filteredTickets.filter(t => 
                    t.STATUS === 'Resolvido' || t.STATUS === 'Fechado'
                );
            }
            
            // Aplicar filtros adicionais
            if (status) {
                filteredTickets = filteredTickets.filter(t => t.STATUS === status);
            }
            if (responsavel) {
                filteredTickets = filteredTickets.filter(t => t.RESPONSAVEL === responsavel);
            }
            if (cliente) {
                filteredTickets = filteredTickets.filter(t => t.CLIENTE_COMPLETO === cliente);
            }
            if (dataSource) {
                filteredTickets = filteredTickets.filter(t => t.DATA_SOURCE === dataSource);
            }
            
            displayTickets(filteredTickets);
        }

        // Função para limpar filtros
        function clearFilters() {
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterResponsavel').value = '';
            document.getElementById('filterCliente').value = '';
            document.getElementById('filterDataSource').value = '';
            
            loadTicketsData(currentFilterType);
        }

        // Função para abrir modal de dados
        function openDataSourcesModal() {
            const modal = document.getElementById('dataSourcesModal');
            modal.classList.remove('hidden');
            loadDataSources();
        }

        // Função para fechar modal de dados
        function closeDataSourcesModal() {
            document.getElementById('dataSourcesModal').classList.add('hidden');
        }

        // Função para carregar dados
        async function loadDataSources() {
            try {
                const response = await fetch('/api/data-sources');
                const data = await response.json();
                
                if (data.success) {
                    displayDataSources(data.dataSources);
                }
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                showNotification('Erro ao carregar fontes de dados', 'error');
            }
        }

        // Função para exibir dados
        function displayDataSources(dataSources) {
            const tbody = document.getElementById('dataSourcesTableBody');
            const count = document.getElementById('dataSourcesCount');
            
            tbody.innerHTML = '';
            count.textContent = `${dataSources.length} fontes de dados`;
            
            dataSources.forEach(ds => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${ds.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ds.filename}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ds.recordsCount}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(ds.uploadDate)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editDataSource(${ds.id}, '${ds.name}')" class="text-blue-600 hover:text-blue-900 mr-3">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteDataSource(${ds.id})" class="text-red-600 hover:text-red-900">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Função para editar dados
        function editDataSource(id, name) {
            currentDataSourceId = id;
            document.getElementById('editDataSourceName').value = name;
            document.getElementById('editDataSourceModal').classList.remove('hidden');
        }

        // Função para fechar modal de edição
        function closeEditDataSourceModal() {
            document.getElementById('editDataSourceModal').classList.add('hidden');
            currentDataSourceId = null;
        }

        // Função para salvar edição dos dados
        async function saveDataSourceEdit() {
            const newName = document.getElementById('editDataSourceName').value.trim();
            
            if (!newName) {
                showNotification('Nome não pode estar vazio', 'error');
                return;
            }
            
            try {
                const response = await fetch(`/api/data-sources/${currentDataSourceId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: newName })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Fonte de dados atualizada com sucesso', 'success');
                    closeEditDataSourceModal();
                    loadDataSources();
                } else {
                    showNotification('Erro ao atualizar fonte de dados', 'error');
                }
            } catch (error) {
                console.error('Erro ao atualizar dados:', error);
                showNotification('Erro ao atualizar fonte de dados', 'error');
            }
        }

        // Função para excluir dados
        async function deleteDataSource(id) {
            if (!confirm('Tem certeza que deseja excluir esta fonte de dados? Esta ação não pode ser desfeita.')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/data-sources/${id}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Fonte de dados excluída com sucesso', 'success');
                    loadDataSources();
                } else {
                    showNotification('Erro ao excluir fonte de dados', 'error');
                }
            } catch (error) {
                console.error('Erro ao excluir dados:', error);
                showNotification('Erro ao excluir fonte de dados', 'error');
            }
        }

        // Função para formatar data
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        }

        // Função para obter cor do status
        function getStatusColor(status) {
            switch(status) {
                case 'Aberto':
                    return 'bg-yellow-100 text-yellow-800';
                case 'Em Andamento':
                    return 'bg-blue-100 text-blue-800';
                case 'Resolvido':
                    return 'bg-green-100 text-green-800';
                case 'Fechado':
                    return 'bg-gray-100 text-gray-800';
                default:
                    return 'bg-gray-100 text-gray-800';
            }
        }



        // Função para obter título do gráfico
        function getChartTitle(chartId) {
            const titles = {
                'statusChart': 'Distribuição por Status',
                'responsavelChart': 'Tickets por Responsável',
                'tempoChart': 'Evolução do Tempo de Resolução',
                'classificacaoChart': 'Distribuição por Classificação',
                'radarChart': 'Métricas de Performance',
                'scatterChart': 'Correlação Tempo vs Prioridade'
            };
            return titles[chartId] || 'Gráfico';
        }

        // Função para adicionar descrições informativas aos gráficos
        function addChartDescriptions() {
            const descriptions = {
                'statusChart': 'Mostra a distribuição dos tickets por status atual (Aberto, Em Andamento, Resolvido, Fechado). Útil para identificar gargalos no processo.',
                'responsavelChart': 'Exibe a quantidade de tickets por responsável. Ajuda a identificar sobrecarga de trabalho e distribuição de tarefas.',
                'tempoChart': 'Apresenta a evolução do tempo médio de resolução ao longo do tempo. Permite identificar tendências de melhoria ou degradação.',
                'classificacaoChart': 'Distribuição dos tickets por prioridade/classificação do cliente. Importante para gestão de SLA e priorização.',
                'radarChart': 'Métricas de performance em formato radar. Inclui tempo médio, satisfação, prioridade, complexidade e urgência.',
                'scatterChart': 'Correlação entre tempo de resolução e prioridade. Ajuda a identificar se tickets de alta prioridade são resolvidos mais rapidamente.'
            };
            
            Object.keys(descriptions).forEach(chartId => {
                const container = document.querySelector(`[data-chart-id="${chartId}"]`);
                if (container) {
                    const header = container.querySelector('.chart-header');
                    if (header) {
                        const infoIcon = document.createElement('i');
                        infoIcon.className = 'fas fa-info-circle text-blue-500 ml-2 cursor-help';
                        infoIcon.title = descriptions[chartId];
                        header.appendChild(infoIcon);
                    }
                }
            });
        }

        // Atualizar cards para serem clicáveis
        function updateCardsToClickable() {
            // Total de tickets
            const totalCard = document.querySelector('[data-stat="total"]');
            if (totalCard) {
                totalCard.style.cursor = 'pointer';
                totalCard.onclick = () => openTicketsModal('total');
            }
            
            // Tickets em aberto
            const abertosCard = document.querySelector('[data-stat="abertos"]');
            if (abertosCard) {
                abertosCard.style.cursor = 'pointer';
                abertosCard.onclick = () => openTicketsModal('abertos');
            }
            
            // Tickets resolvidos
            const resolvidosCard = document.querySelector('[data-stat="resolvidos"]');
            if (resolvidosCard) {
                resolvidosCard.style.cursor = 'pointer';
                resolvidosCard.onclick = () => openTicketsModal('resolvidos');
            }
            
            // Dados
            const dataSourcesCard = document.querySelector('[data-stat="dataSources"]');
            if (dataSourcesCard) {
                dataSourcesCard.style.cursor = 'pointer';
                dataSourcesCard.onclick = openDataSourcesModal;
            }
        }

        // Atualizar texto do card de dados
        function updateDataSourcesCard() {
            const dataSourcesCard = document.querySelector('[data-stat="dataSources"]');
            if (dataSourcesCard) {
                const title = dataSourcesCard.querySelector('.text-lg');
                if (title) {
                    title.textContent = 'Dados Importados';
                }
            }
        }

        // Funções para modais de tickets
        function openTicketsModal(type) {
            currentFilterType = type;
            const modal = document.getElementById('ticketsModal');
            const title = document.getElementById('ticketsModalTitle');
            
            switch(type) {
                case 'all':
                    title.textContent = 'Todos os Tickets';
                    break;
                case 'open':
                    title.textContent = 'Tickets em Aberto';
                    break;
                case 'resolved':
                    title.textContent = 'Tickets Resolvidos';
                    break;
            }
            
            modal.classList.remove('hidden');
            loadTicketsData();
        }

        function closeTicketsModal() {
            document.getElementById('ticketsModal').classList.add('hidden');
        }

        async function loadTicketsData() {
            try {
                const response = await fetch('/api/tickets');
                const data = await response.json();
                
                if (data.success) {
                    currentTicketsData = data.tickets;
                    applyFilters();
                }
            } catch (error) {
                console.error('Erro ao carregar tickets:', error);
            }
        }

        function applyFilters() {
            let filteredData = [...currentTicketsData];
            
            // Aplicar filtro por tipo
            if (currentFilterType === 'open') {
                filteredData = filteredData.filter(ticket => 
                    ticket.STATUS === 'Aberto' || ticket.STATUS === 'Em Andamento'
                );
            } else if (currentFilterType === 'resolved') {
                filteredData = filteredData.filter(ticket => 
                    ticket.STATUS === 'Resolvido' || ticket.STATUS === 'Fechado'
                );
            }
            
            // Aplicar filtros adicionais
            const statusFilter = document.getElementById('statusFilter').value;
            const responsavelFilter = document.getElementById('responsavelFilter').value;
            const clienteFilter = document.getElementById('clienteFilter').value;
            const dataSourceFilter = document.getElementById('dataSourceFilter').value;
            
            if (statusFilter) {
                filteredData = filteredData.filter(ticket => ticket.STATUS === statusFilter);
            }
            
            if (responsavelFilter) {
                filteredData = filteredData.filter(ticket => 
                    ticket.RESPONSAVEL && ticket.RESPONSAVEL.toLowerCase().includes(responsavelFilter.toLowerCase())
                );
            }
            
            if (clienteFilter) {
                filteredData = filteredData.filter(ticket => 
                    ticket.CLIENTE_COMPLETO && ticket.CLIENTE_COMPLETO.toLowerCase().includes(clienteFilter.toLowerCase())
                );
            }
            
            if (dataSourceFilter) {
                filteredData = filteredData.filter(ticket => ticket.DATA_SOURCE === dataSourceFilter);
            }
            
            renderTicketsTable(filteredData);
        }

        function clearFilters() {
            document.getElementById('statusFilter').value = '';
            document.getElementById('responsavelFilter').value = '';
            document.getElementById('clienteFilter').value = '';
            document.getElementById('dataSourceFilter').value = '';
            applyFilters();
        }

        function renderTicketsTable(tickets) {
            const tbody = document.getElementById('ticketsTableBody');
            const countElement = document.getElementById('ticketsCount');
            
            tbody.innerHTML = '';
            countElement.textContent = `${tickets.length} tickets encontrados`;
            
            tickets.forEach(ticket => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${ticket.NUMERO_TICKET || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(ticket.ABERTO_EM)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${ticket.RESPONSAVEL || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.CLIENTE_COMPLETO || '-'}</td>
                    <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate" title="${ticket.ASSUNTO || '-'}">${ticket.ASSUNTO || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.TEMPO_VIDA_HORAS ? `${ticket.TEMPO_VIDA_HORAS}h` : '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(ticket.STATUS)}">
                            ${ticket.STATUS || '-'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.DATA_SOURCE || '-'}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function getStatusColor(status) {
            switch(status) {
                case 'Aberto': return 'bg-yellow-100 text-yellow-800';
                case 'Em Andamento': return 'bg-blue-100 text-blue-800';
                case 'Resolvido': return 'bg-green-100 text-green-800';
                case 'Fechado': return 'bg-gray-100 text-gray-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function sortTable(column) {
            if (currentSortColumn === column) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                currentSortDirection = 'asc';
            }
            
            applyFilters();
        }

        function exportToExcel() {
            // Implementar exportação para Excel
            alert('Funcionalidade de exportação será implementada em breve!');
        }

        // Funções para dados
        function openDataSourcesModal() {
            document.getElementById('dataSourcesModal').classList.remove('hidden');
            loadDataSources();
        }

        function closeDataSourcesModal() {
            document.getElementById('dataSourcesModal').classList.add('hidden');
        }

        async function loadDataSources() {
            try {
                const response = await fetch('/api/data-sources');
                const data = await response.json();
                
                if (data.success) {
                    dataSources = data.dataSources;
                    renderDataSourcesTable();
                    updateDataSourcesFilter();
                }
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
            }
        }

        function renderDataSourcesTable() {
            const tbody = document.getElementById('dataSourcesTableBody');
            tbody.innerHTML = '';
            
            dataSources.forEach(ds => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${ds.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ds.filename}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatFileSize(ds.fileSize)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ds.recordsCount}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(ds.uploadDate)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editDataSource(${ds.id})" class="text-blue-600 hover:text-blue-900 mr-3">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteDataSource(${ds.id})" class="text-red-600 hover:text-red-900">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function updateDataSourcesFilter() {
            const select = document.getElementById('dataSourceFilter');
            select.innerHTML = '<option value="">Todos</option>';
            
            dataSources.forEach(ds => {
                const option = document.createElement('option');
                option.value = ds.name;
                option.textContent = ds.name;
                select.appendChild(option);
            });
        }

        function formatFileSize(bytes) {
            if (!bytes) return '-';
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
        }

        function editDataSource(id) {
            const ds = dataSources.find(d => d.id === id);
            if (ds) {
                editingDataSourceId = id;
                document.getElementById('editDataSourceName').value = ds.name;
                document.getElementById('editDataSourceModal').classList.remove('hidden');
            }
        }

        function closeEditDataSourceModal() {
            document.getElementById('editDataSourceModal').classList.add('hidden');
            editingDataSourceId = null;
        }

        async function saveDataSource() {
            const name = document.getElementById('editDataSourceName').value;
            
            try {
                const response = await fetch(`/api/data-sources/${editingDataSourceId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name })
                });
                
                if (response.ok) {
                    closeEditDataSourceModal();
                    loadDataSources();
                    loadDashboardStats();
                }
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
            }
        }

        async function deleteDataSource(id) {
            if (confirm('Tem certeza que deseja excluir estes dados? Esta ação não pode ser desfeita.')) {
                try {
                    const response = await fetch(`/api/data-sources/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        loadDataSources();
                        loadDashboardStats();
                    }
                } catch (error) {
                    console.error('Erro ao excluir dados:', error);
                }
            }
        }

        // Variáveis globais para modais (já declaradas anteriormente)
        // let currentTicketsData = [];
        // let currentFilterType = 'all';
        // let currentSortColumn = '';
        // let currentSortDirection = 'asc';
        // let dataSources = [];
        // let editingDataSourceId = null;

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Adicionar event listener para o formulário de edição de dados
            const editForm = document.getElementById('editDataSourceForm');
            if (editForm) {
                editForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveDataSource();
                });
            }
        });

        // Atualizar loadDashboardStats para incluir dados
        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/dashboard/stats');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    
                    document.getElementById('totalTicketsCard').textContent = stats.TOTAL_TICKETS || 0;
                    document.getElementById('ticketsAbertosCard').textContent = stats.TICKETS_ABERTOS || 0;
                    document.getElementById('ticketsResolvidosCard').textContent = stats.TICKETS_FECHADOS || 0;
                    
                    // Carregar contagem de dados
                    const dsResponse = await fetch('/api/data-sources');
                    const dsData = await dsResponse.json();
                    if (dsData.success) {
                        document.getElementById('dataSourcesCard').textContent = dsData.dataSources.length || 0;
                    }
                    
                    updateCharts(stats);
                }
            } catch (error) {
                console.error('Erro ao carregar estatísticas:', error);
            }
        }

        // ... existing code ...
    </script>
</body>
</html>