<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anydesk Control - Sistema de BI</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* Anima√ß√µes personalizadas */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0, -30px, 0); }
            70% { transform: translate3d(0, -15px, 0); }
            90% { transform: translate3d(0, -4px, 0); }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes highlight {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 99999;
            display: none;
            pointer-events: none;
        }
        
        .tutorial-overlay.active {
            pointer-events: auto;
        }
        
        .tutorial-step {
            position: absolute;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            z-index: 100000;
            animation: fadeInUp 0.5s ease-out;
            pointer-events: auto;
        }
        
        .tutorial-highlight {
            position: relative;
            z-index: 10001;
            animation: highlight 2s infinite;
        }
        
        .tutorial-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border: 10px solid transparent;
        }
        
        .tutorial-arrow.top {
            border-bottom-color: white;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .tutorial-arrow.bottom {
            border-top-color: white;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .tutorial-arrow.left {
            border-right-color: white;
            left: -20px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .tutorial-arrow.right {
            border-left-color: white;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .tutorial-arrow.center {
            display: none;
        }
        
        .tutorial-progress {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 100002;
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
        }
        
        .tutorial-skip {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 16px;
            border-radius: 20px;
            z-index: 100002;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            color: #1f2937;
            font-weight: 600;
        }
        
        .tutorial-skip:hover {
            background: white;
            transform: scale(1.05);
        }
        
        .tutorial-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .tutorial-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .tutorial-button.secondary {
            background: #6b7280;
        }
        
        .tutorial-button.secondary:hover {
            background: #4b5563;
        }
        
        .tutorial-icon {
            font-size: 24px;
            margin-bottom: 10px;
            color: #667eea;
        }
        
        .tutorial-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #1f2937;
        }
        
        .tutorial-description {
            font-size: 14px;
            color: #6b7280;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .tutorial-feature-list {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
                 .tutorial-feature-item {
             display: flex;
             align-items: center;
             margin: 5px 0;
             font-size: 13px;
             color: #374151;
         }
        
        .tutorial-feature-item i {
            margin-right: 8px;
            color: #10b981;
            width: 16px;
        }
        
        .tutorial-demo {
            background: #f8fafc;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            color: #64748b;
        }
        
        .tutorial-demo i {
            font-size: 32px;
            margin-bottom: 10px;
            color: #667eea;
        }
        
        /* Anima√ß√µes para elementos espec√≠ficos */
        .animate-pulse-slow {
            animation: pulse 2s infinite;
        }
        
        .animate-bounce-slow {
            animation: bounce 2s infinite;
        }
        
        .animate-slide-in {
            animation: slideInRight 0.6s ease-out;
        }
        
        /* Estilos para o modal de tutorial */
        .tutorial-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            z-index: 10003;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: fadeInUp 0.5s ease-out;
        }
        
        .tutorial-modal-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .tutorial-modal-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .tutorial-modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 10px;
        }
        
        .tutorial-modal-subtitle {
            font-size: 16px;
            color: #6b7280;
        }
        
        .tutorial-modal-content {
            margin-bottom: 25px;
        }
        
        .tutorial-modal-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        /* Estilos para tooltips */
        .tutorial-tooltip {
            position: absolute;
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10004;
            pointer-events: none;
        }
        
        .tutorial-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #1f2937;
        }
        
        /* Corrigir layout infinito */
        body {
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .grid {
            max-width: 100%;
            overflow: hidden;
        }
        
        canvas {
            max-height: 300px !important;
        }
        
        /* Garantir que os gr√°ficos n√£o estiquem infinitamente */
        .bg-gray-800 {
            overflow: hidden;
        }
        
        /* Corrigir altura dos containers de gr√°ficos */
        .bg-gray-800 canvas {
            height: 200px !important;
            max-height: 200px !important;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Overlay do Tutorial -->
    <div id="tutorialOverlay" class="tutorial-overlay"></div>
    
    <!-- Progresso do Tutorial -->
    <div id="tutorialProgress" class="tutorial-progress" style="display: none;">
        <i class="fas fa-play-circle mr-2"></i>
        <span id="tutorialStepText">Passo 1 de 12</span>
    </div>
    
    <!-- Bot√£o Pular Tutorial -->
    <div id="tutorialSkip" class="tutorial-skip" style="display: none;">
        <i class="fas fa-times mr-2"></i>
        Pular Tutorial
    </div>
    
    <!-- Modal de In√≠cio do Tutorial -->
    <div id="tutorialModal" class="tutorial-modal" style="display: none;">
        <div class="tutorial-modal-header">
            <div class="tutorial-modal-icon">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <div class="tutorial-modal-title">Bem-vindo ao Anydesk Control!</div>
            <div class="tutorial-modal-subtitle">Sistema de Business Intelligence para An√°lise de Tickets</div>
        </div>
        
        <div class="tutorial-modal-content">
            <p class="text-gray-600 mb-4">
                Este tutorial ir√° gui√°-lo atrav√©s de todas as funcionalidades do sistema:
            </p>
            
            <div class="tutorial-feature-list">
                <div class="tutorial-feature-item">
                    <i class="fas fa-file-excel"></i>
                    <span>Importa√ß√£o de arquivos Excel</span>
                </div>
                <div class="tutorial-feature-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>Cria√ß√£o e edi√ß√£o de gr√°ficos</span>
                </div>
                <div class="tutorial-feature-item">
                    <i class="fas fa-sort"></i>
                    <span>Ordena√ß√£o e agrupamento de dados</span>
                </div>
                <div class="tutorial-feature-item">
                    <i class="fas fa-user-edit"></i>
                    <span>Gest√£o de perfil do usu√°rio</span>
                </div>
                <div class="tutorial-feature-item">
                    <i class="fas fa-cog"></i>
                    <span>Configura√ß√µes e personaliza√ß√£o</span>
                </div>
            </div>
        </div>
        
        <div class="tutorial-modal-actions">
            <button class="tutorial-button secondary" onclick="skipTutorial()">
                <i class="fas fa-times mr-2"></i>
                Pular Tutorial
            </button>
            <button class="tutorial-button" onclick="startTutorial()">
                <i class="fas fa-play mr-2"></i>
                Come√ßar Tutorial
            </button>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-gray-800 shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="text-2xl font-bold text-blue-400">
                        <i class="fas fa-chart-line mr-2"></i>
                        Anydesk Control
                    </div>
                    <span class="text-sm text-gray-400">Sistema de BI</span>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Seletor de Data Source -->
                    <div class="flex items-center space-x-2">
                        <label class="text-gray-300 text-sm">Data Source:</label>
                        <select id="dataSourceSelector" class="bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white text-sm">
                            <option value="">Selecione um Data Source</option>
                        </select>
                    </div>
                    
                    <!-- Bot√£o Tutorial -->
                    <button id="tutorialBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center">
                        <i class="fas fa-graduation-cap mr-2"></i>
                        Tutorial
                    </button>
                    
                    <!-- Bot√£o Importar Excel -->
                    <button id="importExcelBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center">
                        <i class="fas fa-file-excel mr-2"></i>
                        Importar Excel
                    </button>
                    
                    <!-- Bot√£o Configura√ß√µes -->
                    <button id="settingsBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

         <!-- Main Content -->
     <main class="container mx-auto px-6 py-8">
         <!-- Cards de Resumo -->
         <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
             <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                 <div class="flex items-center">
                     <div class="p-3 rounded-full bg-blue-500 bg-opacity-10">
                         <i class="fas fa-ticket-alt text-blue-400 text-xl"></i>
                     </div>
                     <div class="ml-4">
                         <p class="text-sm font-medium text-gray-400">Total de Tickets</p>
                         <p class="text-2xl font-semibold text-white" id="totalTicketsCard">0</p>
                     </div>
                 </div>
             </div>
             
             <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                 <div class="flex items-center">
                     <div class="p-3 rounded-full bg-yellow-500 bg-opacity-10">
                         <i class="fas fa-clock text-yellow-400 text-xl"></i>
                     </div>
                     <div class="ml-4">
                         <p class="text-sm font-medium text-gray-400">Em Aberto</p>
                         <p class="text-2xl font-semibold text-white" id="ticketsAbertosCard">0</p>
                     </div>
                 </div>
             </div>
             
             <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                 <div class="flex items-center">
                     <div class="p-3 rounded-full bg-green-500 bg-opacity-10">
                         <i class="fas fa-check-circle text-green-400 text-xl"></i>
                     </div>
                     <div class="ml-4">
                         <p class="text-sm font-medium text-gray-400">Resolvidos</p>
                         <p class="text-2xl font-semibold text-white" id="ticketsResolvidosCard">0</p>
                     </div>
                 </div>
             </div>
             
             <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                 <div class="flex items-center">
                     <div class="p-3 rounded-full bg-purple-500 bg-opacity-10">
                         <i class="fas fa-database text-purple-400 text-xl"></i>
                     </div>
                     <div class="ml-4">
                         <p class="text-sm font-medium text-gray-400">Data Sources</p>
                         <p class="text-2xl font-semibold text-white" id="dataSourcesCard">0</p>
                     </div>
                 </div>
             </div>
         </div>
         
         <!-- Se√ß√£o de Estat√≠sticas Detalhadas -->
         <div class="bg-gray-800 rounded-lg p-6 shadow-lg mb-6">
             <h3 class="text-lg font-semibold text-blue-400 mb-4">
                 <i class="fas fa-chart-line mr-2"></i>
                 Estat√≠sticas Detalhadas
             </h3>
             <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                 <div class="text-center">
                     <div class="text-2xl font-bold text-green-400" id="avgResolutionTime">0h</div>
                     <div class="text-sm text-gray-400">Tempo M√©dio de Resolu√ß√£o</div>
                 </div>
                 <div class="text-center">
                     <div class="text-2xl font-bold text-yellow-400" id="criticalTickets">0</div>
                     <div class="text-sm text-gray-400">Tickets Cr√≠ticos</div>
                 </div>
                 <div class="text-center">
                     <div class="text-2xl font-bold text-red-400" id="highPriorityTickets">0</div>
                     <div class="text-sm text-gray-400">Alta Prioridade</div>
                 </div>
                 <div class="text-center">
                     <div class="text-2xl font-bold text-blue-400" id="activeResponsibles">0</div>
                     <div class="text-sm text-gray-400">Respons√°veis Ativos</div>
                 </div>
             </div>
         </div>
         
         <!-- Dashboard Controls -->
         <div class="flex justify-between items-center mb-6">
             <div class="flex items-center space-x-4">
                 <h2 class="text-2xl font-bold text-white">Dashboard</h2>
                 <select id="dashboardSelector" class="bg-gray-700 text-white px-4 py-2 rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none">
                     <option value="main">Dashboard Principal</option>
                 </select>
             </div>
             <div class="flex space-x-3">
                 <button onclick="createNewDashboard()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors">
                     <i class="fas fa-plus"></i>
                     <span>Novo Dashboard</span>
                 </button>
                 <button onclick="deleteCurrentDashboard()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors">
                     <i class="fas fa-trash"></i>
                     <span>Excluir</span>
                 </button>
             </div>
         </div>
         
         <!-- Dashboard Grid -->
         <div id="dashboardGrid" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
            <!-- Gr√°fico 1: Tickets por Status -->
            <div id="chart1" class="bg-gray-800 rounded-lg p-6 shadow-lg cursor-move">
                <div class="flex justify-between items-center mb-4">
                                             <h3 class="text-lg font-semibold text-blue-400">
                             <i class="fas fa-chart-pie mr-2"></i>
                             Tickets por Status
                         </h3>
                         <div class="flex space-x-2">
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('statusChart', 'Tickets por Status')">
                                 <i class="fas fa-edit"></i>
                             </button>
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('statusChart')">
                                 <i class="fas fa-expand"></i>
                             </button>
                         </div>
                </div>
                <canvas id="statusChart" height="200"></canvas>
            </div>

            <!-- Gr√°fico 2: Tickets por Respons√°vel -->
            <div id="chart2" class="bg-gray-800 rounded-lg p-6 shadow-lg cursor-move">
                <div class="flex justify-between items-center mb-4">
                                             <h3 class="text-lg font-semibold text-green-400">
                             <i class="fas fa-users mr-2"></i>
                             Tickets por Respons√°vel
                         </h3>
                         <div class="flex space-x-2">
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('responsavelChart', 'Tickets por Respons√°vel')">
                                 <i class="fas fa-edit"></i>
                             </button>
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('responsavelChart')">
                                 <i class="fas fa-expand"></i>
                             </button>
                         </div>
                </div>
                <canvas id="responsavelChart" height="200"></canvas>
            </div>

            <!-- Gr√°fico 3: Tempo de Resolu√ß√£o -->
            <div id="chart3" class="bg-gray-800 rounded-lg p-6 shadow-lg cursor-move">
                <div class="flex justify-between items-center mb-4">
                                             <h3 class="text-lg font-semibold text-yellow-400">
                             <i class="fas fa-clock mr-2"></i>
                             Tempo de Resolu√ß√£o
                         </h3>
                         <div class="flex space-x-2">
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('tempoChart', 'Tempo de Resolu√ß√£o')">
                                 <i class="fas fa-edit"></i>
                             </button>
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('tempoChart')">
                                 <i class="fas fa-expand"></i>
                             </button>
                         </div>
                </div>
                <canvas id="tempoChart" height="200"></canvas>
            </div>

            <!-- Gr√°fico 4: Tickets por Classifica√ß√£o -->
            <div id="chart4" class="bg-gray-800 rounded-lg p-6 shadow-lg cursor-move">
                <div class="flex justify-between items-center mb-4">
                                             <h3 class="text-lg font-semibold text-red-400">
                             <i class="fas fa-exclamation-triangle mr-2"></i>
                             Tickets por Classifica√ß√£o
                         </h3>
                         <div class="flex space-x-2">
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('classificacaoChart', 'Tickets por Classifica√ß√£o')">
                                 <i class="fas fa-edit"></i>
                             </button>
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('classificacaoChart')">
                                 <i class="fas fa-expand"></i>
                             </button>
                         </div>
                </div>
                <canvas id="classificacaoChart" height="200"></canvas>
            </div>

            <!-- Gr√°fico 5: Radar Chart -->
            <div id="chart5" class="bg-gray-800 rounded-lg p-6 shadow-lg cursor-move">
                <div class="flex justify-between items-center mb-4">
                                             <h3 class="text-lg font-semibold text-purple-400">
                             <i class="fas fa-chart-radar mr-2"></i>
                             Radar Chart
                         </h3>
                         <div class="flex space-x-2">
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('radarChart', 'Radar Chart')">
                                 <i class="fas fa-edit"></i>
                             </button>
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('radarChart')">
                                 <i class="fas fa-expand"></i>
                             </button>
                         </div>
                </div>
                <canvas id="radarChart" height="200"></canvas>
            </div>

            <!-- Gr√°fico 6: Scatter Chart -->
            <div id="chart6" class="bg-gray-800 rounded-lg p-6 shadow-lg cursor-move">
                <div class="flex justify-between items-center mb-4">
                                             <h3 class="text-lg font-semibold text-indigo-400">
                             <i class="fas fa-chart-scatter mr-2"></i>
                             Scatter Chart
                         </h3>
                         <div class="flex space-x-2">
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('scatterChart', 'Scatter Chart')">
                                 <i class="fas fa-edit"></i>
                             </button>
                             <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('scatterChart')">
                                 <i class="fas fa-expand"></i>
                             </button>
                         </div>
                </div>
                <canvas id="scatterChart" height="200"></canvas>
            </div>
        </div>
    </main>

             <!-- Sidebar de Informa√ß√µes -->
    <div class="fixed bottom-4 left-4 bg-gray-800 rounded-lg p-4 shadow-lg max-w-sm">
        <div class="flex items-center space-x-3 mb-3">
            <img id="userAvatar" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiM2QjcyODAiLz4KPHBhdGggZD0iTTIwIDEwQzIyLjIwOTEgMTAgMjQgMTEuNzkwOSAyNCAxNEMyNCAxNi4yMDkxIDIyLjIwOTEgMTggMjAgMThDMTcuNzkwOSAxOCAxNiAxNi4yMDkxIDE2IDE0QzE2IDExLjc5MDkgMTcuNzkwOSAxMCAyMCAxMFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0yOCAyNkMyOCAyOS4zMTM3IDI0LjQxODMgMzIgMjAgMzJDMjUuNTgxNyAzMiAyMiAyOS4zMTM3IDIyIDI2QzIyIDI0LjM0MzEgMjAuNjU2OSAyMyAxOSAyM0MxNy4zNDMxIDIzIDE2IDI0LjM0MzEgMTYgMjZIMjhaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K" alt="Avatar" class="w-10 h-10 rounded-full">
            <div>
                <div id="userName" class="font-semibold text-white">Jo√£o Silva</div>
                <div id="userRole" class="text-sm text-gray-400">Analista de Suporte</div>
            </div>
        </div>
        
        <div class="space-y-2 text-sm">
            <div class="flex justify-between">
                <span class="text-gray-400">Total de Tickets:</span>
                <span id="totalTickets" class="text-white font-semibold">0</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-400">Em Aberto:</span>
                <span id="ticketsAbertos" class="text-yellow-400 font-semibold">0</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-400">Resolvidos:</span>
                <span id="ticketsResolvidos" class="text-green-400 font-semibold">0</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-400">Em Atendimento:</span>
                <span id="ticketsEmAtendimento" class="text-blue-400 font-semibold">0</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-400">Data Sources:</span>
                <span id="dataSourcesCount" class="text-purple-400 font-semibold">0</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-400">Tempo M√©dio:</span>
                <span id="tempoMedio" class="text-orange-400 font-semibold">0h</span>
            </div>
        </div>
        
        <button id="editProfileBtn" class="w-full mt-3 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm transition-colors duration-200">
            <i class="fas fa-edit mr-2"></i>
            Editar Perfil
        </button>
    </div>

            <!-- Modal de Upload Excel -->
        <div id="excelModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-gray-800 rounded-lg p-8 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-white">
                        <i class="fas fa-file-excel mr-2 text-green-400"></i>
                        Importar Excel
                    </h3>
                    <button onclick="closeExcelModal()" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-400 mb-2">Arraste e solte seu arquivo Excel aqui</p>
                        <p class="text-sm text-gray-500">ou</p>
                        <input type="file" id="excelFile" accept=".xlsx,.xls" class="hidden">
                        <button onclick="document.getElementById('excelFile').click()" class="mt-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                            Selecionar Arquivo
                        </button>
                    </div>
                    
                    <div id="fileInfo" class="hidden bg-gray-700 rounded p-3">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white font-semibold" id="fileName"></p>
                                <p class="text-sm text-gray-400 mb-2" id="fileSize"></p>
                                <div class="mb-2">
                                    <label class="block text-gray-300 text-sm mb-1">Nome do Data Source:</label>
                                    <input type="text" id="dataSourceName" placeholder="Ex: Tickets Janeiro 2024" class="w-full bg-gray-600 border border-gray-500 rounded px-2 py-1 text-white text-sm">
                                </div>
                            </div>
                            <button onclick="removeFile()" class="text-red-400 hover:text-red-300">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="closeExcelModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button id="importBtn" onclick="importExcel()" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded" disabled>
                            <i class="fas fa-upload mr-2"></i>
                            Importar
                        </button>
                    </div>
                </div>
            </div>
        </div>

         <!-- Modal de Configura√ß√µes de Gr√°ficos -->
     <div id="chartSettingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
         <div class="bg-gray-800 rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
             <div class="flex justify-between items-center mb-6">
                 <h3 class="text-xl font-semibold text-white">
                     <i class="fas fa-chart-line mr-2 text-blue-400"></i>
                     <span id="chartSettingsTitle">Configura√ß√µes do Gr√°fico</span>
                 </h3>
                 <button onclick="closeChartSettingsModal()" class="text-gray-400 hover:text-white">
                     <i class="fas fa-times"></i>
                 </button>
             </div>
             
             <div class="space-y-6">
                 <!-- Configura√ß√µes de Cores -->
                 <div>
                     <h4 class="text-lg font-semibold text-blue-400 mb-3">
                         <i class="fas fa-palette mr-2"></i>
                         Cores e Estilo
                     </h4>
                     <div class="grid grid-cols-2 gap-4">
                         <div>
                             <label class="block text-gray-300 mb-2">Cor de Fundo</label>
                             <input type="color" id="chartBgColor" class="w-full h-10 rounded border border-gray-600">
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Cor da Borda</label>
                             <input type="color" id="chartBorderColor" class="w-full h-10 rounded border border-gray-600">
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Espessura da Borda</label>
                             <input type="range" id="chartBorderWidth" min="0" max="10" value="2" class="w-full">
                             <span id="borderWidthValue" class="text-sm text-gray-400">2px</span>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Transpar√™ncia</label>
                             <input type="range" id="chartOpacity" min="0" max="100" value="80" class="w-full">
                             <span id="opacityValue" class="text-sm text-gray-400">80%</span>
                         </div>
                     </div>
                 </div>
                 
                 <!-- Configura√ß√µes de Dados -->
                 <div>
                     <h4 class="text-lg font-semibold text-green-400 mb-3">
                         <i class="fas fa-database mr-2"></i>
                         Dados e Valores
                     </h4>
                     <div class="grid grid-cols-2 gap-4">
                         <div>
                             <label class="block text-gray-300 mb-2">Mostrar Valores</label>
                             <select id="chartShowValues" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="true">Sim</option>
                                 <option value="false">N√£o</option>
                             </select>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Formato dos Valores</label>
                             <select id="chartValueFormat" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="number">N√∫mero</option>
                                 <option value="percentage">Porcentagem</option>
                                 <option value="currency">Moeda</option>
                             </select>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Casas Decimais</label>
                             <input type="number" id="chartDecimals" min="0" max="4" value="2" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Agrupar Dados</label>
                             <select id="chartGroupData" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="none">Nenhum</option>
                                 <option value="byMonth">Por M√™s</option>
                                 <option value="byQuarter">Por Trimestre</option>
                                 <option value="byYear">Por Ano</option>
                             </select>
                         </div>
                     </div>
                 </div>
                 
                 <!-- Configura√ß√µes de Layout -->
                 <div>
                     <h4 class="block text-lg font-semibold text-yellow-400 mb-3">
                         <i class="fas fa-layout mr-2"></i>
                         Layout e Posicionamento
                     </h4>
                     <div class="grid grid-cols-2 gap-4">
                         <div>
                             <label class="block text-gray-300 mb-2">Posi√ß√£o da Legenda</label>
                             <select id="chartLegendPosition" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="top">Superior</option>
                                 <option value="bottom">Inferior</option>
                                 <option value="left">Esquerda</option>
                                 <option value="right">Direita</option>
                             </select>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Mostrar Grade</label>
                             <select id="chartShowGrid" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="true">Sim</option>
                                 <option value="false">N√£o</option>
                             </select>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Altura do Gr√°fico</label>
                             <input type="range" id="chartHeight" min="150" max="400" value="200" class="w-full">
                             <span id="heightValue" class="text-sm text-gray-400">200px</span>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Anima√ß√£o</label>
                             <select id="chartAnimation" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="true">Ativada</option>
                                 <option value="false">Desativada</option>
                             </select>
                         </div>
                     </div>
                 </div>
                 
                 <!-- Configura√ß√µes de Filtros -->
                 <div>
                     <h4 class="text-lg font-semibold text-purple-400 mb-3">
                         <i class="fas fa-filter mr-2"></i>
                         Filtros e Limites
                     </h4>
                     <div class="grid grid-cols-2 gap-4">
                         <div>
                             <label class="block text-gray-300 mb-2">Limite de Itens</label>
                             <input type="number" id="chartItemLimit" min="5" max="50" value="10" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Filtrar por Status</label>
                             <select id="chartStatusFilter" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="all">Todos</option>
                                 <option value="aberto">Aberto</option>
                                 <option value="em-atendimento">Em Atendimento</option>
                                 <option value="resolvido">Resolvido</option>
                                 <option value="fechado">Fechado</option>
                             </select>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Filtrar por Prioridade</label>
                             <select id="chartPriorityFilter" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="all">Todas</option>
                                 <option value="cr√≠tico">Cr√≠tico</option>
                                 <option value="alto">Alto</option>
                                 <option value="m√©dio">M√©dio</option>
                                 <option value="baixo">Baixo</option>
                             </select>
                         </div>
                         <div>
                             <label class="block text-gray-300 mb-2">Per√≠odo de Tempo</label>
                             <select id="chartTimeFilter" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                                 <option value="all">Todo Per√≠odo</option>
                                 <option value="today">Hoje</option>
                                 <option value="week">Esta Semana</option>
                                 <option value="month">Este M√™s</option>
                                 <option value="quarter">Este Trimestre</option>
                                 <option value="year">Este Ano</option>
                             </select>
                         </div>
                     </div>
                 </div>
             </div>
             
             <div class="flex space-x-3 mt-8">
                 <button onclick="closeChartSettingsModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
                     Cancelar
                 </button>
                 <button onclick="applyChartSettings()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                     <i class="fas fa-save mr-2"></i>
                     Aplicar Configura√ß√µes
                 </button>
                 <button onclick="resetChartSettings()" class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">
                     <i class="fas fa-undo mr-2"></i>
                     Restaurar Padr√£o
                 </button>
             </div>
         </div>
     </div>

     <!-- Modal de Configura√ß√µes -->
     <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-white">
                    <i class="fas fa-cog mr-2 text-blue-400"></i>
                    Configura√ß√µes
                </h3>
                <button onclick="closeSettingsModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-300 mb-2">Nome</label>
                    <input type="text" id="profileName" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                </div>
                
                <div>
                    <label class="block text-gray-300 mb-2">Cargo</label>
                    <input type="text" id="profileRole" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                </div>
                
                <div>
                    <label class="block text-gray-300 mb-2">Foto de Perfil</label>
                    <input type="file" id="profilePicture" accept="image/*" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="closeSettingsModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
                        Cancelar
                    </button>
                    <button onclick="saveProfile()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                        <i class="fas fa-save mr-2"></i>
                        Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sistema de Tutorial
        let tutorialStep = 0;
        let tutorialActive = false;
        
        // Sistema de Data Sources
        let dataSources = [];
        let currentDataSource = null;
        const tutorialSteps = [
            {
                id: 'welcome',
                title: 'Bem-vindo ao Anydesk Control!',
                description: 'Este √© um sistema de Business Intelligence para an√°lise de tickets. Vamos explorar todas as funcionalidades.',
                target: null,
                position: 'center',
                icon: 'fas fa-graduation-cap'
            },
            {
                id: 'import-excel',
                title: 'Importa√ß√£o de Arquivos Excel',
                description: 'Clique aqui para importar seus dados de tickets em formato Excel. O sistema aceita arquivos .xlsx e .xls.',
                target: '#importExcelBtn',
                position: 'bottom',
                icon: 'fas fa-file-excel'
            },
            {
                id: 'dashboard-overview',
                title: 'Dashboard Interativo',
                description: 'Aqui voc√™ encontra 6 gr√°ficos diferentes que se atualizam automaticamente com seus dados.',
                target: '.grid',
                position: 'top',
                icon: 'fas fa-chart-bar'
            },
            {
                id: 'chart-drag',
                title: 'Gr√°ficos Arrast√°veis',
                description: 'Voc√™ pode arrastar e reorganizar os gr√°ficos conforme sua prefer√™ncia. Clique e arraste para mover.',
                target: '#chart1',
                position: 'bottom',
                icon: 'fas fa-arrows-alt'
            },
            {
                id: 'chart-edit',
                title: 'Edi√ß√£o de Gr√°ficos',
                description: 'Clique no √≠cone de edi√ß√£o para personalizar cores, t√≠tulos e configura√ß√µes do gr√°fico.',
                target: '#chart1 .fa-edit',
                position: 'left',
                icon: 'fas fa-edit'
            },
            {
                id: 'chart-expand',
                title: 'Expandir Gr√°ficos',
                description: 'Use o √≠cone de expandir para ver o gr√°fico em tela cheia para melhor an√°lise.',
                target: '#chart1 .fa-expand',
                position: 'left',
                icon: 'fas fa-expand'
            },
            {
                id: 'data-grouping',
                title: 'Agrupamento de Dados',
                description: 'Os dados s√£o automaticamente agrupados por status, respons√°vel, classifica√ß√£o e outros crit√©rios.',
                target: '#chart2',
                position: 'top',
                icon: 'fas fa-layer-group'
            },
            {
                id: 'priority-sorting',
                title: 'Ordena√ß√£o por Prioridade',
                description: 'Os tickets s√£o ordenados automaticamente por classifica√ß√£o: cr√≠tico, alto, m√©dio, baixo.',
                target: '#chart4',
                position: 'top',
                icon: 'fas fa-sort-amount-down'
            },
            {
                id: 'profile-section',
                title: 'Se√ß√£o de Perfil',
                description: 'Aqui voc√™ pode ver suas informa√ß√µes e estat√≠sticas pessoais de tickets.',
                target: '.fixed.bottom-4.left-4',
                position: 'right',
                icon: 'fas fa-user'
            },
            {
                id: 'edit-profile',
                title: 'Editar Perfil',
                description: 'Clique aqui para alterar seu nome, cargo e foto de perfil.',
                target: '#editProfileBtn',
                position: 'top',
                icon: 'fas fa-user-edit'
            },
            {
                id: 'tutorial-button',
                title: 'Acesso ao Tutorial',
                description: 'Voc√™ pode acessar este tutorial a qualquer momento clicando neste bot√£o.',
                target: '#tutorialBtn',
                position: 'bottom',
                icon: 'fas fa-graduation-cap'
            },
            {
                id: 'completion',
                title: 'Tutorial Conclu√≠do!',
                description: 'Parab√©ns! Voc√™ conhece todas as funcionalidades do Anydesk Control. Agora pode come√ßar a usar o sistema.',
                target: null,
                position: 'center',
                icon: 'fas fa-check-circle'
            }
        ];

        // Inicializar tutorial
        function initTutorial() {
            // Verificar se √© a primeira visita
            if (!localStorage.getItem('tutorialCompleted')) {
                showTutorialModal();
            }
        }

        // Mostrar modal de in√≠cio do tutorial
        function showTutorialModal() {
            const modal = document.getElementById('tutorialModal');
            const overlay = document.getElementById('tutorialOverlay');
            
            if (modal) modal.style.display = 'block';
            if (overlay) overlay.style.display = 'block';
        }

        // Iniciar tutorial
        function startTutorial() {
            const modal = document.getElementById('tutorialModal');
            if (modal) modal.style.display = 'none';
            tutorialActive = true;
            tutorialStep = 0;
            showTutorialStep();
        }

        // Pular tutorial
        function skipTutorial() {
            const modal = document.getElementById('tutorialModal');
            if (modal) modal.style.display = 'none';
            
            const overlay = document.getElementById('tutorialOverlay');
            if (overlay) {
                overlay.style.display = 'none';
                overlay.classList.remove('active');
            }
            
            const progressContainer = document.getElementById('tutorialProgress');
            const skipContainer = document.getElementById('tutorialSkip');
            
            if (progressContainer) progressContainer.style.display = 'none';
            if (skipContainer) skipContainer.style.display = 'none';
            
            tutorialActive = false;
            localStorage.setItem('tutorialCompleted', 'true');
            removeTutorialHighlights();
            
            // Remover tooltip atual
            const existingTooltip = document.querySelector('.tutorial-step');
            if (existingTooltip) {
                existingTooltip.remove();
            }
        }

        // Mostrar passo do tutorial
        function showTutorialStep() {
            if (!tutorialActive || tutorialStep >= tutorialSteps.length) {
                completeTutorial();
                return;
            }

            const step = tutorialSteps[tutorialStep];
            
            // Atualizar progresso
            const progressElement = document.getElementById('tutorialStepText');
            if (progressElement) {
                progressElement.textContent = `Passo ${tutorialStep + 1} de ${tutorialSteps.length}`;
            }
            
            const progressContainer = document.getElementById('tutorialProgress');
            const skipContainer = document.getElementById('tutorialSkip');
            
            if (progressContainer) progressContainer.style.display = 'block';
            if (skipContainer) skipContainer.style.display = 'block';
            
            // Mostrar overlay
            const overlay = document.getElementById('tutorialOverlay');
            if (overlay) {
                overlay.style.display = 'block';
                overlay.classList.add('active');
            }
            
            // Remover highlights anteriores
            removeTutorialHighlights();
            
            // Criar tooltip do tutorial
            createTutorialTooltip(step);
            
            // Adicionar highlight ao elemento alvo
            if (step.target) {
                const targetElement = document.querySelector(step.target);
                if (targetElement) {
                    targetElement.classList.add('tutorial-highlight');
                }
            }
        }

        // Criar tooltip do tutorial
        function createTutorialTooltip(step) {
            // Remover tooltips anteriores
            const existingTooltip = document.querySelector('.tutorial-step');
            if (existingTooltip) {
                existingTooltip.remove();
            }
            
            const tooltip = document.createElement('div');
            tooltip.className = 'tutorial-step';
            tooltip.innerHTML = `
                <div class="tutorial-icon">
                    <i class="${step.icon}"></i>
                </div>
                <div class="tutorial-title">${step.title}</div>
                <div class="tutorial-description">${step.description}</div>
                <div class="tutorial-arrow ${step.position}"></div>
                <div class="flex justify-between mt-4">
                    <button class="tutorial-button secondary" onclick="previousTutorialStep()" ${tutorialStep === 0 ? 'disabled' : ''}>
                        <i class="fas fa-chevron-left mr-2"></i>
                        Anterior
                    </button>
                    <button class="tutorial-button" onclick="nextTutorialStep()">
                        ${tutorialStep === tutorialSteps.length - 1 ? 'Concluir' : 'Pr√≥ximo'}
                        <i class="fas fa-chevron-right ml-2"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(tooltip);
            
            // Posicionar tooltip
            positionTutorialTooltip(tooltip, step);
        }

        // Posicionar tooltip
        function positionTutorialTooltip(tooltip, step) {
            if (!step.target) {
                // Centralizar se n√£o h√° alvo
                tooltip.style.top = '50%';
                tooltip.style.left = '50%';
                tooltip.style.transform = 'translate(-50%, -50%)';
                return;
            }
            
            const targetElement = document.querySelector(step.target);
            if (!targetElement) return;
            
            const targetRect = targetElement.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
            
            let top, left;
            
            switch (step.position) {
                case 'top':
                    top = targetRect.top - tooltipRect.height - 20;
                    left = targetRect.left + (targetRect.width / 2) - (tooltipRect.width / 2);
                    break;
                case 'bottom':
                    top = targetRect.bottom + 20;
                    left = targetRect.left + (targetRect.width / 2) - (tooltipRect.width / 2);
                    break;
                case 'left':
                    top = targetRect.top + (targetRect.height / 2) - (tooltipRect.height / 2);
                    left = targetRect.left - tooltipRect.width - 20;
                    break;
                case 'right':
                    top = targetRect.top + (targetRect.height / 2) - (tooltipRect.height / 2);
                    left = targetRect.right + 20;
                    break;
                default:
                    top = targetRect.top + (targetRect.height / 2) - (tooltipRect.height / 2);
                    left = targetRect.left + (targetRect.width / 2) - (tooltipRect.width / 2);
            }
            
            // Ajustar para n√£o sair da tela
            if (top < 20) top = 20;
            if (left < 20) left = 20;
            if (top + tooltipRect.height > window.innerHeight - 20) {
                top = window.innerHeight - tooltipRect.height - 20;
            }
            if (left + tooltipRect.width > window.innerWidth - 20) {
                left = window.innerWidth - tooltipRect.width - 20;
            }
            
            tooltip.style.top = top + 'px';
            tooltip.style.left = left + 'px';
            
            // Ajustar posi√ß√£o da seta para ficar centralizada
            setTimeout(() => {
                const arrow = tooltip.querySelector('.tutorial-arrow');
                if (arrow && step.target) {
                    const targetRect = targetElement.getBoundingClientRect();
                    const tooltipRect = tooltip.getBoundingClientRect();
                    
                    if (step.position === 'top' || step.position === 'bottom') {
                        const arrowLeft = targetRect.left + (targetRect.width / 2) - tooltipRect.left - 10;
                        arrow.style.left = arrowLeft + 'px';
                    } else if (step.position === 'left' || step.position === 'right') {
                        const arrowTop = targetRect.top + (targetRect.height / 2) - tooltipRect.top - 10;
                        arrow.style.top = arrowTop + 'px';
                    }
                }
            }, 10);
        }

        // Pr√≥ximo passo do tutorial
        function nextTutorialStep() {
            tutorialStep++;
            showTutorialStep();
        }

        // Passo anterior do tutorial
        function previousTutorialStep() {
            if (tutorialStep > 0) {
                tutorialStep--;
                showTutorialStep();
            }
        }

        // Completar tutorial
        function completeTutorial() {
            tutorialActive = false;
            const overlay = document.getElementById('tutorialOverlay');
            if (overlay) {
                overlay.style.display = 'none';
                overlay.classList.remove('active');
            }
            
            const progressContainer = document.getElementById('tutorialProgress');
            const skipContainer = document.getElementById('tutorialSkip');
            
            if (progressContainer) progressContainer.style.display = 'none';
            if (skipContainer) skipContainer.style.display = 'none';
            
            removeTutorialHighlights();
            localStorage.setItem('tutorialCompleted', 'true');
            
            // Remover tooltip atual
            const existingTooltip = document.querySelector('.tutorial-step');
            if (existingTooltip) {
                existingTooltip.remove();
            }
            
            // Mostrar mensagem de conclus√£o
            showCompletionMessage();
        }

        // Remover highlights do tutorial
        function removeTutorialHighlights() {
            document.querySelectorAll('.tutorial-highlight').forEach(el => {
                el.classList.remove('tutorial-highlight');
            });
        }

        // Mostrar mensagem de conclus√£o
        function showCompletionMessage() {
            const message = document.createElement('div');
            message.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-4 rounded-lg shadow-lg z-50 animate-slide-in';
            message.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-check-circle mr-3 text-xl"></i>
                    <div>
                        <div class="font-semibold">Tutorial Conclu√≠do!</div>
                        <div class="text-sm opacity-90">Voc√™ est√° pronto para usar o sistema.</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.remove();
            }, 5000);
        }

        // Event listeners para tutorial
        document.getElementById('tutorialBtn').addEventListener('click', () => {
            if (!tutorialActive) {
                tutorialStep = 0;
                startTutorial();
            }
        });

        document.getElementById('tutorialSkip').addEventListener('click', skipTutorial);

        // Inicializar tutorial na carga da p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            try {
                initTutorial();
                initializeCharts();
                initializeSortable();
                loadInitialData();
            } catch (error) {
                console.error('Erro na inicializa√ß√£o:', error);
            }
        });

        // Inicializar gr√°ficos
        function initializeCharts() {
            try {
                // Gr√°fico de Status
                const statusCtx = document.getElementById('statusChart');
                if (!statusCtx) {
                    console.error('Canvas statusChart n√£o encontrado');
                    return;
                }
                const statusContext = statusCtx.getContext('2d');
                window.statusChart = new Chart(statusContext, {
                type: 'doughnut',
                data: {
                    labels: ['Aberto', 'Em Atendimento', 'Resolvido', 'Fechado'],
                    datasets: [{
                        data: [3, 2, 5, 1],
                        backgroundColor: ['#fbbf24', '#3b82f6', '#10b981', '#6b7280']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#d1d5db'
                            }
                        }
                    }
                }
            });

            // Gr√°fico de Respons√°vel
            const responsavelCtx = document.getElementById('responsavelChart');
            if (!responsavelCtx) {
                console.error('Canvas responsavelChart n√£o encontrado');
                return;
            }
            const responsavelContext = responsavelCtx.getContext('2d');
            window.responsavelChart = new Chart(responsavelContext, {
                type: 'bar',
                data: {
                    labels: ['Jo√£o Silva', 'Maria Santos', 'Pedro Costa'],
                    datasets: [{
                        label: 'Tickets',
                        data: [4, 3, 2],
                        backgroundColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#d1d5db'
                            },
                            grid: {
                                color: '#374151'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#d1d5db'
                            },
                            grid: {
                                color: '#374151'
                            }
                        }
                    }
                }
            });

            // Gr√°fico de Tempo
            const tempoCtx = document.getElementById('tempoChart');
            if (!tempoCtx) {
                console.error('Canvas tempoChart n√£o encontrado');
                return;
            }
            const tempoContext = tempoCtx.getContext('2d');
            window.tempoChart = new Chart(tempoContext, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai'],
                    datasets: [{
                        label: 'Tempo M√©dio (horas)',
                        data: [24, 18, 22, 15, 20],
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#d1d5db'
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                color: '#d1d5db'
                            },
                            grid: {
                                color: '#374151'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#d1d5db'
                            },
                            grid: {
                                color: '#374151'
                            }
                        }
                    }
                }
            });

            // Gr√°fico de Classifica√ß√£o
            const classificacaoCtx = document.getElementById('classificacaoChart');
            if (!classificacaoCtx) {
                console.error('Canvas classificacaoChart n√£o encontrado');
                return;
            }
            const classificacaoContext = classificacaoCtx.getContext('2d');
            window.classificacaoChart = new Chart(classificacaoContext, {
                type: 'pie',
                data: {
                    labels: ['Cr√≠tico', 'Alto', 'M√©dio', 'Baixo'],
                    datasets: [{
                        data: [2, 3, 4, 1],
                        backgroundColor: ['#ef4444', '#f97316', '#eab308', '#22c55e']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#d1d5db'
                            }
                        }
                    }
                }
            });

            // Gr√°fico de Radar
            const radarCtx = document.getElementById('radarChart');
            if (!radarCtx) {
                console.error('Canvas radarChart n√£o encontrado');
                return;
            }
            const radarContext = radarCtx.getContext('2d');
            window.radarChart = new Chart(radarContext, {
                type: 'radar',
                data: {
                    labels: ['Tempo de Resolu√ß√£o', 'Satisfa√ß√£o', 'Prioridade', 'Complexidade', 'Urg√™ncia'],
                    datasets: [{
                        label: 'M√©tricas de Performance',
                        data: [65, 75, 80, 60, 70],
                        backgroundColor: 'rgba(147, 51, 234, 0.2)',
                        borderColor: '#9333ea',
                        borderWidth: 2,
                        pointBackgroundColor: '#9333ea',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#d1d5db'
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#d1d5db',
                                stepSize: 20
                            },
                            grid: {
                                color: '#374151'
                            },
                            pointLabels: {
                                color: '#d1d5db'
                            }
                        }
                    }
                }
            });

            // Gr√°fico de Scatter
            const scatterCtx = document.getElementById('scatterChart');
            if (!scatterCtx) {
                console.error('Canvas scatterChart n√£o encontrado');
                return;
            }
            const scatterContext = scatterCtx.getContext('2d');
            window.scatterChart = new Chart(scatterContext, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Tickets por Tempo e Prioridade',
                        data: [
                            { x: 2, y: 8 },
                            { x: 4, y: 6 },
                            { x: 6, y: 9 },
                            { x: 8, y: 4 },
                            { x: 10, y: 7 },
                            { x: 12, y: 5 },
                            { x: 14, y: 10 },
                            { x: 16, y: 3 }
                        ],
                        backgroundColor: '#3b82f6',
                        borderColor: '#1d4ed8',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#d1d5db'
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Tempo de Resolu√ß√£o (horas)',
                                color: '#d1d5db'
                            },
                            ticks: {
                                color: '#d1d5db'
                            },
                            grid: {
                                color: '#374151'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Prioridade (1-10)',
                                color: '#d1d5db'
                            },
                            ticks: {
                                color: '#d1d5db',
                                stepSize: 1
                            },
                            grid: {
                                color: '#374151'
                            }
                        }
                    }
                }
            });
            } catch (error) {
                console.error('Erro ao inicializar gr√°ficos:', error);
            }
        }

        // Inicializar Sortable
        function initializeSortable() {
            const grid = document.querySelector('.grid');
            new Sortable(grid, {
                animation: 150,
                ghostClass: 'bg-gray-700'
            });
        }

        // Carregar dados iniciais
        async function loadInitialData() {
            await updateDashboardStats();
            await updateChartsWithNewData();
        }

        // Atualizar estat√≠sticas do dashboard
        async function updateDashboardStats() {
            try {
                const response = await fetch('http://localhost:3000/api/dashboard/stats');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();

                if (result.success) {
                    const data = result.data;
                    const totalTicketsElement = document.getElementById('totalTickets');
                    const ticketsAbertosElement = document.getElementById('ticketsAbertos');
                    const ticketsResolvidosElement = document.getElementById('ticketsResolvidos');
                    const ticketsEmAtendimentoElement = document.getElementById('ticketsEmAtendimento');
                    const tempoMedioElement = document.getElementById('tempoMedio');
                    
                    // Cards principais
                    const totalTicketsCard = document.getElementById('totalTicketsCard');
                    const ticketsAbertosCard = document.getElementById('ticketsAbertosCard');
                    const ticketsResolvidosCard = document.getElementById('ticketsResolvidosCard');
                    const dataSourcesCard = document.getElementById('dataSourcesCard');
                    
                    if (totalTicketsElement) totalTicketsElement.textContent = data.totalTickets || '0';
                    if (ticketsAbertosElement) ticketsAbertosElement.textContent = data.ticketsAbertos || '0';
                    if (ticketsResolvidosElement) ticketsResolvidosElement.textContent = data.ticketsResolvidos || '0';
                    if (ticketsEmAtendimentoElement) ticketsEmAtendimentoElement.textContent = data.ticketsEmAtendimento || '0';
                    if (tempoMedioElement) tempoMedioElement.textContent = (data.avgResolutionTime || 0).toFixed(1) + 'h';
                    
                    // Estat√≠sticas detalhadas
                    const avgResolutionTimeElement = document.getElementById('avgResolutionTime');
                    const criticalTicketsElement = document.getElementById('criticalTickets');
                    const highPriorityTicketsElement = document.getElementById('highPriorityTickets');
                    const activeResponsiblesElement = document.getElementById('activeResponsibles');
                    
                    if (avgResolutionTimeElement) avgResolutionTimeElement.textContent = (data.avgResolutionTime || 0).toFixed(1) + 'h';
                    if (criticalTicketsElement) criticalTicketsElement.textContent = data.criticalTickets || '0';
                    if (highPriorityTicketsElement) highPriorityTicketsElement.textContent = data.highPriorityTickets || '0';
                    if (activeResponsiblesElement) activeResponsiblesElement.textContent = data.activeResponsibles || '0';
                    
                    // Cards de resumo
                    if (totalTicketsCard) totalTicketsCard.textContent = data.totalTickets || '0';
                    if (ticketsAbertosCard) ticketsAbertosCard.textContent = data.ticketsAbertos || '0';
                    if (ticketsResolvidosCard) ticketsResolvidosCard.textContent = data.ticketsResolvidos || '0';
                    if (dataSourcesCard) dataSourcesCard.textContent = dataSources.length;
                }
            } catch (error) {
                console.error('Erro ao atualizar estat√≠sticas:', error);
                // Usar valores padr√£o em caso de erro
                const totalTicketsElement = document.getElementById('totalTickets');
                const ticketsAbertosElement = document.getElementById('ticketsAbertos');
                const ticketsResolvidosElement = document.getElementById('ticketsResolvidos');
                const ticketsEmAtendimentoElement = document.getElementById('ticketsEmAtendimento');
                const tempoMedioElement = document.getElementById('tempoMedio');
                const totalTicketsCard = document.getElementById('totalTicketsCard');
                const ticketsAbertosCard = document.getElementById('ticketsAbertosCard');
                const ticketsResolvidosCard = document.getElementById('ticketsResolvidosCard');
                const dataSourcesCard = document.getElementById('dataSourcesCard');
                
                if (totalTicketsElement) totalTicketsElement.textContent = '0';
                if (ticketsAbertosElement) ticketsAbertosElement.textContent = '0';
                if (ticketsResolvidosElement) ticketsResolvidosElement.textContent = '0';
                if (ticketsEmAtendimentoElement) ticketsEmAtendimentoElement.textContent = '0';
                if (tempoMedioElement) tempoMedioElement.textContent = '0h';
                
                // Estat√≠sticas detalhadas
                const avgResolutionTimeElement = document.getElementById('avgResolutionTime');
                const criticalTicketsElement = document.getElementById('criticalTickets');
                const highPriorityTicketsElement = document.getElementById('highPriorityTickets');
                const activeResponsiblesElement = document.getElementById('activeResponsibles');
                
                if (avgResolutionTimeElement) avgResolutionTimeElement.textContent = '0h';
                if (criticalTicketsElement) criticalTicketsElement.textContent = '0';
                if (highPriorityTicketsElement) highPriorityTicketsElement.textContent = '0';
                if (activeResponsiblesElement) activeResponsiblesElement.textContent = '0';
                
                if (totalTicketsCard) totalTicketsCard.textContent = '0';
                if (ticketsAbertosCard) ticketsAbertosCard.textContent = '0';
                if (ticketsResolvidosCard) ticketsResolvidosCard.textContent = '0';
                if (dataSourcesCard) dataSourcesCard.textContent = '0';
            }
        }

        // Event listeners
        const importExcelBtn = document.getElementById('importExcelBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const editProfileBtn = document.getElementById('editProfileBtn');
        
        if (importExcelBtn) {
            importExcelBtn.addEventListener('click', () => {
                const excelModal = document.getElementById('excelModal');
                if (excelModal) {
                    excelModal.classList.remove('hidden');
                    excelModal.classList.add('flex');
                }
            });
        }

        if (settingsBtn) {
            settingsBtn.addEventListener('click', () => {
                const settingsModal = document.getElementById('settingsModal');
                if (settingsModal) {
                    settingsModal.classList.remove('hidden');
                    settingsModal.classList.add('flex');
                }
            });
        }

        if (editProfileBtn) {
            editProfileBtn.addEventListener('click', () => {
                const settingsModal = document.getElementById('settingsModal');
                if (settingsModal) {
                    settingsModal.classList.remove('hidden');
                    settingsModal.classList.add('flex');
                }
            });
        }

        // Fechar modais
        function closeExcelModal() {
            const excelModal = document.getElementById('excelModal');
            if (excelModal) {
                excelModal.classList.add('hidden');
                excelModal.classList.remove('flex');
            }
        }

        function closeSettingsModal() {
            const settingsModal = document.getElementById('settingsModal');
            if (settingsModal) {
                settingsModal.classList.add('hidden');
                settingsModal.classList.remove('flex');
            }
        }

        // Upload de arquivo
        document.getElementById('excelFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const fileNameElement = document.getElementById('fileName');
                const fileSizeElement = document.getElementById('fileSize');
                const fileInfoElement = document.getElementById('fileInfo');
                const importBtnElement = document.getElementById('importBtn');
                const dataSourceNameElement = document.getElementById('dataSourceName');
                
                if (fileNameElement) fileNameElement.textContent = file.name;
                if (fileSizeElement) fileSizeElement.textContent = (file.size / 1024).toFixed(2) + ' KB';
                if (fileInfoElement) fileInfoElement.classList.remove('hidden');
                if (importBtnElement) importBtnElement.disabled = false;
                
                // Sugerir nome do Data Source baseado no nome do arquivo
                if (dataSourceNameElement) {
                    const fileName = file.name.replace(/\.[^/.]+$/, ""); // Remove extens√£o
                    dataSourceNameElement.value = fileName;
                }
            }
        });

        // Remover arquivo
        function removeFile() {
            const excelFileElement = document.getElementById('excelFile');
            const fileInfoElement = document.getElementById('fileInfo');
            const importBtnElement = document.getElementById('importBtn');
            const dataSourceNameElement = document.getElementById('dataSourceName');
            
            if (excelFileElement) excelFileElement.value = '';
            if (fileInfoElement) fileInfoElement.classList.add('hidden');
            if (importBtnElement) importBtnElement.disabled = true;
            if (dataSourceNameElement) dataSourceNameElement.value = '';
        }

        // Importar Excel
        async function importExcel() {
            const fileInput = document.getElementById('excelFile');
            const dataSourceNameInput = document.getElementById('dataSourceName');
            
            if (!fileInput || !dataSourceNameInput) {
                alert('Erro: Elementos do formul√°rio n√£o encontrados');
                return;
            }
            
            const file = fileInput.files[0];
            const dataSourceName = dataSourceNameInput.value.trim();
            
            if (!file) {
                alert('Por favor, selecione um arquivo Excel.');
                return;
            }
            
            if (!dataSourceName) {
                alert('Por favor, insira um nome para o Data Source.');
                return;
            }

            // Mostrar loading
            const importBtn = document.getElementById('importBtn');
            if (!importBtn) {
                alert('Erro: Bot√£o de importa√ß√£o n√£o encontrado');
                return;
            }
            
            const originalText = importBtn.innerHTML;
            importBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Importando...';
            importBtn.disabled = true;

            const formData = new FormData();
            formData.append('excel', file);
            formData.append('dataSourceName', dataSourceName);

            try {
                const response = await fetch('http://localhost:3000/api/upload-excel', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    // Adicionar novo Data Source
                    const newDataSource = {
                        id: Date.now(),
                        name: dataSourceName,
                        fileName: file.name,
                        importDate: new Date().toISOString(),
                        ticketCount: result.imported || 0
                    };
                    
                    dataSources.push(newDataSource);
                    updateDataSourceSelector();
                    updateDataSourceCount();
                    
                    showSuccessMessage(`Dados importados com sucesso! ${result.imported} tickets processados.`);
                    closeExcelModal();
                    
                    // Atualizar dados ap√≥s importa√ß√£o
                    await updateDashboardStats();
                    await updateChartsWithNewData();
                } else {
                    alert('Erro ao importar: ' + (result.error || 'Erro desconhecido'));
                }
            } catch (error) {
                console.error('Erro na importa√ß√£o:', error);
                alert('Erro ao conectar com o servidor: ' + error.message);
            } finally {
                // Restaurar bot√£o
                if (importBtn) {
                    importBtn.innerHTML = originalText;
                    importBtn.disabled = false;
                }
            }
        }

        // Atualizar gr√°ficos com novos dados
        async function updateChartsWithNewData() {
            try {
                const response = await fetch('http://localhost:3000/api/dashboard/stats');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();

                if (result.success) {
                    updateCharts(result.data);
                    await updateDashboardStats();
                }
            } catch (error) {
                console.error('Erro ao atualizar dados:', error);
            }
        }

        // Atualizar gr√°ficos
        function updateCharts(data) {
            try {
                // Atualizar gr√°fico de status
                if (window.statusChart && data.statusStats && Array.isArray(data.statusStats)) {
                    window.statusChart.data.labels = data.statusStats.map(item => item.status);
                    window.statusChart.data.datasets[0].data = data.statusStats.map(item => item.count);
                    window.statusChart.update();
                }

                // Atualizar gr√°fico de respons√°vel
                if (window.responsavelChart && data.responsavelStats && Array.isArray(data.responsavelStats)) {
                    window.responsavelChart.data.labels = data.responsavelStats.map(item => item.responsavel);
                    window.responsavelChart.data.datasets[0].data = data.responsavelStats.map(item => item.count);
                    window.responsavelChart.update();
                }

                // Atualizar gr√°fico de tempo
                if (window.tempoChart && data.tempoStats && Array.isArray(data.tempoStats)) {
                    window.tempoChart.data.labels = data.tempoStats.map(item => item.mes);
                    window.tempoChart.data.datasets[0].data = data.tempoStats.map(item => item.tempo_medio);
                    window.tempoChart.update();
                }

                // Atualizar gr√°fico de classifica√ß√£o
                if (window.classificacaoChart && data.classificacaoStats && Array.isArray(data.classificacaoStats)) {
                    window.classificacaoChart.data.labels = data.classificacaoStats.map(item => item.classificacao);
                    window.classificacaoChart.data.datasets[0].data = data.classificacaoStats.map(item => item.count);
                    window.classificacaoChart.update();
                }

                // Atualizar gr√°fico de radar com m√©tricas calculadas
                if (window.radarChart && data.radarStats) {
                    window.radarChart.data.datasets[0].data = [
                        data.radarStats.tempo_medio || 65,
                        data.radarStats.satisfacao || 75,
                        data.radarStats.prioridade_media || 80,
                        data.radarStats.complexidade_media || 60,
                        data.radarStats.urgencia_media || 70
                    ];
                    window.radarChart.update();
                }

                // Atualizar gr√°fico de scatter com dados de tempo vs prioridade
                if (window.scatterChart && data.scatterStats && Array.isArray(data.scatterStats)) {
                    window.scatterChart.data.datasets[0].data = data.scatterStats.map(item => ({
                        x: item.tempo_vida_horas || 0,
                        y: item.prioridade || 1
                    }));
                    window.scatterChart.update();
                }
            } catch (error) {
                console.error('Erro ao atualizar gr√°ficos:', error);
            }
        }

        // Salvar perfil
        async function saveProfile() {
            const nameElement = document.getElementById('profileName');
            const roleElement = document.getElementById('profileRole');
            const pictureElement = document.getElementById('profilePicture');
            
            if (!nameElement || !roleElement) {
                alert('Erro: Elementos do formul√°rio n√£o encontrados');
                return;
            }
            
            const name = nameElement.value.trim();
            const role = roleElement.value.trim();
            
            if (!name) {
                alert('Por favor, preencha o nome.');
                return;
            }
            
            if (!role) {
                alert('Por favor, preencha o cargo.');
                return;
            }

            // Mostrar loading
            const saveBtn = document.querySelector('#settingsModal button[onclick="saveProfile()"]');
            if (saveBtn) {
                const originalText = saveBtn.innerHTML;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Salvando...';
                saveBtn.disabled = true;

                try {
                    // Processar imagem se selecionada
                    let profilePicture = null;
                    if (pictureElement && pictureElement.files[0]) {
                        const file = pictureElement.files[0];
                        profilePicture = await convertImageToBase64(file);
                    }

                    const profileData = {
                        name: name,
                        role: role,
                        profile_picture: profilePicture
                    };

                    const response = await fetch('http://localhost:3000/api/profile', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(profileData)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();

                    if (result.success) {
                        showSuccessMessage('Perfil atualizado com sucesso!');
                        
                        // Atualizar interface imediatamente
                        const userNameElement = document.getElementById('userName');
                        const userRoleElement = document.getElementById('userRole');
                        const userAvatarElement = document.getElementById('userAvatar');
                        
                        if (userNameElement) userNameElement.textContent = name;
                        if (userRoleElement) userRoleElement.textContent = role;
                        if (userAvatarElement && profilePicture) {
                            userAvatarElement.src = profilePicture;
                        }
                        
                        closeSettingsModal();
                    } else {
                        alert('Erro ao atualizar perfil: ' + (result.error || 'Erro desconhecido'));
                    }
                } catch (error) {
                    console.error('Erro ao salvar perfil:', error);
                    alert('Erro ao conectar com o servidor: ' + error.message);
                } finally {
                    // Restaurar bot√£o
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                }
            }
        }

        // Converter imagem para Base64
        function convertImageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Carregar perfil
        async function loadProfile() {
            try {
                const response = await fetch('http://localhost:3000/api/profile');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();

                if (result.success) {
                    const profile = result.data;
                    const userNameElement = document.getElementById('userName');
                    const userRoleElement = document.getElementById('userRole');
                    const userAvatarElement = document.getElementById('userAvatar');
                    const profileNameElement = document.getElementById('profileName');
                    const profileRoleElement = document.getElementById('profileRole');
                    
                    if (userNameElement) userNameElement.textContent = profile.name || 'Jo√£o Silva';
                    if (userRoleElement) userRoleElement.textContent = profile.role || 'Analista de Suporte';
                    if (userAvatarElement && profile.profile_picture) {
                        userAvatarElement.src = profile.profile_picture;
                    }
                    
                    // Preencher campos do modal de edi√ß√£o
                    if (profileNameElement) profileNameElement.value = profile.name || '';
                    if (profileRoleElement) profileRoleElement.value = profile.role || '';
                }
            } catch (error) {
                console.error('Erro ao carregar perfil:', error);
                // Usar valores padr√£o em caso de erro
                const userNameElement = document.getElementById('userName');
                const userRoleElement = document.getElementById('userRole');
                
                if (userNameElement) userNameElement.textContent = 'Jo√£o Silva';
                if (userRoleElement) userRoleElement.textContent = 'Analista de Suporte';
            }
        }

        // Carregar perfil na inicializa√ß√£o
        loadProfile();
        
        // Sistema de M√∫ltiplos Dashboards
        let dashboards = {
            main: {
                id: 'main',
                name: 'Dashboard Principal',
                charts: ['statusChart', 'responsavelChart', 'tempoChart', 'classificacaoChart', 'radarChart', 'scatterChart'],
                layout: 'default'
            }
        };
        
        let currentDashboard = 'main';
        
        // Criar novo dashboard
        function createNewDashboard() {
            const dashboardName = prompt('Digite o nome do novo dashboard:');
            if (!dashboardName || dashboardName.trim() === '') return;
            
            const dashboardId = 'dashboard_' + Date.now();
            const newDashboard = {
                id: dashboardId,
                name: dashboardName.trim(),
                charts: [],
                layout: 'custom'
            };
            
            dashboards[dashboardId] = newDashboard;
            updateDashboardSelector();
            
            // Selecionar o novo dashboard
            document.getElementById('dashboardSelector').value = dashboardId;
            switchDashboard(dashboardId);
            
            showSuccessMessage(`Dashboard "${dashboardName}" criado com sucesso!`);
        }
        
        // Excluir dashboard atual
        function deleteCurrentDashboard() {
            if (currentDashboard === 'main') {
                alert('N√£o √© poss√≠vel excluir o Dashboard Principal.');
                return;
            }
            
            if (confirm(`Tem certeza que deseja excluir o dashboard "${dashboards[currentDashboard].name}"?`)) {
                delete dashboards[currentDashboard];
                updateDashboardSelector();
                
                // Voltar para o dashboard principal
                document.getElementById('dashboardSelector').value = 'main';
                switchDashboard('main');
                
                showSuccessMessage('Dashboard exclu√≠do com sucesso!');
            }
        }
        
        // Trocar de dashboard
        function switchDashboard(dashboardId) {
            currentDashboard = dashboardId;
            const dashboard = dashboards[dashboardId];
            
            if (!dashboard) return;
            
            // Atualizar interface
            updateDashboardGrid(dashboard);
            
            // Salvar prefer√™ncia
            localStorage.setItem('currentDashboard', dashboardId);
        }
        
        // Atualizar grid do dashboard
        function updateDashboardGrid(dashboard) {
            const grid = document.getElementById('dashboardGrid');
            if (!grid) return;
            
            // Limpar grid atual
            grid.innerHTML = '';
            
            if (dashboard.charts.length === 0) {
                // Dashboard vazio - mostrar mensagem
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-gray-400 text-lg mb-4">
                            <i class="fas fa-chart-bar text-4xl mb-4"></i>
                            <p>Este dashboard est√° vazio</p>
                        </div>
                        <button onclick="addChartToDashboard()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg">
                            <i class="fas fa-plus mr-2"></i>
                            Adicionar Gr√°fico
                        </button>
                    </div>
                `;
            } else {
                // Renderizar gr√°ficos do dashboard
                dashboard.charts.forEach((chartId, index) => {
                    const chartContainer = createChartContainer(chartId, index + 1);
                    grid.appendChild(chartContainer);
                });
            }
        }
        
        // Criar container de gr√°fico
        function createChartContainer(chartId, chartNumber) {
            const container = document.createElement('div');
            container.id = `chart${chartNumber}`;
            container.className = 'bg-gray-800 rounded-lg p-6 shadow-lg cursor-move';
            
            const chartConfig = getChartConfig(chartId);
            
            container.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-${chartConfig.color}-400">
                        <i class="${chartConfig.icon} mr-2"></i>
                        ${chartConfig.title}
                    </h3>
                    <div class="flex space-x-2">
                        <button class="text-gray-400 hover:text-white transition-colors" onclick="openChartSettings('${chartId}', '${chartConfig.title}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-gray-400 hover:text-white transition-colors" onclick="expandChart('${chartId}')">
                            <i class="fas fa-expand"></i>
                        </button>
                        <button class="text-gray-400 hover:text-white transition-colors" onclick="removeChartFromDashboard('${chartId}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <canvas id="${chartId}" height="200"></canvas>
            `;
            
            return container;
        }
        
        // Configura√ß√£o dos gr√°ficos
        function getChartConfig(chartId) {
            const configs = {
                statusChart: { title: 'Tickets por Status', color: 'blue', icon: 'fas fa-chart-pie' },
                responsavelChart: { title: 'Tickets por Respons√°vel', color: 'green', icon: 'fas fa-users' },
                tempoChart: { title: 'Tempo de Resolu√ß√£o', color: 'yellow', icon: 'fas fa-clock' },
                classificacaoChart: { title: 'Tickets por Classifica√ß√£o', color: 'red', icon: 'fas fa-exclamation-triangle' },
                radarChart: { title: 'Radar Chart', color: 'purple', icon: 'fas fa-chart-radar' },
                scatterChart: { title: 'Scatter Chart', color: 'indigo', icon: 'fas fa-chart-scatter' }
            };
            
            return configs[chartId] || { title: 'Gr√°fico', color: 'gray', icon: 'fas fa-chart-bar' };
        }
        
        // Adicionar gr√°fico ao dashboard
        function addChartToDashboard() {
            const availableCharts = ['statusChart', 'responsavelChart', 'tempoChart', 'classificacaoChart', 'radarChart', 'scatterChart'];
            const currentCharts = dashboards[currentDashboard].charts;
            const unusedCharts = availableCharts.filter(chart => !currentCharts.includes(chart));
            
            if (unusedCharts.length === 0) {
                alert('Todos os gr√°ficos j√° est√£o no dashboard atual.');
                return;
            }
            
            const chartOptions = unusedCharts.map(chart => {
                const config = getChartConfig(chart);
                return `${chart}:${config.title}`;
            }).join('\n');
            
            const selectedChart = prompt(`Selecione um gr√°fico para adicionar:\n\n${chartOptions}`);
            if (!selectedChart) return;
            
            const chartId = selectedChart.split(':')[0];
            if (unusedCharts.includes(chartId)) {
                dashboards[currentDashboard].charts.push(chartId);
                updateDashboardGrid(dashboards[currentDashboard]);
                showSuccessMessage(`Gr√°fico "${getChartConfig(chartId).title}" adicionado ao dashboard!`);
            }
        }
        
        // Remover gr√°fico do dashboard
        function removeChartFromDashboard(chartId) {
            const dashboard = dashboards[currentDashboard];
            const index = dashboard.charts.indexOf(chartId);
            
            if (index > -1) {
                dashboard.charts.splice(index, 1);
                updateDashboardGrid(dashboard);
                showSuccessMessage(`Gr√°fico removido do dashboard!`);
            }
        }
        
        // Atualizar seletor de dashboards
        function updateDashboardSelector() {
            const selector = document.getElementById('dashboardSelector');
            if (!selector) return;
            
            selector.innerHTML = '';
            
            Object.values(dashboards).forEach(dashboard => {
                const option = document.createElement('option');
                option.value = dashboard.id;
                option.textContent = dashboard.name;
                selector.appendChild(option);
            });
        }
        
        // Event listener para troca de dashboard
        document.addEventListener('DOMContentLoaded', () => {
            const selector = document.getElementById('dashboardSelector');
            if (selector) {
                selector.addEventListener('change', (e) => {
                    switchDashboard(e.target.value);
                });
            }
            
            // Carregar dashboard salvo
            const savedDashboard = localStorage.getItem('currentDashboard');
            if (savedDashboard && dashboards[savedDashboard]) {
                currentDashboard = savedDashboard;
                selector.value = savedDashboard;
            }
        });
        
        // Fun√ß√µes para gerenciar Data Sources
        function updateDataSourceSelector() {
            const selector = document.getElementById('dataSourceSelector');
            if (!selector) return;
            
            // Limpar op√ß√µes existentes
            selector.innerHTML = '<option value="">Selecione um Data Source</option>';
            
            // Adicionar op√ß√µes para cada Data Source
            dataSources.forEach(source => {
                const option = document.createElement('option');
                option.value = source.id;
                option.textContent = `${source.name} (${source.ticketCount} tickets)`;
                selector.appendChild(option);
            });
        }
        
        function updateDataSourceCount() {
            const countElement = document.getElementById('dataSourcesCount');
            if (countElement) {
                countElement.textContent = dataSources.length;
            }
        }
        
        // Event listener para mudan√ßa de Data Source
        const dataSourceSelector = document.getElementById('dataSourceSelector');
        if (dataSourceSelector) {
            dataSourceSelector.addEventListener('change', (e) => {
                const selectedId = e.target.value;
                if (selectedId) {
                    currentDataSource = dataSources.find(source => source.id == selectedId);
                    if (currentDataSource) {
                        console.log('Data Source selecionado:', currentDataSource.name);
                        // Aqui voc√™ pode implementar a l√≥gica para carregar dados espec√≠ficos
                        updateChartsWithDataSource(currentDataSource);
                    }
                } else {
                    currentDataSource = null;
                }
            });
        }
        
        function updateChartsWithDataSource(dataSource) {
            // Implementar l√≥gica para atualizar gr√°ficos com dados espec√≠ficos do Data Source
            console.log('Atualizando gr√°ficos com dados de:', dataSource.name);
            // Esta fun√ß√£o ser√° expandida para carregar dados espec√≠ficos do Data Source selecionado
        }
        
        // Vari√°veis para configura√ß√µes de gr√°ficos
        let currentChartId = null;
        let chartSettings = {};
        
        // Abrir modal de configura√ß√µes de gr√°ficos
        function openChartSettings(chartId, chartTitle) {
            currentChartId = chartId;
            
            const titleElement = document.getElementById('chartSettingsTitle');
            if (titleElement) {
                titleElement.textContent = `Configura√ß√µes: ${chartTitle}`;
            }
            
            // Carregar configura√ß√µes atuais do gr√°fico
            loadChartSettings(chartId);
            
            // Mostrar modal
            const modal = document.getElementById('chartSettingsModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
        }
        
        // Fechar modal de configura√ß√µes de gr√°ficos
        function closeChartSettingsModal() {
            const modal = document.getElementById('chartSettingsModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
            currentChartId = null;
        }
        
        // Carregar configura√ß√µes atuais do gr√°fico
        function loadChartSettings(chartId) {
            const chart = window[chartId];
            if (!chart) return;
            
            // Carregar configura√ß√µes padr√£o se n√£o existirem
            if (!chartSettings[chartId]) {
                chartSettings[chartId] = {
                    backgroundColor: '#1f2937',
                    borderColor: '#3b82f6',
                    borderWidth: 2,
                    opacity: 80,
                    showValues: true,
                    valueFormat: 'number',
                    decimals: 2,
                    groupData: 'none',
                    legendPosition: 'bottom',
                    showGrid: true,
                    height: 200,
                    animation: true,
                    itemLimit: 10,
                    statusFilter: 'all',
                    priorityFilter: 'all',
                    timeFilter: 'all'
                };
            }
            
            const settings = chartSettings[chartId];
            
            // Aplicar valores aos campos com verifica√ß√£o de exist√™ncia
            const fields = {
                'chartBgColor': settings.backgroundColor,
                'chartBorderColor': settings.borderColor,
                'chartBorderWidth': settings.borderWidth,
                'chartOpacity': settings.opacity,
                'chartShowValues': settings.showValues.toString(),
                'chartValueFormat': settings.valueFormat,
                'chartDecimals': settings.decimals,
                'chartGroupData': settings.groupData,
                'chartLegendPosition': settings.legendPosition,
                'chartShowGrid': settings.showGrid.toString(),
                'chartHeight': settings.height,
                'chartAnimation': settings.animation.toString(),
                'chartItemLimit': settings.itemLimit,
                'chartStatusFilter': settings.statusFilter,
                'chartPriorityFilter': settings.priorityFilter,
                'chartTimeFilter': settings.timeFilter
            };
            
            Object.entries(fields).forEach(([fieldId, value]) => {
                const element = document.getElementById(fieldId);
                if (element) {
                    element.value = value;
                }
            });
            
            // Atualizar valores dos sliders
            updateSliderValues();
        }
        
        // Atualizar valores dos sliders
        function updateSliderValues() {
            const borderWidthSlider = document.getElementById('chartBorderWidth');
            const opacitySlider = document.getElementById('chartOpacity');
            const heightSlider = document.getElementById('chartHeight');
            
            const borderWidthValue = document.getElementById('borderWidthValue');
            const opacityValue = document.getElementById('opacityValue');
            const heightValue = document.getElementById('heightValue');
            
            if (borderWidthSlider && borderWidthValue) {
                borderWidthValue.textContent = borderWidthSlider.value + 'px';
            }
            
            if (opacitySlider && opacityValue) {
                opacityValue.textContent = opacitySlider.value + '%';
            }
            
            if (heightSlider && heightValue) {
                heightValue.textContent = heightSlider.value + 'px';
            }
        }
        
        // Aplicar configura√ß√µes do gr√°fico
        function applyChartSettings() {
            if (!currentChartId) return;
            
            const chart = window[currentChartId];
            if (!chart) return;
            
            // Coletar valores dos campos com verifica√ß√£o
            const fields = {
                'chartBgColor': 'backgroundColor',
                'chartBorderColor': 'borderColor',
                'chartBorderWidth': 'borderWidth',
                'chartOpacity': 'opacity',
                'chartShowValues': 'showValues',
                'chartValueFormat': 'valueFormat',
                'chartDecimals': 'decimals',
                'chartGroupData': 'groupData',
                'chartLegendPosition': 'legendPosition',
                'chartShowGrid': 'showGrid',
                'chartHeight': 'height',
                'chartAnimation': 'animation',
                'chartItemLimit': 'itemLimit',
                'chartStatusFilter': 'statusFilter',
                'chartPriorityFilter': 'priorityFilter',
                'chartTimeFilter': 'timeFilter'
            };
            
            const settings = {};
            
            Object.entries(fields).forEach(([fieldId, settingKey]) => {
                const element = document.getElementById(fieldId);
                if (element) {
                    let value = element.value;
                    
                    // Converter tipos espec√≠ficos
                    if (settingKey === 'borderWidth' || settingKey === 'opacity' || settingKey === 'decimals' || settingKey === 'height' || settingKey === 'itemLimit') {
                        value = parseInt(value) || 0;
                    } else if (settingKey === 'showValues' || settingKey === 'showGrid' || settingKey === 'animation') {
                        value = value === 'true';
                    }
                    
                    settings[settingKey] = value;
                }
            });
            
            // Salvar configura√ß√µes
            chartSettings[currentChartId] = settings;
            
            // Aplicar configura√ß√µes ao gr√°fico
            applySettingsToChart(currentChartId, settings);
            
            // Fechar modal
            closeChartSettingsModal();
            
            // Mostrar mensagem de sucesso
            showSuccessMessage('Configura√ß√µes aplicadas com sucesso!');
        }
        
        // Aplicar configura√ß√µes ao gr√°fico
        function applySettingsToChart(chartId, settings) {
            const chart = window[chartId];
            if (!chart) return;
            
            // Aplicar configura√ß√µes de cores
            if (chart.data && chart.data.datasets && chart.data.datasets[0]) {
                const dataset = chart.data.datasets[0];
                dataset.backgroundColor = settings.backgroundColor;
                                 dataset.borderColor = settings.borderColor;
                dataset.borderWidth = settings.borderWidth;
                
                // Aplicar transpar√™ncia
                if (dataset.backgroundColor) {
                    const hex = settings.backgroundColor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);
                    dataset.backgroundColor = `rgba(${r}, ${g}, ${b}, ${settings.opacity / 100})`;
                }
            }
            
            // Aplicar configura√ß√µes de layout
            if (chart.options) {
                chart.options.responsive = true;
                chart.options.maintainAspectRatio = false;
                
                // Configurar legenda
                if (chart.options.plugins && chart.options.plugins.legend) {
                    chart.options.plugins.legend.position = settings.legendPosition;
                }
                
                // Configurar anima√ß√£o
                chart.options.animation = settings.animation;
                
                // Configurar grade
                if (chart.options.scales) {
                    Object.keys(chart.options.scales).forEach(axis => {
                        if (chart.options.scales[axis] && chart.options.scales[axis].grid) {
                            chart.options.scales[axis].grid.display = settings.showGrid;
                        }
                    });
                }
            }
            
            // Aplicar altura
            const canvas = document.getElementById(chartId);
            if (canvas) {
                canvas.style.height = settings.height + 'px';
            }
            
            // Atualizar gr√°fico
            chart.update();
        }
        
        // Restaurar configura√ß√µes padr√£o
        function resetChartSettings() {
            if (!currentChartId) return;
            
            // Remover configura√ß√µes personalizadas
            delete chartSettings[currentChartId];
            
            // Recarregar configura√ß√µes padr√£o
            loadChartSettings(currentChartId);
            
            // Mostrar mensagem
            showSuccessMessage('Configura√ß√µes restauradas para o padr√£o!');
        }
        
        // Expandir gr√°fico
        function expandChart(chartId) {
            const chart = window[chartId];
            if (!chart) return;
            
            // Criar modal de gr√°fico expandido
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-white">Gr√°fico Expandido</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="bg-white rounded p-4">
                        <canvas id="expanded_${chartId}" width="800" height="400"></canvas>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Criar gr√°fico expandido
            setTimeout(() => {
                const expandedCanvas = document.getElementById(`expanded_${chartId}`);
                if (expandedCanvas) {
                    try {
                        const expandedChart = new Chart(expandedCanvas.getContext('2d'), {
                            type: chart.config.type,
                            data: chart.data,
                            options: {
                                ...chart.options,
                                responsive: true,
                                maintainAspectRatio: false
                            }
                        });
                    } catch (error) {
                        console.error('Erro ao criar gr√°fico expandido:', error);
                    }
                }
            }, 100);
        }
        
        // Mostrar mensagem de sucesso
        function showSuccessMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-4 rounded-lg shadow-lg z-50 animate-slide-in';
            messageDiv.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-check-circle mr-3 text-xl"></i>
                    <div class="font-semibold">${message}</div>
                </div>
            `;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
        
        // Event listeners para sliders
        document.addEventListener('DOMContentLoaded', () => {
            try {
                // Adicionar event listeners para sliders
                const sliders = ['chartBorderWidth', 'chartOpacity', 'chartHeight'];
                sliders.forEach(sliderId => {
                    const slider = document.getElementById(sliderId);
                    if (slider) {
                        slider.addEventListener('input', updateSliderValues);
                    }
                });
            } catch (error) {
                console.error('Erro ao configurar event listeners:', error);
            }
        });
    </script>
</body>
</html>